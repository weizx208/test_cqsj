var g_chuanchen;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),a=r.prototype;return a._initProp=function(){t.prototype._initProp.call(this)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.label_needLvl.visible=!1},a.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.name="eqp_cell_"+e.itemIndex;var i=e.data;e.ico_item.set("itemId",i.tempId);for(var r,a=mo.STR.format("[ubb color=%s]%s[/ubb] [ubb]评分:%s[/ubb][/br]",uiHelper.getColorByQuality(i.quality),i.name,gd.equipCtrl.getEquipEvaluate(i.equipId)),n=i.proptys,o=gd.equipCtrl.getEquipExtraObj(i.equipId),u="[ubb]%s: %s[/ubb][ubb] +%s[/ubb][/br]",l="[ubb color=0x2EAAF7]%s: %s[/ubb][ubb color=0x2EAAF7] +%s[/ubb][/br]",s=0,p=n.length;p>s;s++){r=n[s];var _=r[0],c=r[1];a+=mo.STR.format(0==s?u:l,gc.c_prop.equipProp[_],c,o[_]||0)}e.label_desc.text=a;var b=gd.equipCtrl.getInheritedEquipOpt(i.equipId);e.label_needLvl.visible=!b.nextEquipNeedLvlEnough,e.btn_choose.visible=b.nextEquipNeedLvlEnough,b.nextEquipNeedLvlEnough||(e.label_needLvl.text=b.nextEquipNeedLvl)},a._tap_btn_choose=function(){var t=this;e.CCEquip.create().setData({bdc:t.data}).show()},i.ON_BTN_EQUIP="on_btn_equip",i}(mo.gui.ItemRenderer);e.CCEquipChooseItem=t,egret.registerClass(t,"g_chuanchen.CCEquipChooseItem")}(g_chuanchen||(g_chuanchen={}));var g_chuanchen;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),a=r.prototype;return a._initProp=function(){var i=this;t.prototype._initProp.call(this),i._layerOpt.shownWithAction=!1,i._Item_list_items=e.CCEquipChooseItem,i._equips=[],i.registerClassByKey(gd.EquipCtrl,gd.EquipCtrl.ON_INHERITED,i._reset)},a._childrenCreated=function(){var e=this;t.prototype._childrenCreated.call(this);var i=[],r={1:"tab_txt_zansesz",2:"tab_txt_fsisenz",3:"tab_txt_daosisz"},a=gc.c_prop.heroJob;for(var n in a){var o=parseInt(n);o!=gc.c_prop.heroJobKey.ys&&gd.heroCtrl.hasHeroByJob(o)&&i.push(r[o])}i.push("tab_txt_beibao"),e.tab_bag.dataProvider=new egret.gui.ArrayCollection(i),process.nextTick(function(){e.tab_bag.selectedIndex=0,e._tap_tab_bag(null)});for(var u=0,l=4;l>u;u++)e["img_red"+u].visible=!1},a._tap_tab_bag=function(e){var t=this;t._reset();for(var i=t.tab_bag.getChildAt(0),r=0;r<i.numChildren;++r)i.getChildAt(r).selected=r==t.tab_bag.selectedIndex},a._reset=function(){var e=this,t=e._getSelectedType();if(99>t){var i=gd.heroCtrl.getHeroByJob(t);i&&(e._equips=i.getAllSpecialEquip())}else e._equips=gd.equipCtrl.getBagSpecialEquipList();e.label_empty.visible=e._equips.length<=0,e.refreshList("list_items");for(var r=gd.equipCtrl.getSpecialEquipDot(),a=0,n=4;n>a;a++)e["img_red"+a].visible=r[a]>0},a._getSelectedType=function(){var e=this,t=e.tab_bag.selectedItem;switch(t){case"tab_txt_zansesz":return 1;case"tab_txt_fsisenz":return 2;case"tab_txt_daosisz":return 3;case"tab_txt_beibao":return 99}return-1},a._data_list_items=function(){var e=this;return gd.BagDataCtrl.getEquipList(e._equips)},a._initItem_list_items=function(e){},i}(mo.gui.Dlg);e.Chuanchen=t,egret.registerClass(t,"g_chuanchen.Chuanchen"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=t,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){t()})})}(g_chuanchen||(g_chuanchen={}));var g_chuanchen;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),r=i.prototype;return r._initProp=function(){var t=this;e.prototype._initProp.call(this),t._layerOpt.shownWithAction=!1},r._childrenCreated=function(){e.prototype._childrenCreated.call(this)},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,i=t.data.bdc;t.ico_item.set("itemId",i.tempId),t._setBeforeEquipInfo(t.grp_before,i),t._setAfterEquipInfo(t.grp_after)},r._setAfterEquipInfo=function(e){var t=this,i=gd.equipCtrl.getInheritedEquipOpt(t.data.bdc.equipId),r=i.inheritedInfo,a=r[gc.t_inheritedEquip_nextId];if(e.visible=0!=a,0!=a){var n=mo.getJSONWithFileNameAndID(gc.cfg_t_item,a),o=mo.getJSONWithFileNameAndID(gc.cfg_t_itemEquip,a),u=gd.equipCtrl.getEquipName(a),l=n[gc.t_item_itemLvl],s=e.getChildByName("label_name_lvl"),p=e.getChildByName("label_score"),_=e.getChildByName("grp_props").getChildByName("label_props");s.text=mo.STR.format("[ubb color=%s]%s [/ubb][ubb color=#E8CA47]%s级[/ubb]",uiHelper.getColorByQuality(n[gc.t_item_color]),u,l);for(var c,b="",g=o[gc.t_itemEquip_propertys],d=utils.kvArr2KvObj(o[gc.t_itemEquip_fixProp]),h="[ubb]%s: %s[/ubb][ubb] +%s[/ubb][/br]",m="[ubb color=0x2EAAF7]%s: %s[/ubb][ubb color=0x2EAAF7] +%s[/ubb][/br]",v=0,f=g.length;f>v;v++){c=g[v];var C=c[0],q=c[1];b+=mo.STR.format(0==v?h:m,gc.c_prop.equipProp[C],q,d[C]||0)}_.text=b,p.text=gd.equipCtrl.getSpecialEquipEvaluate(a),t.grp_lvlEnough.visible=i.nextEquipNeedLvlEnough,t.btn_chuanchen.visible=i.nextEquipNeedLvlEnough,t.grp_lvlNotEnough.visible=!i.nextEquipNeedLvlEnough,i.nextEquipNeedLvlEnough||(t.label_needLvl.text=i.nextEquipNeedLvl),uiHelper.setResGrp(t.grp_res,i.itemId,i.inheritedInfo[gc.t_inheritedEquip_num]),uiHelper.setResGrp(t.grp_resMy,i.itemId,gd.userCtrl.getItemNum(i.itemId))}},r._setBeforeEquipInfo=function(e,t){var i=e.getChildByName("label_name_lvl"),r=e.getChildByName("label_score"),a=e.getChildByName("grp_props").getChildByName("label_props");i.text=mo.STR.format("[ubb color=%s]%s [/ubb][ubb color=#E8CA47]%s级[/ubb]",uiHelper.getColorByQuality(t.quality),t.name,t.itemLvl),r.text=t.score;for(var n,o="",u=t.proptys,l=gd.equipCtrl.getEquipExtraObj(t.equipId),s="[ubb]%s: %s[/ubb][ubb] +%s[/ubb][/br]",p="[ubb color=0x2EAAF7]%s: %s[/ubb][ubb color=0x2EAAF7] +%s[/ubb][/br]",_=0,c=u.length;c>_;_++){n=u[_];var b=n[0],g=n[1];o+=mo.STR.format(0==_?s:p,gc.c_prop.equipProp[b],g,l[b]||0)}a.text=o},r._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:25}).show()},r._tap_btn_chuanchen=function(){var e=this,t=gd.equipCtrl.getInheritedEquipOpt(e.data.bdc.equipId),i=t.inheritedInfo[gc.t_inheritedEquip_nextId],r=t.itemId;return 0==r?mo.showMsg("已达最高传承等级!"):void(t.isItemEnough?gd.equipCtrl.inheritedEquip(t,function(){e.setData({bdc:gd.BagDataCtrl.create(i,t.equipId)})},e):g_base.GainWay.canBuyFromShop(r)?g_base.GainWayShop.create().setData({itemId:r,count:t.inheritedInfo[gc.t_inheritedEquip_num]-gd.userCtrl.getItemNum(t.itemId)}).show().onClose(function(){e.dataChanged()}):g_base.GainWay.create().setData({itemId:r}).show())},t}(mo.gui.Dlg);e.CCEquip=t,egret.registerClass(t,"g_chuanchen.CCEquip")}(g_chuanchen||(g_chuanchen={}));