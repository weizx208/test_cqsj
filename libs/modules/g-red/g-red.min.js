var g_red;!function(e){var t=function(t){function n(){t.apply(this,arguments)}__extends(n,t);var a=(__define,n),r=a.prototype;return r._initProp=function(){var n=this;t.prototype._initProp.call(this),n._layerOpt.shownWithAction=!1,n._Item_list_rec=e.RedPacketRecCell},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);for(var e=this,n=0;9>=n;++n)e["btn_"+n].addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTapNum,e);e.label_myRmb.text=e.label_myRmbInput.text=gd.userCtrl.getDiamond().toString(),e.tab_type.selectedIndex=0,e._tap_tab_type(),e.label_sendRmb.text="100",e.btn_people1.enabled=!1,e.moduleParam&&e.setData(e.moduleParam.data)},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,n=e.data,a=n[gc.dsConsts.RedEnvelopePersonalEntity.addUpServer],r=n[gc.dsConsts.RedEnvelopePersonalEntity.addUpGuild],o=n[gc.dsConsts.RedEnvelopePersonalEntity.addUpGet];e.label_all.text=a?a.toString():"0",e.label_guild.text=r?r.toString():"0",e.label_get.text=o?o.toString():"0",e.checkCount()},r.checkCount=function(){var e=this,t=e.tab_type.selectedIndex,n=gd.redEnvelopePersonalCtrl.getDayCount(0==t?gc.c_prop.redEnvelopeTypeKey.comRed:gc.c_prop.redEnvelopeTypeKey.guildRed);e.label_shareDesc.text=mo.STR.format("VIP%s今日发送次数剩余%s/%s",n[0],n[1],n[2]),e.label_shareDesc.visible=n[2]>0;var a=gd.userCtrl.getVip(),r=mo.getJSONWithFileName(gc.cfg_c_vip),o=gc.c_vip_worldCount,i=0,t=e.tab_type.selectedIndex;0==t?o=gc.c_vip_worldCount:1==t&&(o=gc.c_vip_guildCount);for(var l in r)if(0!=r[l][o]){i=parseInt(l);break}i>a?(e.btn_confirm.visible=!1,e.label_cannotRed.visible=!0,e.label_cannotRed.text=i):(e.btn_confirm.visible=!0,e.label_cannotRed.visible=!1)},r.setMoney=function(e){var t=this;return t.label_myRmb.text=t.label_myRmbInput.text=gd.userCtrl.getDiamond().toString(),e>gd.userCtrl.getDiamond()?mo.showMsg(gc.id_c_msgCode.noDiamond):void(t.label_sendRmb.text=e.toString())},r._tap_btn_rmb1=function(){var e=this;e.setMoney(100)},r._tap_btn_rmb2=function(){var e=this;e.setMoney(500)},r._tap_btn_rmb3=function(){var e=this;e.setMoney(800)},r._tap_btn_rmb4=function(){var e=this;e.setMoney(1e3)},r._tap_btn_people1=function(){var e=this;e.btn_people1.enabled=!1,e.btn_people2.enabled=!0,e.btn_people3.enabled=!0},r._tap_btn_people2=function(){var e=this;e.btn_people2.enabled=!1,e.btn_people1.enabled=!0,e.btn_people3.enabled=!0},r._tap_btn_people3=function(){var e=this;e.btn_people3.enabled=!1,e.btn_people1.enabled=!0,e.btn_people2.enabled=!0},r._tap_btn_dice=function(){var e,t=this,n=gd.userCtrl.getDiamond(),a=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.redEnvelopeCfg),r=t.tab_type.selectedIndex,o=0==r?a[3]:a[4];e=20>=n?n:n>=o?20+Math.ceil(Math.random()*(o-20)):20+Math.ceil(Math.random()*(n-20)),t.label_sendRmb.text=e.toString()},r._tap_btn_confirm=function(){var e=this,t=0==e.tab_type.selectedIndex?gc.c_prop.redEnvelopeTypeKey.comRed:gc.c_prop.redEnvelopeTypeKey.guildRed,n=parseInt(e.label_sendRmb.text),a=e.btn_people1.enabled?e.btn_people2.enabled?20:10:5,r=e.label_say.text,o=gc.c_prop.spItemIdKey.diamond;gd.redEnvelopeCtrl.sendRedEnvelope(t,o,n,a,r,function(){e.setData(gd.redEnvelopePersonalCtrl.getData()),e.checkCount(),e.label_myRmb.text=e.label_myRmbInput.text=gd.userCtrl.getDiamond().toString(),mo.showMsg(gc.id_c_msgCode.packetSuccess)},e)},r._tap_label_sendRmb=function(){var e=this;e.label_sendRmbInput.text=e.label_sendRmb.text,e.grp_numInput.visible=!0},r._tap_btn_ok=function(){var e=this;e.setMoney(parseInt(e.label_sendRmbInput.text)),e.grp_numInput.visible=!1},r._tap_btn_del=function(){var e=this,t=parseInt(e.label_sendRmbInput.text);t=Math.floor(t/10),e.label_sendRmbInput.text=t.toString()},r._tap_btn_detail=function(){var t=this,n=t.data;e.RedPacketDetail.create().setData({data:n}).show()},r.onTapNum=function(e){for(var t=this,n=e.currentTarget,a=[],r=0;9>=r;++r)a.push(t["btn_"+r]);var o=a.indexOf(n);t.label_sendRmbInput.text+=o;var i=parseInt(t.label_sendRmbInput.text);t.label_sendRmbInput.text=i.toString()},r._data_list_rec=function(){var e=this,t=e.data,n=t[gc.dsConsts.RedEnvelopePersonalEntity.getData];return n},r._tap_tab_type=function(){var e=this,t=e.tab_type.selectedIndex;e.grp_numInput.visible=!1,0==t?(e.grp_redPacket.visible=!0,e.grp_redRec.visible=!1,e.ico_t1.visible=!0,e.ico_t2.visible=!1,e.btn_rmb3.visible=!0,e.btn_rmb4.visible=!1,e.label_desc.text="向所有人发送随机元宝数量红包，并将消息显示在系统公告中，领取红包的人都将在聊天频道发送此消息。红包将在15秒内送达。"):1==t?(e.grp_redPacket.visible=!0,e.grp_redRec.visible=!1,e.ico_t1.visible=!1,e.ico_t2.visible=!0,e.btn_rmb3.visible=!1,e.btn_rmb4.visible=!0,e.label_desc.text="向行会成员发送随机元宝数量红包，并将消息显示在系统公告中，领取红包的人都将在聊天频道发送此消息。红包将在15秒内送达。"):2==t&&(e.grp_redPacket.visible=!1,e.grp_redRec.visible=!0,e.refreshList("list_rec")),e.checkCount()},r._tap_btn_recharge=function(){mo.moduleMgr.runModule(g_consts.moduleId.recharge)},n}(mo.gui.Dlg);e.RedPacket=t,egret.registerClass(t,"g_red.RedPacket"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,e.fullScr=!0,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){gd.redEnvelopePersonalCtrl.getInfo(function(n){e.data=n,t()},this)})})}(g_red||(g_red={}));var g_red;!function(e){var t=function(t){function n(){t.apply(this,arguments)}__extends(n,t);var a=(__define,n),r=a.prototype;return r._initProp=function(){var n=this;t.prototype._initProp.call(this),n._layerOpt.shownWithAction=!1,n._Item_list_get=e.RedPacketGetCell},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.moduleParam&&e.setData(e.moduleParam)},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,n=e.data;if(n){for(var a=n[gc.dsConsts.RedEnvelopeEntity.redType],r=gd.redEnvelopeCtrl.getNameById(n[gc.dsConsts.RedEnvelopeEntity.userId]),o=n[gc.dsConsts.RedEnvelopeEntity.wish],i=n[gc.dsConsts.RedEnvelopeEntity.getData],l=0,d=0;i&&d<i.length;++d)if(gd.userCtrl.getId()==i[d][1]){l=i[d][0];break}e.label_red.text=mo.STR.format("[%s]",gc.c_prop.redEnvelopeType[a]),e.label_rmb.text=l.toString(),e.label_name.text=r,e.label_desc.text=o;var s=n[gc.dsConsts.RedEnvelopeEntity.spItemId];e.setItemIcon(e.ico_item,s)}},r._data_list_get=function(){for(var e=this,t=e.data,n=t[gc.dsConsts.RedEnvelopeEntity.getData],a=[],r=-1,o=t[gc.dsConsts.RedEnvelopeEntity.spItemId],i=0,l=0;n&&l<n.length;++l)if(!(n[l].length<2)){if(i>100)break;a.push(n[l]),n[l][0]>r&&(r=n[l][0]),i+=1}a.sort(function(e,t){return t[0]-e[0]});for(var l=0;l<a.length;++l)a[l].push(r);for(var d=[],l=0;l<a.length;++l){var s={};s.spItemId=o,s.data=a[l],d.push(s)}return d},r.setItemIcon=function(e,t){var n=this;if(t==gc.c_prop.spItemIdKey.diamond)e.source="ico_yuanbao";else{var a=resHelper.getSmallItemPath(t);RES.getResByUrl(a,function(t){e.source=t},n,RES.ResourceItem.TYPE_IMAGE)}},n}(mo.gui.Dlg);e.RedPacketGet=t,egret.registerClass(t,"g_red.RedPacketGet")}(g_red||(g_red={}));var g_red;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t),a=n.prototype;return a.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;if(t.data){var n=t.data.data;if(n){var a=n[0],r=n[2],o=n[n.length-1];t.label_name.text=r,t.label_rmb.text=a.toString(),t.ico_best.visible=o==a;var i=t.data.spItemId;t.setItemIcon(t.ico_item,i)}}},a.setItemIcon=function(e,t){var n=this;if(t==gc.c_prop.spItemIdKey.diamond)e.source="ico_yuanbao";else{var a=resHelper.getSmallItemPath(t);RES.getResByUrl(a,function(t){e.source=t},n,RES.ResourceItem.TYPE_IMAGE)}},t}(mo.gui.ItemRenderer);e.RedPacketGetCell=t,egret.registerClass(t,"g_red.RedPacketGetCell")}(g_red||(g_red={}));var g_red;!function(e){var t=function(t){function n(){t.apply(this,arguments)}__extends(n,t);var a=(__define,n),r=a.prototype;return r._initProp=function(){var n=this;t.prototype._initProp.call(this),n._layerOpt.shownWithAction=!1,n._Item_list_red=e.RedPacketListCell},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;gd.redEnvelopeCtrl.needToDel(),e.reds=gd.redEnvelopeCtrl.getCanGetList().concat()},r.onReceive=function(){var e=this;gd.redEnvelopeCtrl.needToDel(),e.reds=gd.redEnvelopeCtrl.getCanGetList().concat(),e.reds.length>0?e.refreshList("list_red"):e.close()},r.dataChanged=function(){t.prototype.dataChanged.call(this)},r._data_list_red=function(){var e=this;return e.reds?e.reds:[]},n}(mo.gui.Dlg);e.RedPacketList=t,egret.registerClass(t,"g_red.RedPacketList"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,e.fullScr=!0,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){t()})})}(g_red||(g_red={}));var g_red;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t),a=n.prototype;return a.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,n=t.data;if(n[0]){var a=n[0],r=n[1],o=Date.newDate(n[2]);t.label_red.text=mo.STR.format("[%s]",gc.c_prop.redEnvelopeType[a]),t.label_rmb.text=r.toString(),t.label_date.text=o.toFormat("YYYY-MM-DD")}},t}(mo.gui.ItemRenderer);e.RedPacketRecCell=t,egret.registerClass(t,"g_red.RedPacketRecCell")}(g_red||(g_red={}));var g_red;!function(e){var t=function(t){function n(){t.apply(this,arguments)}__extends(n,t);var a=(__define,n),r=a.prototype;return r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,n=e.data;if(n){var a=n[gc.dsConsts.RedEnvelopeEntity.redType],r=gd.redEnvelopeCtrl.getNameById(n[gc.dsConsts.RedEnvelopeEntity.userId]);e.label_name.text=r,e.label_red.text=mo.STR.format("[%s]",gc.c_prop.redEnvelopeType[a]),e.setRedType(a);var o=n[gc.dsConsts.RedEnvelopeEntity.spItemId]||0;o>0&&e.setItemIcon(e.img_icon,o)}},r._tap_btn_get=function(){var t=this,n=t.data;n[gc.dsConsts.RedEnvelopeEntity.getData];gd.redEnvelopeCtrl.receiveBonus(n[gc.dsConsts.RedEnvelopeEntity.id],function(n){e.RedPacketGet.create().setData(n).show().onClose(function(){t.delegate.onReceive()})},t)},r.setRedType=function(e){var t=this;e==gc.c_prop.redEnvelopeTypeKey.sysComRed||e==gc.c_prop.redEnvelopeTypeKey.sysGuildRed?(t.label_red.bold=!0,t.label_red.textColor=15654453):(t.label_red.bold=!1,t.label_red.textColor=16777215)},r.setItemIcon=function(e,t){var n=this;if(t==gc.c_prop.spItemIdKey.diamond)e.source="ico_yuanbao";else{var a=resHelper.getSmallItemPath(t);RES.getResByUrl(a,function(t){e.source=t},n,RES.ResourceItem.TYPE_IMAGE)}},n}(mo.gui.ItemRenderer);e.RedPacketListCell=t,egret.registerClass(t,"g_red.RedPacketListCell")}(g_red||(g_red={}));var g_red;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t),a=n.prototype;return a.dataChanged=function(){e.prototype.dataChanged.call(this)},t}(mo.gui.Dlg);e.RedPacketSystem=t,egret.registerClass(t,"g_red.RedPacketSystem"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,e.fullScr=!0,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){t()})})}(g_red||(g_red={}));var g_red;!function(e){var t=function(t){function n(){t.apply(this,arguments)}__extends(n,t);var a=(__define,n),r=a.prototype;return r._initProp=function(){var n=this;t.prototype._initProp.call(this),n._Item_list_totalRec=e.RedPacketDetailCell},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.dataArr=null,e.refreshList("list_totalRec")},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;if(e.data){var n=e.data.data,a=n[gc.dsConsts.RedEnvelopePersonalEntity.addUpGet],r=n[gc.dsConsts.RedEnvelopePersonalEntity.exAddUpGet];if(r){e.dataArr=utils.itemObj2ObjArr(r);var o=a?a:0,i=gc.c_prop.spItemIdKey.diamond;if(o>0){var l={itemId:i,count:o};e.dataArr.unshift(l)}}}},r._data_list_totalRec=function(){var e=this;return e.dataArr},n}(mo.gui.Dlg);e.RedPacketDetail=t,egret.registerClass(t,"g_red.RedPacketDetail")}(g_red||(g_red={}));var g_red;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t),a=n.prototype;return a.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,n=t.data;if(n){var a=n.itemId,r=n.count;t.label_get.text=r.toString();var o=mo.getJSONWithFileNameAndID(gc.cfg_t_item,a),i=o?o[gc.t_item_name]:"",l="获得%s总数量:",d=l.replace("%s",i);t.label_name.text=d,t.setItemIcon(t.img_icon,a)}},a.setItemIcon=function(e,t){var n=this;if(t==gc.c_prop.spItemIdKey.diamond)e.source="ico_yuanbao";else{var a=resHelper.getSmallItemPath(t);RES.getResByUrl(a,function(t){e.source=t},n,RES.ResourceItem.TYPE_IMAGE)}},t}(mo.gui.ItemRenderer);e.RedPacketDetailCell=t,egret.registerClass(t,"g_red.RedPacketDetailCell")}(g_red||(g_red={}));