var g_defarena;!function(e){var t=function(t){function a(){t.apply(this,arguments)}__extends(a,t);var r=(__define,a),n=r.prototype;return n._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,mo.closeEmitter.on("DefarenaWinner",function(){e._itemDetail&&(e._itemDetail.close(),e._itemDetail=null),process.nextTick(function(){e.close()})},e),e.registerClassByKey(gd.ChallengeCupCtrl,gd.ChallengeCupCtrl.ON_ACT_END,function(t){e.setData(t)})},n._childrenCreated=function(){var a=this;t.prototype._childrenCreated.call(this),a.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,a.click_btn_close,a);var r=gd.challengeCupCtrl.getRward();a.item_reward.setData({itemId:r[0],count:r[1]}),a.item_reward.onClick(function(){e.DefArenaRankReward.create().show()}),uiHelper.setResGrp(a.grp_res,gc.c_prop.spItemIdKey.diamond,gd.challengeCupCtrl.getChallegeCost()),a.label_ruleTime.text=gd.challengeCupCtrl.getDefTime()/60,a.moduleParam&&a.setData(a.moduleParam.info)},n.dataChanged=function(){var e=this;t.prototype.dataChanged.call(this),e._removeTrigger();var a=e.data,r=gc.dsConsts.ChallengeCupData,n=a[r.userId]&&0!=a[r.userId];if(e.grp_hasAdmin.visible=n,e.grp_noAdmin.visible=!n,e.setActCDTime(a[r.activityLeftTime]),n){uiHelper.setVipGrp(e.grp_userInfo,a[r.nickName],a[r.lvl],a[r.vip]),e.label_guild.text=a[r.guildName];var i=a[r.HeroDisplay];if(e.ico_avatar.setData({clothesID:i[0],weaponID:i[1],wingID:i[2],sex:i[3],isKing:i[4]}),e.ico_avatar.setData({clothesID:i[0],weaponID:i[1],wingID:i[2],sex:i[3]}),e.label_fighting.visible=null!=a[r.challengerUserId],e.setKingCDTime(a[r.leftTime]),gd.userCtrl.getId()==a[r.userId])e.grp_chlg.visible=!1;else{e.grp_chlg.visible=!0;var l=gd.userCtrl.getId()==a[r.challengerUserId];e.grp_fightCD.visible=!l,l||e.setChlgCDTime(a[r.nextChallengeTime])}}},n._updateKingProgress=function(e){var t=this;t.data,gc.dsConsts.ChallengeCupData;t.label_leftTime.text=mo.getTimeStr(1e3*e,!0);var a=gd.challengeCupCtrl.getDefTime();t.bar_totalTime.value=(a-e)/a*100},n.setActCDTime=function(e){var t=this;if(e>0){t.actTrigger&&(tm.timer.remove(t.actTrigger),t.actTrigger=null);var a=Date.newDate(Date.newDate().getTime()+1e3*e),r=t.actTrigger=new tm.Trigger(a);r.on(tm.Trigger.ON_FIRST,t.timeSec,t),r.on(tm.Trigger.ON_SECOND,t.timeSec,t),r.on(tm.Trigger.ON_END,t.timeOut,t),tm.timer.add(r)}else t.resetCdTimeView(0)},n.timeSec=function(e,t,a){var r=this,n=Date.newDate().getTime(),i=Date.newDate(a).getTime(),l=i-n;r.resetCdTimeView(l)},n.timeOut=function(e,t,a){var r=this;r.resetCdTimeView(0)},n.resetCdTimeView=function(e){var t=this;t.label_actCD.text=mo.STR.format(mo.getTimeStr(e,!0))},n.setChlgCDTime=function(e){var t=this;if(e>0){t.chlgTrigger&&(tm.timer.remove(t.chlgTrigger),t.chlgTrigger=null);var a=Date.newDate(Date.newDate().getTime()+1e3*e),r=t.chlgTrigger=new tm.Trigger(a);r.on(tm.Trigger.ON_FIRST,t.timeSec2,t),r.on(tm.Trigger.ON_SECOND,t.timeSec2,t),r.on(tm.Trigger.ON_END,t.timeOut2,t),tm.timer.add(r)}else t.resetChlgCdTimeView(0)},n.timeSec2=function(e,t,a){var r=this,n=Date.newDate().getTime(),i=Date.newDate(a).getTime(),l=i-n;r.resetChlgCdTimeView(l)},n.timeOut2=function(e,t,a){var r=this;r.resetChlgCdTimeView(0)},n.resetChlgCdTimeView=function(e){var t=this;e>0?(t.btn_challenge.enable=!1,t.grp_fightCD.visible=!0,t.label_ftCD.text=mo.STR.format(mo.getTimeStr(e))):(t.btn_challenge.enable=!0,t.grp_fightCD.visible=!1)},n.setKingCDTime=function(e){var t=this;if(e>0){t.kingTrigger&&(tm.timer.remove(t.kingTrigger),t.kingTrigger=null);var a=Date.newDate(Date.newDate().getTime()+1e3*e),r=t.kingTrigger=new tm.Trigger(a);r.on(tm.Trigger.ON_FIRST,t.timeSec3,t),r.on(tm.Trigger.ON_SECOND,t.timeSec3,t),r.on(tm.Trigger.ON_END,t.timeOut3,t),tm.timer.add(r)}else t._updateKingProgress(0)},n.timeSec3=function(e,t,a){var r=this,n=Date.newDate().getTime(),i=Date.newDate(a).getTime(),l=i-n;r._updateKingProgress(l/1e3)},n.timeOut3=function(e,t,a){var r=this;r._updateKingProgress(0)},n._tap_btn_rank=function(){var t=this;gd.challengeCupCtrl.getRank(function(t){e.DefArenaRank.create().setData({rankData:t}).show()},t)},n._tap_btn_tq=function(){e.DefArenaGain.create().show()},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:20,param1:gd.challengeCupCtrl.getDefTime()/60}).show()},n._tap_btn_challenge=function(){var e=this,t=e.data,a=gc.dsConsts.ChallengeCupData,r=gd.userCtrl.getId()==t[a.challengerUserId];if(t[a.challengerUserId]&&r)return mo.showMsg("挑战中...");var n=e.data[gc.dsConsts.ChallengeCupData.nextChallengeTime];return e.chlgTrigger&&e.chlgTrigger.msPassed/1e3+1<n?mo.showMsg(gc.id_c_msgCode.challengeBossCd):void gd.challengeCupCtrl.startFight(function(t){return t?((t==gc.id_c_msgCode.userBeInFignting||t==gc.id_c_msgCode.userChangeIfGoOn)&&mo.showMsg(t,function(){e.reset()}),void(t==gc.id_c_msgCode.eventEnded&&mo.showMsg(t,function(){mo.moduleMgr.runModule(g_consts.moduleId.defarenaWinner)},e))):void e.close()},e)},n._tap_btn_up=function(){console.log("登上擂台");var e=this;gd.challengeCupCtrl.toBeChampoin(function(t){e.setData(t)},e)},n.click_btn_close=function(){var e=this;gd.challengeCupCtrl.removeTrigger(),e.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.click_btn_close,e)},n.reset=function(){var e=this;gd.challengeCupCtrl.getInfo(function(t){e.setData(t)},e)},n._removeTrigger=function(){var e=this;e.chlgTrigger&&(tm.timer.remove(e.chlgTrigger),e.chlgTrigger=null),e.actTrigger&&(tm.timer.remove(e.actTrigger),e.actTrigger=null),e.kingTrigger&&(tm.timer.remove(e.kingTrigger),e.kingTrigger=null)},n.dtor=function(){var e=this;t.prototype.dtor.call(this),e._removeTrigger()},a}(mo.gui.Dlg);e.DefArena=t,egret.registerClass(t,"g_defarena.DefArena"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=t,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){gd.challengeCupCtrl.getInfo(function(a){e.info=a,t()},this)})})}(g_defarena||(g_defarena={}));var g_defarena;!function(e){var t=function(t){function a(){t.apply(this,arguments)}__extends(a,t);var r=(__define,a),n=r.prototype;return n._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.moduleParam&&e.setData(e.moduleParam.info),e.label_openLvl.text=gd.challengeCupCtrl.getOpenLvl()},n.dataChanged=function(){var e=this;t.prototype.dataChanged.call(this);var a=gc.dsConsts.ChallengeCupData,r=e.data,n=r[a.userId]&&0!=r[a.userId];if(e.img_title.source=n?"tit_txt_benjiebazhu":"tit_txt_wangchenbazhu",n){e.label_guild.text=r[a.guildName];var i=r[a.HeroDisplay];e.ico_avatar.setData({clothesID:i[0],weaponID:i[1],wingID:i[2],sex:i[3],isKing:i[4]}),e.label_combat.text=r[a.combat],uiHelper.setVipGrp(e.grp_userInfo,r[a.nickName],r[a.lvl],r[a.vip])}var l=gd.challengeCupCtrl.nextOpenTime;e.label_nextOpenTime.text=l.toFormat("MM月DD日HH24:MI")},n._tap_btn_rank=function(){var t=this;gd.challengeCupCtrl.getRank(function(t){e.DefArenaRank.create().setData({rankData:t}).show()},t)},n._tap_btn_ok=function(){var e=this;e.close(),process.nextTick(function(){mo.moduleMgr.runModule(g_consts.moduleId.home,{subModuleId:6})})},n._tap_ico_avatar=function(){var e=this,t=gc.dsConsts.ChallengeCupData,a=e.data,r=a[t.userId]&&0!=a[t.userId];r&&mo.moduleMgr.pushModule(g_consts.moduleId.roleEnemyInfo,{userId:a[t.userId]})},n.getCurrentSkinState=function(){var e=this,t=e.moduleParam.info,a=gc.dsConsts.ChallengeCupData,r=t[a.userId]&&0!=t[a.userId];return r?"hasAdmin":"noAdmin"},a}(mo.gui.Dlg);e.DefarenaWinner=t,egret.registerClass(t,"g_defarena.DefarenaWinner"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){gd.challengeCupCtrl.getInfo(function(a){e.info=a,t()},this)})})}(g_defarena||(g_defarena={}));var g_defarena;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var a=(__define,t),r=a.prototype;return r._initProp=function(){var t=this;e.prototype._initProp.call(this),t._layerOpt.shownWithAction=!1,mo.closeEmitter.on("DefarenaWinner",t.close,t)},r.onEnter=function(){e.prototype.onEnter.call(this);var t=this,a=mo.getJSONWithFileNameAndID(gc.cfg_c_help,21);t.label_desc.text=a[gc.c_help_helpText];var r=gd.challengeCupCtrl.getFirstReward(),n=gd.BagDataCtrl.create(r,null),i="[ubb color=0xEBC661]%s:[/ubb] [ubb color=0x00DD3D]+%s%[/ubb][/br]",l="";for(var g in gc.c_prop.equipProp)l+=mo.STR.format(i,gc.c_prop.equipProp[g],gd.kingCtrl.getCloakProAdd()/100);t.label_props.text=l,t.label_name.text=n.name,t.label_name.textColor=uiHelper.getColorByQuality(n.quality)},r._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:5}).show()},t}(mo.gui.Dlg);e.DefArenaGain=t,egret.registerClass(t,"g_defarena.DefArenaGain")}(g_defarena||(g_defarena={}));var g_defarena;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var a=(__define,t),r=a.prototype;return r._initProp=function(){var t=this;e.prototype._initProp.call(this),t.DS_DATA_KEY=gc.dsConsts.ChampionDurationTimeRank},r.seteRankReward=function(e){var t=this,a=gd.challengeCupCtrl.getRankReward(e);uiHelper.setResGrp(t.grp_res0,a[0][0],a[0][1]),uiHelper.setResGrp(t.grp_res1,a[1][0],a[1][1]),a[2]?(uiHelper.setResGrp(t.grp_res2,a[2][0],a[2][1]),t.grp_res2.visible=!0):t.grp_res2.visible=!1},r.setRankDesc=function(){var e=this,t=e.data,a=e.DS_DATA_KEY;e.label_title.text="守擂最长时间",e.label_combat.text=mo.getTimeStr(1e3*t[a.durationTime],!0)},t}(g_arena.ArenaRankItem);e.DefArenaRankItem=t,egret.registerClass(t,"g_defarena.DefArenaRankItem")}(g_defarena||(g_defarena={}));var g_defarena;!function(e){var t=function(t){function a(){t.apply(this,arguments)}__extends(a,t);var r=(__define,a),n=r.prototype;return n._initProp=function(){var a=this;t.prototype._initProp.call(this),a._layerOpt.shownWithAction=!1,a._Item_list_rank=e.DefArenaRankItem,mo.closeEmitter.on("DefarenaWinner",a.close,a)},n.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,a=gd.challengeCupCtrl.getMyRank(),r=null!=a;if(e.label_noRank.visible=!r,e.label_noFight.visible=!r,e.label_myRank.visible=r,e.label_myTime.visible=r,e.grp_hasRank.visible=r,r){e.label_myRank.text=a[gc.dsConsts.ChampionDurationTimeRank.rank],e.label_myTime.text=mo.getTimeStr(1e3*a[gc.dsConsts.ChampionDurationTimeRank.durationTime],!0);var n=gd.challengeCupCtrl.getRankReward(a[gc.dsConsts.ChampionDurationTimeRank.rank]);uiHelper.setResGrp(e.grp_res0,n[0][0],n[0][1]),uiHelper.setResGrp(e.grp_res1,n[1][0],n[1][1]),n[2]?(uiHelper.setResGrp(e.grp_res2,n[2][0],n[2][1]),e.grp_res2.visible=!0):e.grp_res2.visible=!1}},n._data_list_rank=function(){var e=this;return e.data.rankData},a}(g_base.CloseInfoDlg);e.DefArenaRank=t,egret.registerClass(t,"g_defarena.DefArenaRank")}(g_defarena||(g_defarena={}));var g_defarena;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var a=(__define,t),r=a.prototype;return r._initProp=function(){e.prototype._initProp.call(this)},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;if(null!=t.data[gc.c_challengeCupRankReward_id]){var a=t.data[gc.c_challengeCupRankReward_id],r=["1st","2nd","3rd"];3>=a?(t.ico_rank.source="ico_arena_"+r[a-1],t.ico_rank.visible=!0,t.label_rank.visible=!1):(t.label_rank.text=a,t.ico_rank.visible=!1,t.label_rank.visible=!0),t.data[gc.c_challengeCupRankReward_id]>8?t.label_rank.size=16:t.label_rank.size=20,t.label_rank.text=t.data[gc.c_challengeCupRankReward_name],uiHelper.setResGrp(t.grp_res0,gc.c_prop.spItemIdKey.gold,t.data[gc.c_challengeCupRankReward_gold]);var n=t.data[gc.c_challengeCupRankReward_reward];uiHelper.setResGrp(t.grp_res1,n[0][0],n[0][1]),n[1]?(uiHelper.setResGrp(t.grp_res2,n[1][0],n[1][1]),t.grp_res2.visible=!0):t.grp_res2.visible=!1}},t}(mo.gui.ItemRenderer);e.DefArenaRankRewardCell=t,egret.registerClass(t,"g_defarena.DefArenaRankRewardCell")}(g_defarena||(g_defarena={}));var g_defarena;!function(e){var t=function(t){function a(){t.apply(this,arguments)}__extends(a,t);var r=(__define,a),n=r.prototype;return n._initProp=function(){t.prototype._initProp.call(this);var a=this;a._Item_list_items=e.DefArenaRankRewardCell,mo.closeEmitter.on("DefarenaWinner",a.close,a)},n._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this,a=gd.challengeCupCtrl.getRward(),r=mo.getJSONWithFileNameAndID(gc.cfg_t_item,a[0]);e.item_reward.setData({itemId:a[0],count:a[1]}),e.label_desc.text=r[gc.t_item_note]},n._data_list_items=function(){var e=mo.getJSONWithFileName(gc.cfg_c_challengeCupRankReward),t=[];for(var a in e)t.push(e[a]);return t},a}(mo.gui.Dlg);e.DefArenaRankReward=t,egret.registerClass(t,"g_defarena.DefArenaRankReward")}(g_defarena||(g_defarena={}));