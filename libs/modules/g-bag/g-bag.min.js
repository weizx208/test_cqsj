var g_bag;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),a=r.prototype;return a._initProp=function(){e.prototype._initProp.call(this)},a._childrenCreated=function(){e.prototype._childrenCreated.call(this)},a.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data,a=t.ico_item;mo.R.loadTo("BagScene",resHelper.getItemIconPath(r.tempId),function(){}),t.name="cell_"+r.tempId,a.set("itemId",r.tempId),t.ico_item.set("count",r.count),t.ico_lock.visible=r.islock},t}(mo.gui.ItemRenderer);e.BagCell=t,egret.registerClass(t,"g_bag.BagCell")}(g_bag||(g_bag={}));var g_bag;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var a=(__define,r),i=a.prototype;return i._initProp=function(){var r=this;t.prototype._initProp.call(this),r._Item_list_items=e.BagCell,r.showType=1,r.registerClassByKey(gd.EquipCtrl,gd.EquipCtrl.ON_SMELT,function(){r._refresh()}),r.registerClassByKey(gd.EquipCtrl,gd.EquipCtrl.ON_BATCH_SMELT,function(){r._refresh()}),r.registerClassByKey(gd.CustomCtrl,gd.CustomCtrl.ON_INHERITED,function(){r._refresh()}),r.registerClassByKey(gd.CustomCtrl,gd.CustomCtrl.ON_CUSTOM,function(){r._refresh()}),r.registerClassByKey(gd.UserCtrl,gd.UserCtrl.ON_ITEM_CHANGE,function(){r._refresh()})},i._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.tab_bag.selectedIndex=0,e.label_grid.text=[gd.userCtrl.getEquipBagNum(),gd.userCtrl.getEquipBagGrid()],e._scollerHelper=new uiHelper.ScrollerHelper(e.list_items)},i._data_list_items=function(){var e=this;e._scollerHelper.resumeScroll();var t=gd.BagDataCtrl;return 1!=e.showType?t.getList(t.getFilterOpt(e.showType),t.getSortOpt(e.showType)):t.getEquipList(gd.equipCtrl.getEquipList())},i._tap_btn_forge=function(){var e=this;e._scollerHelper.pauseScrollV(),mo.moduleMgr.runModule(g_consts.moduleId.smelting)},i._tap_btn_sale=function(){e.BagSale.create().setData().show()},i._tap_tab_bag=function(e){var t=this;t.showType=t.tab_bag.selectedIndex+1,t._refresh(),t.grp_equip.visible=0==t.tab_bag.selectedIndex,0==t.tab_bag.selectedIndex&&(t.label_grid.text=[gd.userCtrl.getEquipBagNum(),gd.userCtrl.getEquipBagGrid()])},i._tap_btn_plus=function(){var e=this;gd.userCtrl.buyBagGrid(function(){e.label_grid.text=[gd.userCtrl.getEquipBagNum(),gd.userCtrl.getEquipBagGrid()]},e)},i._refresh=function(){var e=this,t=e.list_items.scroller,r=t.scrollTop>=0?t.scrollTop:0;e.refreshList("list_items"),process.nextTick(function(){e.list_items&&t.throwVertically(r,0)}),e.label_grid.text=[gd.userCtrl.getEquipBagNum(),gd.userCtrl.getEquipBagGrid()]},i._click_list_items=function(t){var r=this,a=t.item;a.type==gc.c_prop.itemTypeKey.chest||a.type==gc.c_prop.itemTypeKey.expBall||a.type==gc.c_prop.itemTypeKey.genuineQi?e.BagOpenBox.create().setData({bdc:a}).show().onClose(r._refresh,r):g_base.BaseItemDetail.create().setData({bdc:a,item:t.itemRenderer,isBag:1}).show()},i._tap_btn_back=function(){mo.moduleMgr.runModule(g_consts.moduleId.fight)},i.dtor=function(){t.prototype.dtor.call(this),this._scollerHelper.doDtor()},r}(mo.gui.Layer);e.BagLayer=t,egret.registerClass(t,"g_bag.BagLayer")}(g_bag||(g_bag={}));var g_bag;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),a=r.prototype;return a._initProp=function(){e.prototype._initProp.call(this)},a.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data.bdc;t.buyNum=r.count,t.label_name.text=r.name,t.ico_item.setData({itemId:r.tempId,count:0}),t.ico_item.label_text.visible=!1,t.label_desc.text=r.note,t.label_num.text=t.buyNum,t.container.title=r.type==gc.c_prop.itemTypeKey.chest?"tit_txt_g_useBox":"tit_txt_g_useItem";var a=gd.userCtrl.getNeedItems(r.tempId);if(0!=a[0]){t.buyNum=gd.userCtrl.getItemNum(a[1])/a[0]>>0,t.buyNum<1&&(t.buyNum=1),t.buyNum>r.count&&(t.buyNum=r.count),t.grp_cost.visible=!0,t.btn_ok.icon="btn_txt_g_kaiqig",t.ico_itemCost.source=resHelper.getItemIconPath(a[1]);var i=mo.getJSONWithFileNameAndID(gc.cfg_t_item,a[1]);t.label_itemCostName.text=i[gc.t_item_name],t.label_itemCostNum.text=gd.userCtrl.getItemNum(a[1])+"/"+a[0]*t.buyNum,t.showNum()}else t.grp_cost.visible=!1,t.btn_ok.icon="btn_txt_g_ok"},a._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.data.bdc},a._tap_btn_sub=function(){var e=this;e.buyNum>1&&(e.buyNum--,e.showNum())},a._tap_btn_add=function(){var e=this;e.buyNum<e.data.bdc.count&&(e.buyNum++,e.showNum())},a._tap_btn_min=function(){var e=this;e.buyNum=1,e.showNum()},a._tap_btn_max=function(){var e=this;e.buyNum=e.data.bdc.count,e.showNum()},a.showNum=function(){var e=this,t=e.data.bdc;e.label_num.text=e.buyNum;var r=gd.userCtrl.getNeedItems(t.tempId);0!=r[0]&&(e.label_itemCostNum.text=gd.userCtrl.getItemNum(r[1])+"/"+r[0]*e.buyNum)},a._tap_btn_ok=function(){var e=this;if(e.data.bdc.level>gd.userCtrl.getLvl())return void mo.showMsg(gc.id_c_msgCode.noLvlUse,e.data.bdc.level);if(e.data.bdc.vip&&e.data.bdc.vip>gd.userCtrl.getVip())return void mo.showMsg(gc.id_c_msgCode.vipItemRequire,e.data.bdc.vip);var t=e.data.bdc,r=gd.userCtrl.getNeedItems(t.tempId);if(0!=r[0]){var a=r[1];if(gd.userCtrl.getItemNum(r[1])<r[0]*e.buyNum)return void(g_base.GainWay.canBuyFromShop(a)?g_base.GainWayShop.create().setData({itemId:a,count:r[0]*e.buyNum-gd.userCtrl.getItemNum(r[1])}).show().onClose(function(){e.showNum()}):g_base.GainWay.create().setData({itemId:a}).show())}gd.userCtrl.getBagChest(e.data.bdc.tempId,e.buyNum,function(){e.close()},e)},t}(mo.gui.Dlg);e.BagOpenBox=t,egret.registerClass(t,"g_bag.BagOpenBox")}(g_bag||(g_bag={}));var g_bag;!function(e){logger.initLogger(e,"g-bag"),logger.setLvl("g-bag",4);var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var a=(__define,r),i=a.prototype;return i.show=function(){t.prototype.show.call(this),g_base.modIdx=4,e.BagLayer.create().show(),g_base.BaseBottomBar.create().show()},r}(mo.gui.UIScene);e.BagScene=t,egret.registerClass(t,"g_bag.BagScene"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){t()})})}(g_bag||(g_bag={}));var g_bag;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),a=r.prototype;return a._initProp=function(){var t=this;e.prototype._initProp.call(this),t._selectArray=[!1,!1,!1,!1,!1,!1],t.sendAry=[]},a._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.items=gd.BagDataCtrl.getEquipSalesInfo(),t.label_white.text="装备(剩余"+t.items[1].length+")",t.label_green.text="装备(剩余"+t.items[2].length+")",t.label_blue.text="装备(剩余"+t.items[3].length+")",t.label_purple.text="装备(剩余"+t.items[4].length+")",t.label_orange.text="装备(剩余"+t.items[5].length+")",t.label_below.text="装备(剩余"+t.items.below.length+")",t._changeReward()},a._changeReward=function(){for(var e=this,t={},r={},a=0;6>a;a++)if(e._selectArray[a])for(var i=0==a?"below":a,n=e.items[i],o=0;o<n.length;o++){var s=n[o];t[s.equipId]=s}e.sendAry=[];for(var g in t){e.sendAry.push(g);for(var s=t[g],l=0;l<s.rewards.length;l++){var _=s.rewards[l][0],c=s.rewards[l][1],u=r[_];if(u)r[_].c=u.c+c;else{var d=mo.getJSONWithFileNameAndID(gc.cfg_t_item,_);r[_]={c:c,n:d[gc.t_item_name]}}}}e._changeRewardView(r)},a._changeRewardView=function(e){var t=this;t.label_items.text="",t.grp_gold.parent&&t.grp_gold_container.removeElement(t.grp_gold),t.grp_yuanbao.parent&&t.grp_gold_container.removeElement(t.grp_yuanbao);for(var r in e){var a=e[r];99==r?(t.grp_gold.parent||t.grp_gold_container.addElement(t.grp_gold),t.label_gold.text="获得: "+a.c):200==r?(t.grp_yuanbao.parent||t.grp_gold_container.addElement(t.grp_yuanbao),t.label_yuanbao.text=+a.c):t.label_items.text=t.label_items.text+" "+a.n+"x"+a.c}},a._tap_btn_sale=function(){var e=this;return 0==e.sendAry.length?mo.showMsg("未选择或者没有可出售装备"):void mo.showMsg(gc.id_c_msgCode.ifSellItem2,function(){gd.equipCtrl.sellEquipItem(e.sendAry,function(){e.close()},e)})},a._tap_btn_info=function(){g_base.BaseShowTip.create().setData({id:207}).show()},a._chg_ckb_orange=function(){var e=this;e._selectArray[5]=!e._selectArray[5],e._changeReward()},a._chg_ckb_purple=function(){var e=this;e._selectArray[4]=!e._selectArray[4],e._changeReward()},a._chg_ckb_blue=function(){var e=this;e._selectArray[3]=!e._selectArray[3],e._changeReward()},a._chg_ckb_green=function(){var e=this;e._selectArray[2]=!e._selectArray[2],e._changeReward()},a._chg_ckb_white=function(){var e=this;e._selectArray[1]=!e._selectArray[1],e._changeReward()},a._chg_ckb_below=function(){var e=this;e._selectArray[0]=!e._selectArray[0],e._changeReward()},t}(mo.gui.Layer);e.BagSale=t,egret.registerClass(t,"g_bag.BagSale")}(g_bag||(g_bag={}));