var g_guildCopy;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),o=i.prototype;return o._initProp=function(){e.prototype._initProp.call(this)},o._childrenCreated=function(){e.prototype._childrenCreated.call(this)},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,i=t.data,o=i[gc.t_guildCopy_id];t.img_title.source=i[gc.t_guildCopy_title_icon],t.img_bg.source=i[gc.t_guildCopy_bg];var r=!1,s=i[gc.t_guildCopy_openLvl],l=gd.guildCtrl.getLvl()>=s;if(t.label_progress.visible=l,t.img_pass.visible=l,t.label_openLvl.visible=!l,t.label_openLvl.text=s,l){var n=gd.guildCopyCtrl.getCompletedNum(o),g=gd.guildCopyCtrl.getGuildBossListLength(o);r=n==g,t.img_pass.visible=r,t.label_progress.text=mo.STR.format("%s/%s",n,g)}},t}(mo.gui.ItemRenderer);e.GuildCopyItem=t,egret.registerClass(t,"g_guildCopy.GuildCopyItem")}(g_guildCopy||(g_guildCopy={}));var g_guildCopy;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var o=(__define,i),r=o.prototype;return r._initProp=function(){t.prototype._initProp.call(this);var i=this;i._layerOpt.shownWithAction=!1,i._Item_list_copys=e.GuildCopyItem},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this,i=mo.getJSONWithFileNameAndID(gc.cfg_t_guildCopy,1),o=0;e.moduleParam&&e.moduleParam.section&&(i=e.moduleParam.section,o=gd.guildCopyCtrl.getGuildSection().indexOf(i)),e.list_copys.scroller.verticalScrollPolicy="off",process.nextTick(function(){e.list_copys.selectedIndex=o,e.setCurSection(i)}),e.setCDTime(gd.guildCopyCtrl.getResetCd())},r._refreshUI=function(){var e=this;e.setCDTime(gd.guildCopyCtrl.getResetCd());var t=e.list_copys.selectedItem;e.setCurSection(t),e.refreshList("list_copys")},r._data_list_copys=function(){return gd.guildCopyCtrl.getGuildSection()},r._tap_btn_next=function(){},r._tap_btn_pre=function(){},r._tap_btn_help=function(){var e=mo.getJSONWithFileName(gc.cfg_c_game),t=e[gc.id_c_game.guildCopyCfg][0]/60,i=e[gc.id_c_game.guildCopyCfg][1];g_base.BaseShowTip.create().setData({id:61,param1:t,param2:i}).show()},r._tap_btn_enter=function(){var e=this,t=e.list_copys.selectedItem;mo.moduleMgr.runModule(g_consts.moduleId.guildCopyBoss,{section:t,fromMain:!0})},r._tap_btn_reset=function(){var e=this;gd.guildCopyCtrl.guildCopyReset(e._refreshUI,e)},r._click_list_copys=function(e){var t=this,i=e.item;t.setCurSection(i)},r.setCurSection=function(e){var t=this,i=e[gc.t_guildCopy_id];t.img_name.source=e[gc.t_guildCopy_sub_title_icon],uiHelper.setItemsGrp(t.grp_items,utils.kvArrItems2ObjArr(e[gc.t_guildCopy_award]));var o=!1,r=e[gc.t_guildCopy_openLvl],s=gd.guildCtrl.getLvl()>=r;t.btn_enter.visible=s&&!o,t.label_passed.visible=s&&o,t.label_openLvl.visible=!s,t.label_openLvl.text=r;var l=gd.guildPersonalCtrl.getPosition(),n=gd.guildCopyCtrl.getResetCd()>0,g=l==gc.c_prop.guildPostKey.chairman||l==gc.c_prop.guildPostKey.viceChairman;if(t.label_resetTips.visible=s&&!n&&!g,t.grp_reset.visible=s&&!n&&g,t.label_progress.visible=s,s){var a=gd.guildCopyCtrl.getCompletedNum(i),d=gd.guildCopyCtrl.getGuildBossListLength(i);t.label_progress.text=mo.STR.format("%s/%s",a,d)}},r.resetCdTimeView=function(e){var t=this;e>0?t.label_resetTime.text=mo.getTimeStr(e,!0):(t.label_resetTime.visible=!1,t.grp_reset.visible=!0)},r.setCDTime=function(e){var t=this;if(e>0){t.timeTrigger&&(tm.timer.remove(t.timeTrigger),t.timeTrigger=null);var i=Date.newDate(Date.newDate().getTime()+1e3*e),o=t.timeTrigger=new tm.Trigger(i);o.on(tm.Trigger.ON_SECOND,t.timeSec,t),o.on(tm.Trigger.ON_END,t.timeOut,t),tm.timer.add(o),t.grp_reset.visible=!1,t.label_resetTime.visible=!0,t.label_resetTime.text=mo.getTimeStr(1e3*e,!0)}else t.resetCdTimeView(0)},r.timeSec=function(e,t,i){var o=this,r=Date.newDate().getTime(),s=Date.newDate(i).getTime(),l=s-r;o.resetCdTimeView(l)},r.timeOut=function(e,t,i){var o=this;o.resetCdTimeView(0)},r.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null)},i}(mo.gui.Dlg);e.GuildCopy=t,egret.registerClass(t,"g_guildCopy.GuildCopy"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=t,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){gd.copyCtrl.getInfo(function(){t()},this)})})}(g_guildCopy||(g_guildCopy={}));var g_guildCopy;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),o=i.prototype;return o._childrenCreated=function(){e.prototype._childrenCreated.call(this)},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,i=t.data;t.img_boss.source=resHelper.getMonsterHeadIconPath(i),t.label_name.text=t.itemIndex+1+"."+mo.getJSONWithFileNameAndID(gc.cfg_t_monster,i)[gc.t_monster_name]},t}(mo.gui.ItemRenderer);e.GuildCopyBossItem=t,egret.registerClass(t,"g_guildCopy.GuildCopyBossItem")}(g_guildCopy||(g_guildCopy={}));var g_guildCopy;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var o=(__define,i),r=o.prototype;return r._initProp=function(){var i=this;t.prototype._initProp.call(this),i._layerOpt.shownWithAction=!1,i._Item_list_copys=e.GuildCopyBossItem,i.bossList=[]},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.registerClassByKey(gd.GuildCopyCtrl,gd.GuildCopyCtrl.ON_GUILD_COPY_CD_CLEAR,function(){e.setBossInfo(e.bossId)}),e.label_maxCD.text=gd.guildCopyCtrl.getGuildCopyCdState().threshold/60,e.bossAP=new g_base.ActionPlayer,e.bossAP.scaleX=e.bossAP.scaleY=1.6,e.ico_monster.source=e.bossAP,e.moduleParam&&(e.setData(e.moduleParam),e.moduleParam.fromMain||e.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,e.click_btn_close,e))},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=e.moduleParam.section,o=i[gc.t_guildCopy_id];e.img_title.source=i[gc.t_guildCopy_title_icon],e.bossList=gd.guildCopyCtrl.getGuildBossList(o);var r=gd.guildCopyCtrl.getCurBossId(o);e.bossId=r,e.list_copys.selectedItem=e.bossId,e.setBossInfo(r);var s=gd.guildCopyCtrl.getCompletedNum(o),l=gd.guildCopyCtrl.getGuildBossListLength(o);e.label_copyProgress.text=mo.STR.format("%s/%s",s,l)},r._tap_btn_enter=function(){var e=this;gd.guildCopyCtrl.guildStart(e.moduleParam.section[gc.t_guildCopy_id],e.bossId,function(){},e)},r._data_list_copys=function(){var e=this;return e.bossList},r._click_list_copys=function(e){var t=this,i=e.item;t.setBossInfo(i)},r.setBossInfo=function(e){var t=this;t.bossId=e;var i=gd.guildCopyCtrl;t.label_name.text=t.bossList.indexOf(t.bossId)+1+"."+mo.getJSONWithFileNameAndID(gc.cfg_t_monster,e)[gc.t_monster_name];var o=mo.getJSONWithFileNameAndID(gc.cfg_t_guildCopyBoss,e),r=o[gc.t_guildCopyBoss_lastShotAward],s=o[gc.t_guildCopyBoss_award];uiHelper.setItemsGrp(t.grp_passAward,utils.kvArrItems2ObjArr(r)),uiHelper.setItemsGrp(t.grp_waveAward,utils.kvArrItems2ObjArr(s));var l=i.getMaxKillTimes()-i.getGuildProgress(e);t.label_progress.text=mo.STR.format("%s/%s",l,i.getMaxKillTimes());var n=t.moduleParam.section[gc.t_guildCopy_id],g=i.getCurBossId(n),a=i.isBossKilled(n,e),d=g>=e;if(t.label_passPre.visible=!d,t.grp_fightable.visible=d,d){t.grp_fightable.visible=!a,t.label_getTips.visible=a,t.label_cd.visible=!1;var _=i.getGuildCopyCd();_&&(t.label_cd.visible=!0,t.label_cd.text=t._getColorCDStr(1e3*_),t.setCDTime(_))}else{var c=parseInt(e)-1;t.label_passPre.text=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,c)[gc.t_monster_name]}var u=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,e),m=u[gc.t_monster_displayID];t.bossAP.loadRes("m"+m+"_4s",!0),t.bossAP.playAction(),process.nextTick(function(){process.nextTick(function(){var e=t.list_copys.dataProvider.getItemIndex(t.bossId),i=130*(e>0?e-1:e);t.list_copys.scroller.throwHorizontally(i)})})},r._tap_btn_left=function(){var e=this,t=e.list_copys.dataGroup.horizontalScrollPosition;t-=130,e.list_copys.scroller.throwHorizontally(t)},r._tap_btn_right=function(){var e=this,t=e.list_copys.dataGroup.horizontalScrollPosition;t+=130,e.list_copys.scroller.throwHorizontally(t)},r._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:62}).show()},r._getColorCDStr=function(e){return mo.STR.format("[ubb color=%s]%s[/ubb]",gd.guildCopyCtrl.getGuildCopyCdState().needBuy?"red":"green",mo.getTimeStr(e,!0))},r.click_btn_close=function(){var e=this;mo.moduleMgr.runModule(g_consts.moduleId.guildCopy,{section:e.moduleParam.section}),e.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.click_btn_close,e)},r.resetCdTimeView=function(e){var t=this;e>0?t.label_cd.text=t._getColorCDStr(e):t.setBossInfo(t.bossId)},r.setCDTime=function(e){var t=this;if(e>0){t.timeTrigger&&(tm.timer.remove(t.timeTrigger),t.timeTrigger=null);var i=Date.newDate(Date.newDate().getTime()+1e3*e),o=t.timeTrigger=new tm.Trigger(i);o.on(tm.Trigger.ON_SECOND,t.timeSec,t),o.on(tm.Trigger.ON_END,t.timeOut,t),tm.timer.add(o),t.label_cd.visible=!0,t.label_cd.text=t._getColorCDStr(1e3*e)}else t.resetCdTimeView(0)},r.timeSec=function(e,t,i){var o=this,r=Date.newDate().getTime(),s=Date.newDate(i).getTime(),l=s-r;o.resetCdTimeView(l)},r.timeOut=function(e,t,i){var o=this;o.resetCdTimeView(0)},r.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null)},i}(mo.gui.Dlg);e.GuildCopyBoss=t,egret.registerClass(t,"g_guildCopy.GuildCopyBoss"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=t,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){"FightScene"==e.fromWhere?gd.copyCtrl.getInfo(function(e){t()},this):t()})})}(g_guildCopy||(g_guildCopy={}));