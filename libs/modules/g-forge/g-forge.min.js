var g_forge;!function(e){e.SUBMID_STR=0,e.SUBMID_STAR=1,e.SUBMID_GEM=2;var t=function(t){function r(){t.apply(this,arguments),this._btnStr=["btn_txt_g_strength","btn_txt_g_upstar","btn_txt_g_uplvl"]}__extends(r,t);var a=(__define,r),o=a.prototype;return o._initProp=function(){var r=this;t.prototype._initProp.call(this);var a={};a[0]=gc.c_prop.pointRedKey.role1_intensify,a[1]=gc.c_prop.pointRedKey.role2_intensify,a[2]=gc.c_prop.pointRedKey.role3_intensify;var o={};o[0]=gc.c_prop.pointRedKey.role1_star,o[1]=gc.c_prop.pointRedKey.role2_star,o[2]=gc.c_prop.pointRedKey.role3_star;var i={};i[0]=gc.c_prop.pointRedKey.role1_gem,i[1]=gc.c_prop.pointRedKey.role2_gem,i[2]=gc.c_prop.pointRedKey.role3_gem,r.redKeyArr=[a,o,i],r._comps=[],e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,r._heroChanged,r)},o._heroChanged=function(e){var t=this;t.setData({hec:e})},o.dtor=function(){t.prototype.dtor.call(this);var r=this;e.roleChgEmitter&&e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,r._heroChanged,r)},o._childrenCreated=function(){t.prototype._childrenCreated.call(this);var r=this,a=gc.c_prop.heroEquipIndex;for(var o in a){var i=r["eq_"+o];i&&i.onClick(r._onEquipItemClick,r,i)}r._comps.push(e.EquipStrBase.create().setData({tray:r.container}).show()),r._comps.push(e.EquipStrStar.create().setData({tray:r.container,delegate:r}).show()),r._comps.push(e.EquipStrGem.create().setData({tray:r.container}).show()),r.img_border_light.visible=!1,process.nextTick(function(){r.tab_str.selectedIndex=0,r.tabLastSelectIndex=0;var t=r.moduleParam.subModuleId;switch(t){case e.SUBMID_STR:r.tab_str.selectedIndex=0;break;case e.SUBMID_STAR:r.tab_str.selectedIndex=1;break;case e.SUBMID_GEM:r.tab_str.selectedIndex=2}var a=gd.heroCtrl.getMainHeroCtrl();r.setData({hec:a})})},o._getRealPart=function(){var e=this,t=e.hec,r=null!=e.part?e.part:t.getFirstEquipedPart();return r=t.isPartEquiped(r)?r:t.getFirstEquipedPart()},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.hec=e.get("hec"),e.part=e._getRealPart(),e.img_border_light.visible=e.hec.isNormalEquiped(),e.hec.isNormalEquiped()&&e._moveLightBorder(e["eq_"+e.part]),e._tap_tab_str()},o.updateEquipItems=function(){var e=this,t=e.tab_str.selectedIndex,r=e.hec,a=r.equipData,o=gc.c_prop.heroEquipIndex;for(var i in o){var n,s=a[i],l=parseInt(i),_=e["eq_"+i];if(_){switch(t){case 0:n={hec:r,part:l,equipId:s,showType:1,strLvl:r.getStrLvlByEquipPart(l)};break;case 1:n={hec:r,part:l,equipId:s,showType:2,starLvl:r.getStarLvlByEquipPart(l)};break;case 2:n={hec:r,part:l,equipId:s,showType:3,gemInfo:r.getGemInfoByPart(l)}}_.setData(n)}}},o._onEquipItemClick=function(e){var t=this,r=t.hec,a=e.part,o=r.isPartEquiped(a);return o?(t.part=a,t._moveLightBorder(e),void t._tap_tab_str()):mo.showMsg(gc.id_c_msgCode.noEquipNow)},o._moveLightBorder=function(e){var t=this,r=e.width,a=e.height,o=t.img_border_light.width,i=t.img_border_light.height;t.img_border_light.x=e.x-(o-r)/2+2,t.img_border_light.y=e.y-(i-a)/2+3},o._hideAllComp=function(){for(var e=this,t=0,r=e._comps.length;r>t;t++)e._comps[t].visible=!1},o._tap_tab_str=function(){var e,t=this,r=t.tab_str.selectedIndex,a=mo.getJSONWithFileName(gc.cfg_c_open);if(0==r?e=a[gc.id_c_open.strength][gc.c_open_lvlRequired]:1==r?e=a[gc.id_c_open.star][gc.c_open_lvlRequired]:2==r&&(e=a[gc.id_c_open.stone][gc.c_open_lvlRequired]),gd.userCtrl.getLvl()<e)return process.nextTick(function(){t.tab_str.selectedIndex=t.tabLastSelectIndex}),mo.showMsg(gc.id_c_msgCode.noRoleLvl,e);var o=t.hec.isNormalEquiped();o||(0!=t.tab_str.selectedIndex&&(process.nextTick(function(){t.tab_str.selectedIndex=0}),r=0),mo.showMsg(gc.id_c_msgCode.noEquipNow)),t.tabLastSelectIndex=r,t._hideAllComp();var i=t._comps[r];i.visible=!0,i.setData({hec:t.hec,part:t.part}),t.btn_do.icon=t._btnStr[r],t.updateEquipItems(),t._updateRed(),t._updateBtnVisible()},o._updateBtnVisible=function(){var e,t=this,r=t.tab_str.selectedIndex;t.label_open.visible=!1,0==r?(e=t.hec.getStrOpt(t.part),t.btn_do.visible=null!=e&&!e.strMax):1==r?(e=t.hec.getUpStarOpt(t.part),t.btn_do.visible=null!=e&&!e.strMax):2==r&&(e=t.hec.getUpGemOpt(t.part),t.btn_do.visible=null!=e&&!e.strMax,t.btn_do.visible&&(t.btn_do.visible=e.roleLvlEnough,t.label_open.visible=!e.roleLvlEnough,t.label_open.text=e.nextNeedLvl))},o._tap_btn_do=function(){var e,t,r=this,a=r.tab_str.selectedIndex;0==a?(e=r.hec.getStrOpt(r.part),e.stoneEnough?r.hec.strength(e,function(){r.dataChanged()},r):(t=gc.c_prop.spItemIdKey.intensify,g_base.GainWay.canBuyFromShop(t)?g_base.GainWayShop.create().setData({itemId:t,count:e.costStone-e.stone}).show().onClose(function(){r.dataChanged()}):g_base.GainWay.create().setData({itemId:t}).show())):1==a?(e=r.hec.getUpStarOpt(r.part),e.stoneEnough?r.hec.upStar(e,function(){r.dataChanged()},r):(t=gc.c_prop.spItemIdKey.starStone,g_base.GainWay.canBuyFromShop(t)?g_base.GainWayShop.create().setData({itemId:t,count:e.costStone-e.stone}).show().onClose(function(){r.dataChanged()}):g_base.GainWay.create().setData({itemId:t}).show())):2==a&&(e=r.hec.getUpGemOpt(r.part),e.stoneEnough?r.hec.upGem(e,function(){r.dataChanged()},r):(t=e.gemDebrisId,g_base.GainWay.canBuyFromShop(t)?g_base.GainWayShop.create().setData({itemId:t,count:e.costGemDebris-e.gemDebris}).show().onClose(function(){r.dataChanged()}):g_base.GainWay.create().setData({itemId:t}).show()))},o._tap_btn_help=function(){var e=this,t=e.tab_str.selectedIndex,r=[8,9,10];g_base.BaseShowTip.create().setData({id:r[t]}).show()},o._tap_btn_back=function(){mo.moduleMgr.runModule(g_consts.moduleId.fight)},o._updateRed=function(){var e=this,t=gd.heroCtrl.getHeroIndex(e.hec),r=e.redKeyArr;e.img_red0.visible=gd.pointCtrl.isShow(r[0][t]),e.img_red1.visible=gd.pointCtrl.isShow(r[1][t]),e.img_red2.visible=gd.pointCtrl.isShow(r[2][t])},r}(mo.gui.Layer);e.ForgeLayer=t,egret.registerClass(t,"g_forge.ForgeLayer")}(g_forge||(g_forge={}));var g_forge;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var a=(__define,r),o=a.prototype;return o._initProp=function(){t.prototype._initProp.call(this)},o._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.registerClassByKey(gd.HeroEntityCtrl,gd.HeroEntityCtrl.ON_EQUIP_STR,function(){e._efxPlayer.play()}),e.img_cost.source=resHelper.getItemIconPath(gc.c_prop.spItemIdKey.intensify),e._efxPlayer=uiHelper.EfxPlayer.createPlayer(e.efx)},o._getRealPart=function(){var e=this,t=e.data.hec,r=null!=e.data.part?e.data.part:t.getFirstEquipedPart();return r=t.isPartEquiped(r)?r:t.getFirstEquipedPart()},o._showEmpty=function(){var e=this;e.label_cost_stone.text=[gd.userCtrl.getItemNum(gc.c_prop.spItemIdKey.intensify),0],e.label_cost_gold.text="0",e.label_curProp.visible=!1,e.label_nextProp.visible=!1,e.grp_noMax.visible=!1,e.grp_max.visible=!1,e.label_noRefineLv.visible=!1,e.ico_refine.visible=!1},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,r=e.data.hec;if(!r)return void e._showEmpty();var a=e._getRealPart();if(e.part_item.setData({part:a}),null==a)return void e._showEmpty();e.label_curProp.visible=!0,e.label_nextProp.visible=!0;var o=r.getStrOpt(a),i=o.curStrInfo[1],n=o.curStrInfo[2];if(e.label_curProp.text=[gc.c_prop.heroProp[i],n],e.grp_noMax.visible=!o.strMax,e.grp_max.visible=o.strMax,!o.strMax){e.label_cost_stone.text=[o.stone,o.costStone],e.label_cost_gold.text=o.costGold;var i=o.nextStrInfo[1],n=o.nextStrInfo[2];e.label_nextProp.text=[gc.c_prop.heroProp[i],n]}e.label_nextProp.visible=!o.strMax;var o=r.getStrOpt(a),s=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.equipRefineCfg);o.strengthLvl>=s[0]?(e.ico_refine.visible=!0,e.label_noRefineLv.visible=!1):(e.ico_refine.visible=!1,e.label_noRefineLv.visible=!0,e.label_noRefineLv.text=s[0])},o._tap_ico_refine=function(){var t=this,r=t.data.hec,a=t._getRealPart();e.RefineLayer.create().setData({hec:r,part:a}).show().onClose(function(){t.dataChanged()})},r}(mo.gui.Layer);e.EquipStrBase=t,egret.registerClass(t,"g_forge.EquipStrBase")}(g_forge||(g_forge={}));var g_forge;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),a=r.prototype;return a._initProp=function(){e.prototype._initProp.call(this)},a._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.registerClassByKey(gd.HeroEntityCtrl,gd.HeroEntityCtrl.ON_EQUIP_UPSTAR,function(){t._efxPlayer.play()}),t.img_cost.source=resHelper.getItemIconPath(gc.c_prop.spItemIdKey.starStone),t._efxPlayer=uiHelper.EfxPlayer.createPlayer(t.efx),t._winEfxPlayer=uiHelper.EfxPlayer.create(t.effect_win),t._failEfxPlayer=uiHelper.EfxPlayer.create(t.effect_fail)},a._getRealPart=function(){var e=this,t=e.data.hec,r=null!=e.data.part?e.data.part:t.getFirstEquipedPart();return r=t.isPartEquiped(r)?r:t.getFirstEquipedPart()},a._showEmpty=function(){var e=this;e.label_prop_base.text="0",e.label_prop_next.text="0",e.label_cost_stone.text=[gd.userCtrl.getItemNum(gc.c_prop.spItemIdKey.starStone),0],e.label_cost_gold.text="0"},a.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data.hec;if(!r)return void t._showEmpty();var a=t._getRealPart();if(t.part_item.setData({part:a}),null==a)return void t._showEmpty();t.label_prop_base.visible=!0,t.label_prop_next.visible=!0;var o=r.getUpStarOpt(a);o.topNeed?(t.grp_tupo.visible=!0,t.label_costDesc.text="突破\n消耗",t.label_cost_stone.text=[o.stone,o.topCostStone],t.label_cost_gold.text=o.topCostGold):(t.grp_tupo.visible=!1,t.label_costDesc.text="升星\n消耗",o.strMax||(t.label_cost_stone.text=[o.stone,o.costStone],t.label_cost_gold.text=o.costGold)),t.grp_max.visible=o.strMax&&o.topMax,t.grp_noMax.visible=!t.grp_max.visible,t.label_star.text=o.starLvl,t.label_tupo.text=o.topLv,t.label_prop_base.text=o.curProp[1],t.label_prop_next.text=o.nextProp[1],t.label_tupoProp.text=[gc.c_prop.heroProp[o.topCurProp[0]],o.topCurProp[1]]},a._tap_btn_tupo=function(){var e=this,t=e.data.hec,r=e._getRealPart(),a=t.getUpStarOpt(r);if(a.topStoneEnough)t.starTop(a,function(t){var r=t[0];r?e._winEfxPlayer.play():e._failEfxPlayer.play(),e.data.delegate.dataChanged(),e.dataChanged()},e);else{var o=gc.c_prop.spItemIdKey.starStone;g_base.GainWay.canBuyFromShop(o)?g_base.GainWayShop.create().setData({itemId:o,count:a.costStone-a.stone}).show().onClose(function(){e.dataChanged()}):g_base.GainWay.create().setData({itemId:o}).show()}},t}(mo.gui.Layer);e.EquipStrStar=t,egret.registerClass(t,"g_forge.EquipStrStar")}(g_forge||(g_forge={}));var g_forge;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),a=r.prototype;return a._initProp=function(){e.prototype._initProp.call(this)},a._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.registerClassByKey(gd.HeroEntityCtrl,gd.HeroEntityCtrl.ON_EQUIP_UPGEM,function(){t._efxPlayer.play()}),t._efxPlayer=uiHelper.EfxPlayer.createPlayer(t.efx)},a._getRealPart=function(){var e=this,t=e.data.hec,r=null!=e.data.part?e.data.part:t.getFirstEquipedPart();return r=t.isPartEquiped(r)?r:t.getFirstEquipedPart()},a._showEmpty=function(){var e=this;e.gem_stone.setData({hec:e.data.hec}),e.label_cost_stone.text=[0,0]},a.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data.hec;if(!r)return void t._showEmpty();var a=t._getRealPart();if(t.part_item.setData({part:a}),null==a)return void t._showEmpty();t.gem_stone.setData({hec:r,part:a});var o=r.getUpGemOpt(a);t.grp_noMax.visible=!o.strMax,t.grp_max.visible=o.strMax,o.strMax||(t.label_cost_stone.text=[o.gemDebris,o.costGemDebris],t.img_cost.source=resHelper.getItemIconPath(o.gemDebrisId))},t}(mo.gui.Layer);e.EquipStrGem=t,egret.registerClass(t,"g_forge.EquipStrGem")}(g_forge||(g_forge={}));var g_forge;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var a=(__define,r),o=a.prototype;return o._initProp=function(){var r=this;t.prototype._initProp.call(this),e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,r._heroChanged,r)},o._heroChanged=function(e){var t=this;t.setData({hec:e})},o.onEnter=function(){t.prototype.onEnter.call(this),e.baseBottomBar.visible=!1},o.onExit=function(){t.prototype.onExit.call(this);e.baseBottomBar&&(e.baseBottomBar.visible=!0)},o.dtor=function(){t.prototype.dtor.call(this);var r=this;e.roleChgEmitter&&e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,r._heroChanged,r)},o._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.gold.toString(),e.dataChanged),e.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.diamond.toString(),e.dataChanged),e.hec=e.get("hec"),e.part=e.get("part");var r=gc.c_prop.heroEquipIndex;for(var a in r){var o=e["eq_"+a];o&&o.onClick(e._onEquipItemClick,e,o)}e.img_border_light.visible=!1,e.img_cost.source=resHelper.getItemIconPath(gc.c_prop.spItemIdKey.intensify),e.ico_stone.source=resHelper.getItemIconPath(gc.c_prop.spItemIdKey.intensify),e._winEfxPlayer=uiHelper.EfxPlayer.create(e.effect_win),e._critEfxPlayer=uiHelper.EfxPlayer.create(e.effect_crit),e._failEfxPlayer=uiHelper.EfxPlayer.create(e.effect_fail),e._downEfxPlayer=uiHelper.EfxPlayer.create(e.effect_downLv)},o._getRealPart=function(){var e=this,t=e.data.hec,r=null!=e.data.part?e.data.part:t.getFirstEquipedPart();return r=t.isPartEquiped(r)?r:t.getFirstEquipedPart()},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.hec=e.get("hec");var r=(e.data.hec,e._getRealPart());e.part_item.setData({part:r}),null==r&&e._showEmpty(),e.img_border_light.visible=e.hec.isNormalEquiped(),e.hec.isNormalEquiped()&&(e._moveLightBorder(e["eq_"+e.part]),e.updateItem()),e.updateEquipItems()},o.updateEquipItems=function(){var e=this,t=e.hec,r=t.equipData,a=gc.c_prop.heroEquipIndex;for(var o in a){var i,n=r[o],s=parseInt(o),l=e["eq_"+o];l&&(i={hec:t,part:s,equipId:n,showType:4,strLvl:t.getStrLvlByEquipPart(s)},l.setData(i))}},o._onEquipItemClick=function(e){var t=this,r=t.hec,a=e.part,o=r.isPartEquiped(a);return o?(t.part=a,t._moveLightBorder(e),void t.updateItem()):mo.showMsg(gc.id_c_msgCode.noEquipNow)},o._showEmpty=function(){var e=this;e.label_cost_stone.text=[gd.userCtrl.getItemNum(gc.c_prop.spItemIdKey.intensify),0],e.label_cost_gold.text="0",e.label_curProp.visible=!1,e.label_nextProp.visible=!1,e.grp_jinglian.visible=!1},o.updateItem=function(){var e=this,t=e.data.hec;if(!t)return void e._showEmpty();if(null==e._getRealPart())return void e._showEmpty();var r,e=this,a=mo.getJSONWithFileName(gc.cfg_c_open);if(r=a[gc.id_c_open.strength][gc.c_open_lvlRequired],gd.userCtrl.getLvl()<r)return mo.showMsg(gc.id_c_msgCode.noRoleLvl,r);var o=e.hec.isNormalEquiped();if(!o)return mo.showMsg(gc.id_c_msgCode.noEquipNow);var i=e.part;if(e.part_item.setData({part:i}),null==i)return void e._showEmpty();e.label_curProp.visible=!0,e.label_nextProp.visible=!0;var n=t.getRefineOpt(i),s=n.curRefineInfo[1],l=n.curRefineInfo[2];if(e.label_curProp.text=[gc.c_prop.heroProp[s],(100*l).toFixed(1)],e.lable_curLv.text=n.refineLv,e.grp_jinglian.visible=!n.isMax,e.label_nextProp.visible=!n.isMax,e.label_max.visible=n.isMax,e.label_cannot.visible=!1,!n.isMax){e.label_cost_stone.text=n.costStone,e.label_cost_gold.text=n.costGold;var s=n.nextRefineInfo[1],l=n.nextRefineInfo[2];e.label_nextProp.text=[gc.c_prop.heroProp[s],(100*l).toFixed(1)],n.strengthLvl>=n.needStrLv?(e.grp_jinglian.visible=!0,e.label_cannot.visible=!1):(e.grp_jinglian.visible=!1,e.label_cannot.visible=!0,e.label_cannot.text=n.needStrLv)}e.label_gold.text=gd.userCtrl.getGold().toString(),e.label_yuanbao.text=gd.userCtrl.getDiamond().toString(),e.label_stone.text=n.stone,e.label_nextProp.visible=!n.isMax},o._moveLightBorder=function(e){var t=this,r=e.width,a=e.height,o=t.img_border_light.width,i=t.img_border_light.height;t.img_border_light.x=e.x-(o-r)/2+2,t.img_border_light.y=e.y-(i-a)/2+3},o._tap_btn_do=function(){var e,t,r=this;e=r.hec.getRefineOpt(r.part),e.stoneEnough?r.hec.equipRefine(e,function(e){var t=e[0],a=e[2],o=e[3];t?(r._winEfxPlayer.play(),a&&r._critEfxPlayer.play()):(r._failEfxPlayer.play(),o&&r._downEfxPlayer.play()),r.dataChanged()},r):(t=gc.c_prop.spItemIdKey.intensify,g_base.GainWay.canBuyFromShop(t)?g_base.GainWayShop.create().setData({itemId:t,count:e.costStone-e.stone}).show().onClose(function(){r.dataChanged()}):g_base.GainWay.create().setData({itemId:t}).show())},o._tap_btn_help=function(){var e=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.equipRefineCfg);g_base.BaseShowTip.create().setData({id:46,param1:e[0]}).show()},o._tap_btn_back=function(){this.close()},r}(mo.gui.Layer);e.RefineLayer=t,egret.registerClass(t,"g_forge.RefineLayer")}(g_forge||(g_forge={}));var g_forge;!function(e){logger.initLogger(e,"g-forge"),logger.setLvl("g-forge",4);var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var a=(__define,r),o=a.prototype;return o.show=function(){var r=this;t.prototype.show.call(this),g_base.modIdx=3;var a=g_base.BaseTopRole.create().setData({redType:1}).show();e.roleChgEmitter=a.emitter,a.hide4thRole(!1);var o=e.ForgeLayer.create();o.moduleParam=r.moduleParam,o.show(),e.baseBottomBar=g_base.BaseBottomBar.create().show()},o.dtor=function(){t.prototype.dtor.call(this),e.roleChgEmitter=null},r}(mo.gui.UIScene);e.ForgeScene=t,egret.registerClass(t,"g_forge.ForgeScene"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,e.onValid(function(e){var t,r=mo.getJSONWithFileName(gc.cfg_c_open);return e&&(0==e.subModuleId?t=r[gc.id_c_open.strength][gc.c_open_lvlRequired]:1==e.subModuleId?t=r[gc.id_c_open.star][gc.c_open_lvlRequired]:2==e.subModuleId&&(t=r[gc.id_c_open.stone][gc.c_open_lvlRequired])),null!=t&&t>gd.userCtrl.getLvl()?(mo.showMsg(gc.id_c_msgCode.noRoleLvl,t),!1):!0}),e.onPreAsync(function(e,t){t()}),mo.moduleMgr.registerModule(e)})}(g_forge||(g_forge={}));