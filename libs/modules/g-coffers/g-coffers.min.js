var g_coffers;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),s=o.prototype;return s._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,e.registerClassByKey(gd.CoffersCtrl,gc.dsConsts.CoffersEntity.buildValue.toString(),this.buildValueChanged),e.registerClassByKey(gd.CoffersCtrl,gc.dsConsts.CoffersEntity.resource.toString(),this.coffersChanged),e.registerClassByKey(gd.CoffersCtrl,gc.dsConsts.CoffersEntity.lootResource.toString(),this.coffersChanged),e.registerClassByKey(gd.CoffersCtrl,gc.dsConsts.CoffersEntity.beLootResource.toString(),this.coffersChanged)},s._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e._tap_tab_btn()},s.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.coffersChanged(),e.buildValueChanged()},s.coffersChanged=function(){var e=this,t=e.data;e.label_gold.text=gd.coffersCtrl.getPersonResource().toString(),e.label_coffer.text=utils.formatByWan2(t[gc.dsConsts.CoffersEntity.resource]),e.label_rob.text=utils.formatByWan2(t[gc.dsConsts.CoffersEntity.lootResource]),e.label_robed.text=utils.formatByWan2(t[gc.dsConsts.CoffersEntity.beLootResource])},s.buildValueChanged=function(){var e=this,t=gd.coffersCtrl.getData(),r=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers),o=t[gc.dsConsts.CoffersEntity.lvl],s=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.initCfg);if(o>=s[6])e.label_maxLevel.visible=!0,e.grp_next.visible=!1;else{e.label_maxLevel.visible=!1,e.grp_next.visible=!0;var a=o+1,f=mo.getJSONWithFileNameAndID(gc.cfg_c_lvl,a);e.label_nextLv.text=a+"级",e.label_nextCoffer.text=utils.formatByWan2(f[gc.c_lvl_coffersBase]),e.label_nextAddProp.text=(f[gc.c_lvl_cofferPower]/100).toFixed(1)+"%"}var i=gd.coffersCtrl.getBuildNum(),n=mo.getJSONWithFileNameAndID(gc.cfg_c_vip,gd.userCtrl.getVip());e.label_lv.text=t[gc.dsConsts.CoffersEntity.lvl]+"级";var c=mo.getJSONWithFileNameAndID(gc.cfg_c_lvl,o);e.label_curLv.text=o+"级",e.label_curCoffer.text=utils.formatByWan2(c[gc.c_lvl_coffersBase]),e.label_curAddProp.text=(c[gc.c_lvl_cofferPower]/100).toFixed(1)+"%",e.bar_build.maximum=c[gc.c_lvl_cofferExpc],e.bar_build.value=t[gc.dsConsts.CoffersEntity.buildValue],e.label_vip.text=gd.userCtrl.getVip().toString(),e.label_leftCount.text=n[gc.c_vip_coffersBuild]-i+"/"+n[gc.c_vip_coffersBuild],i<n[gc.c_vip_coffersBuild]?(e.label_add1.text=""+r[14],e.label_add2.text="建设值+"+r[4],e.label_cannotBuild.visible=!1,e.grp_canBuild.visible=!0):(e.label_cannotBuild.visible=!0,e.grp_canBuild.visible=!1),e.label_addProp.text=mo.STR.format("守卫生命+%s%(国库加成)",(c[gc.c_lvl_cofferPower]/100).toFixed(1)),e.label_addProp1.text=mo.STR.format("守卫攻击+%s%(激励加成)",gd.coffersCtrl.getAddPropByBuff().toFixed(1))},s.setDefeseData=function(e){var t=this;t.defUsers=e;for(var r=[0,"ico_wangcengbazu","ico_shalukuangmo","ico_jigjidasii","ico_zhanglijingying"],o=0;4>o;++o){var s=e[o],a=s[gc.dsConsts.CofferUser.rankType],f=s[gc.dsConsts.CofferUser.name],i=s[gc.dsConsts.CofferUser.combat],n=s[gc.dsConsts.CofferUser.icon],c=s[gc.dsConsts.CofferUser.lvl],l=s[gc.dsConsts.CofferUser.door],g=s[gc.dsConsts.CofferUser.medalTitle]||0;t["label_name"+l].text=f,t["label_lv"+l].text="Lv."+c,t["label_combat"+l].text=i,t["ico_face"+l].source=uiHelper.getHeroIcon(n,0),t["ico_rank"+l].source=r[a],0!=g?(t["ico_medal"+l].setData({itemId:g}),t["ico_medal"+l].visible=!0):t["ico_medal"+l].visible=!1}},s._tap_grp_def0=function(){var e=this;e.lookUserInfo(0)},s._tap_grp_def1=function(){var e=this;e.lookUserInfo(1)},s._tap_grp_def2=function(){var e=this;e.lookUserInfo(2)},s._tap_grp_def3=function(){var e=this;e.lookUserInfo(3)},s.lookUserInfo=function(e){for(var t,r=this,o=0;o<r.defUsers.length;++o){var s=r.defUsers[o],a=s[gc.dsConsts.CofferUser.door];if(a==e){t=s;break}}if(t){var f=t[gc.dsConsts.CofferUser.userId];mo.moduleMgr.pushModule(g_consts.moduleId.roleEnemyInfo,{userId:f})}},s._tap_btn_heroRec=function(){gd.coffersCtrl.getLootRecordArr(function(t){e.CoffersHeroRecDlg.create().setData({recs:t}).show()},this)},s._tap_btn_build=function(){gd.coffersCtrl.build(function(){},this)},s._tap_btn_defRec=function(){gd.coffersCtrl.getDefeseRecord(function(t){e.CoffersDefenceRecDlg.create().setData({recs:t}).show()},this)},s._tap_tab_btn=function(){var e=this,t=e.tab_btn.selectedIndex;e.grp_coffers.visible=0==t,e.grp_build.visible=1==t,e.grp_defence.visible=2==t,2==t&&gd.coffersCtrl.getDefeseData(function(t){t.length>0?e.setDefeseData(t):(e.tab_btn.selectedIndex=0,e._tap_tab_btn(),mo.showMsg(gc.id_c_msgCode.haveNoGuard))},e)},s._tap_btn_close=function(){mo.moduleMgr.runModule(g_consts.moduleId.home)},s._tap_btn_help=function(){var e=this,t=e.tab_btn.selectedIndex;0==t?g_base.BaseShowTip.create().setData({id:33}).show():1==t?g_base.BaseShowTip.create().setData({id:34}).show():2==t&&g_base.BaseShowTip.create().setData({id:35}).show()},s._tap_btn_jili=function(){var t=this;e.CoffersJili.create().show().onClose(function(){t.dataChanged()})},r}(mo.gui.Layer);e.CoffersLayer=t,egret.registerClass(t,"g_coffers.CoffersLayer")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),s=o.prototype;return s.show=function(){var r=this;t.prototype.show.call(this),e.CoffersLayer.create().setData(r.moduleParam.data).show()},r}(mo.gui.UIScene);e.CoffersScene=t,egret.registerClass(t,"g_coffers.CoffersScene"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=t,e.sysId=gc.id_c_open.coffers,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){gd.coffersCtrl.getInfo(function(r){e.data=r,t()},this)})})}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),o=r.prototype;return o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data;if(r[gc.dsConsts.CoffersRecord.time]){var o,s=r[gc.dsConsts.CoffersRecord.isWin],a=Date.newDate(r[gc.dsConsts.CoffersRecord.time]),f=r[gc.dsConsts.CoffersRecord.serverName],i=r[gc.dsConsts.CoffersRecord.attackName],n=r[gc.dsConsts.CoffersRecord.door],c=r[gc.dsConsts.CoffersRecord.defeseName];r[gc.dsConsts.CoffersRecord.recource];s?(t.ico_def.source="ico_pvp_fail",o="[%s]来自[ubb color=#fd68ff]%s[/ubb]的[ubb color=red]%s[/ubb]击败了%s守卫[ubb color=#00cdff]%s[/ubb]，我服国库%s门被击破！",o=mo.STR.format(o,a.toFormat("HH24:MI"),f,i,gc.c_prop.offersDoor[n],c,gc.c_prop.offersDoor[n])):(t.ico_def.source="ico_pvp_win",o="[%s]来自[ubb color=#fd68ff]%s[/ubb]的[ubb color=red]%s[/ubb]攻击了我服国库%s门，被该门守卫[ubb color=#00cdff]%s[/ubb]击败，灰溜溜得逃走了。",o=mo.STR.format(o,a.toFormat("HH24:MI"),f,i,gc.c_prop.offersDoor[n],c)),t.label_desc.text=o}},t}(mo.gui.ItemRenderer);e.CoffersDefenceRecCell=t,egret.registerClass(t,"g_coffers.CoffersDefenceRecCell")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),s=o.prototype;return s._initProp=function(){var r=this;t.prototype._initProp.call(this),r._layerOpt.shownWithAction=!1,r._Item_list_rec=e.CoffersDefenceRecCell},s._childrenCreated=function(){t.prototype._childrenCreated.call(this)},s.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.data},s._data_list_rec=function(){var e=this;return e.data.recs},r}(mo.gui.Dlg);e.CoffersDefenceRecDlg=t,egret.registerClass(t,"g_coffers.CoffersDefenceRecDlg")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),o=r.prototype;return o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data;if(r[gc.dsConsts.CoffersRecord.time]){var o=Date.newDate(r[gc.dsConsts.CoffersRecord.time]),s=r[gc.dsConsts.CoffersRecord.serverName],a=r[gc.dsConsts.CoffersRecord.attackName],f=r[gc.dsConsts.CoffersRecord.door],i=r[gc.dsConsts.CoffersRecord.defeseName],n=r[gc.dsConsts.CoffersRecord.points],c="[%s][ubb color=#00cdff]%s[/ubb]击破了[ubb color=#fd68ff]%s[/ubb]的%s守卫[ubb color=red]%s[/ubb]，为我服贡献了[ubb color=yellow]%s[/ubb]跨服积分！";c=mo.STR.format(c,o.toFormat("HH24:MI"),a,s,gc.c_prop.offersDoor[f],i,n),t.label_desc.text=c}},t}(mo.gui.ItemRenderer);e.CoffersHeroRecCell=t,egret.registerClass(t,"g_coffers.CoffersHeroRecCell")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),s=o.prototype;return s._initProp=function(){var r=this;t.prototype._initProp.call(this),r._layerOpt.shownWithAction=!1,r._Item_list_rec=e.CoffersHeroRecCell},s._childrenCreated=function(){t.prototype._childrenCreated.call(this)},s.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.data},s._data_list_rec=function(){var e=this;return e.data.recs},r}(mo.gui.Dlg);e.CoffersHeroRecDlg=t,egret.registerClass(t,"g_coffers.CoffersHeroRecDlg")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=__define,s=r,a=s.prototype;return a._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,e.registerClassByKey(gd.CoffersCtrl,gd.CoffersCtrl.ON_COFFERS_DEF_DATA_CHANGED,e.onDefDataChanged)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this)},a.onEnter=function(){t.prototype.onEnter.call(this);var e=this;e.timerId=setInterval(e.checkLeftTime,1e3,e)},a.onExit=function(){t.prototype.onExit.call(this);var e=this;clearInterval(e.timerId)},a.onDefDataChanged=function(e){var t=this;t.setData(e)},a.checkLeftTime=function(e){var t=e.data;if(t){for(var r=t[gc.dsConsts.ExDefenceData.cofferUserArr],o=0;4>o;++o){var s=r[o];if(s){var a=s[gc.dsConsts.CofferUser.door],f=s[gc.dsConsts.CofferUser.breakReplaySeconds]-(Date.newDate().getTime()-e.startTime)/1e3,i=f/60>>0;e["label_time"+a].text=f>0?i||1:0,e["label_time"+a].visible=f>0,e["ico_state"+a].source=f>0?"ico_yijipo":null}}e.breakNum>0?e.label_rate.text="掠夺倍率：×"+t[gc.dsConsts.ExDefenceData.lootRate]:e.label_rate.text="击破任一守卫即可掠夺"}},o(a,"breakNum",function(){for(var e=this,t=e.data,r=t[gc.dsConsts.ExDefenceData.cofferUserArr],o=0,s=0;4>s;++s){var a=r[s];if(a){var f=(a[gc.dsConsts.CofferUser.door],a[gc.dsConsts.CofferUser.breakReplaySeconds]-(Date.newDate().getTime()-e.startTime)/1e3);o+=f>0?1:0}}return o}),a.dataChanged=function(){t.prototype.dataChanged.call(this);for(var e=this,r=e.data,o=r[gc.dsConsts.ExDefenceData.cofferUserArr],s=["ico_yijipo","ico_yilueduojipo"],a=0;4>a;++a){var f=o[a];if(f){var i=f[gc.dsConsts.CofferUser.door],n=f[gc.dsConsts.CofferUser.name],c=f[gc.dsConsts.CofferUser.icon],l=(f[gc.dsConsts.CofferUser.lvl],f[gc.dsConsts.CofferUser.medalTitle]||0);e["label_name"+i].text=n,e["ico_face"+i].source=uiHelper.getHeroIcon(c,0),e["ico_state"+i].source=f[gc.dsConsts.CofferUser.isBreak]?s[0]:null,0!=l?(e["ico_medal"+i].setData({itemId:l}),e["ico_medal"+i].visible=!0):e["ico_medal"+i].visible=!1}}e.startTime=Date.newDate().getTime(),e.checkLeftTime(e),e.label_addProp.text="+"+(100*r[gc.dsConsts.ExDefenceData.hpAdd]||0).toFixed(1)+"%(国库加成)",e.label_addProp2.text="+"+(100*r[gc.dsConsts.ExDefenceData.attackAdd]||0).toFixed(1)+"%(激励加成)";var g=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers3),d=g[4].split(",");e.ico_item.source=resHelper.getItemIconPath(d[0]),e.label_item.text=d[1],e.label_win.text=gd.coffersCtrl.getCoffersWin(),e.label_score.text=gd.coffersCtrl.getNextWinPoints()},a._tap_grp_def0=function(){var e=this;e.startFightAt(0)},a._tap_grp_def1=function(){var e=this;e.startFightAt(1)},a._tap_grp_def2=function(){var e=this;e.startFightAt(2)},a._tap_grp_def3=function(){var e=this;e.startFightAt(3)},a.startFightAt=function(e){for(var t,r=this,o=r.data,s=o[gc.dsConsts.ExDefenceData.cofferUserArr],a=0;4>a;++a)if(t=s[a]){var f=t[gc.dsConsts.CofferUser.door];if(f==e)break}var i=t[gc.dsConsts.CofferUser.serverId],f=t[gc.dsConsts.CofferUser.door],n=t[gc.dsConsts.CofferUser.isLoot],c=t[gc.dsConsts.CofferUser.isBreak];return n?mo.showMsg(gc.id_c_msgCode.gatesRobed):c?mo.showMsg(gc.id_c_msgCode.gatesBroken):void gd.coffersCtrl.fightStart(i,f,function(){},this)},a._tap_ico_rob=function(){var t=this,r=t.data;t.breakNum>0?(r[gc.dsConsts.ExDefenceData.breakNum]=t.breakNum,e.CoffersRob.create().setData(t.data).show()):mo.showMsg(gc.id_c_msgCode.noGuardDown)},a._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:37}).show()},r}(mo.gui.Dlg);e.CoffersSelectDefence=t,egret.registerClass(t,"g_coffers.CoffersSelectDefence")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),s=o.prototype;return s.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,r=e.data;if(r[gc.dsConsts.CoffersServer.serverName]){e.label_name.text=r[gc.dsConsts.CoffersServer.serverName];for(var o=r[gc.dsConsts.CoffersServer.isLootArr],s=r[gc.dsConsts.CoffersServer.isBreakArr],a=0;4>a;++a)e["label_state"+a].text=e.getStateStr(o[a],s[a]),e["label_state"+a].textColor=e.getStateColor(o[a],s[a]);e.label_coffer.text=utils.formatByWan(r[gc.dsConsts.CoffersServer.resource],0)}},s.getStateStr=function(e,t){return t?"已被击破":"可攻击"},s.getStateColor=function(e,t){return e?12103599:t?12103599:65280},s._tap_btn_rob=function(){var t=this,r=t.data,o=mo.getJSONWithFileNameAndID(gc.cfg_c_open,gc.id_c_open.serverPk);if(gd.userCtrl.getLvl()<o[gc.c_open_lvlRequired])return mo.showMsg(gc.id_c_msgCode.noRoleLvl,o[gc.c_open_lvlRequired]);var s=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers),a=s[12],f=s[13],i=Date.newDate();return i.getHours()<a||i.getHours()>f?mo.showMsg(gc.id_c_msgCode.peaceTimeCantRobe,a,f):void gd.coffersCtrl.getEnemyDefeseData(r[gc.dsConsts.CoffersServer.serverId],r[gc.dsConsts.CoffersServer.serverName],function(r){e.CoffersSelectDefence.create().setData(r).show().onClose(function(){t.delegate.reset()})},t)},r}(mo.gui.ItemRenderer);e.CoffersServerCell=t,egret.registerClass(t,"g_coffers.CoffersServerCell")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),s=o.prototype;return s._initProp=function(){var r=this;t.prototype._initProp.call(this),r._layerOpt.shownWithAction=!1,r._Item_list_server=e.CoffersServerCell},s._childrenCreated=function(){t.prototype._childrenCreated.call(this);var r=this;if(r.moduleParam){r.setData(r.moduleParam.data);var o=r.moduleParam.defData;if(o)if(1==r.moduleParam.page)e.CoffersSelectDefence.create().setData(o).show();else if(2==r.moduleParam.page){var s=o[gc.dsConsts.ExDefenceData.breakNum];s>0?e.CoffersRob.create().setData(o).show():e.CoffersSelectDefence.create().setData(o).show()}}r.apChange()},s.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null)},s.reset=function(){var e=this;gd.coffersCtrl.getServerArr(function(t){e.setData({list:t})},e)},s.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,r=(e.data,mo.getJSONWithFileNameAndID(gc.cfg_c_open,gc.id_c_open.serverPk));gd.userCtrl.getLvl()<r[gc.c_open_lvlRequired]&&(e.grp_ap.visible=!1);var o=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers);e.label_robTime.text=(o[12]>9?o[12]:"0"+o[12])+":00--"+(o[13]>9?o[13]:"0"+o[13])+":00",e.setCDTime(gd.coffersCtrl.getActionReseconds())},s.apChange=function(){var e=this;e.label_ap.text=gd.coffersCtrl.getReAction().toString()},s._data_list_server=function(){var e=this;return e.data.list},s._tap_btn_help=function(){var e=mo.getJSONWithFileNameAndID(gc.cfg_c_open,gc.id_c_open.serverPk),t=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers),r=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers3);g_base.BaseShowTip.create().setData({id:36,param1:e[gc.c_open_lvlRequired],param2:r[3]/60>>0,param3:t[8]}).show()},s._tap_btn_score=function(){gd.coffersCtrl.getInfo(function(t){e.CoffersScore.create().show()},this)},s.setCDTime=function(e){var t=this;if(e>0){t.timeTrigger&&(tm.timer.remove(t.timeTrigger),t.timeTrigger=null);var r=Date.newDate(Date.newDate().getTime()+1e3*e),o=t.timeTrigger=new tm.Trigger(r);o.on(tm.Trigger.ON_SECOND,t.timeSec,t),o.on(tm.Trigger.ON_END,t.timeOut,t),tm.timer.add(o),t.resetCdTimeView(1e3*e)}else t.resetCdTimeView(0)},s.timeSec=function(e,t,r){var o=this,s=Date.newDate().getTime(),a=Date.newDate(r).getTime(),f=a-s;o.resetCdTimeView(f)},s.timeOut=function(e,t,r){var o=this;o.resetCdTimeView(0),o.setCDTime(gd.coffersCtrl.getActionReseconds())},s.resetCdTimeView=function(e){var t=this;if(e>0){var r=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers);t.label_time.text=mo.STR.format("再过%s恢复%s点",mo.getTimeStr(e),r[22])}},r}(mo.gui.Dlg);e.CoffersServerDlg=t,egret.registerClass(t,"g_coffers.CoffersServerDlg"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,e.fullScr=!0,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){var r=this;async.series([function(e){gd.kingCtrl.getInfo(function(t){if(!gd.kingCtrl.getData())return mo.showMsg(gc.id_c_msgCode.yourServerNoOpen),void e("errr");var r=gd.kingCtrl.get(gc.dsConsts.King.kingId);return r?void e():(mo.showMsg(gc.id_c_msgCode.yourServerNoOpen),void e("errr"))},this)},function(t){gd.coffersCtrl.getServerArr(function(r){e.data={list:r},t()},this)}],function(e){return t(e)},r)})})}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),o=r.prototype;return o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.dataChanged()},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.label_scorePersonToday.text=gd.userCtrl.get(gc.dsConsts.UserEntity.todayCoffersPoints)+"",t.label_scorePerson.text=gd.userCtrl.get(gc.dsConsts.UserEntity.coffersPoints)+"",t.label_scoreServerToday.text=gd.coffersCtrl.get(gc.dsConsts.CoffersEntity.todayPoints)+"",t.label_scoreServer.text=gd.coffersCtrl.get(gc.dsConsts.CoffersEntity.points)+"",t.label_win.text=gd.coffersCtrl.getCoffersWin(),t.label_score.text=gd.coffersCtrl.getNextWinPoints()},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:45}).show()},t}(mo.gui.Dlg);e.CoffersScore=t,egret.registerClass(t,"g_coffers.CoffersScore")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),o=r.prototype;return o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.dataChanged(),t.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.bag.toString(),t.dataChanged)},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=gd.coffersCtrl.get(gc.dsConsts.CoffersEntity.buffBase)/100,o=gd.coffersCtrl.get(gc.dsConsts.CoffersEntity.buffLvl),s=gd.coffersCtrl.get(gc.dsConsts.CoffersEntity.buffExpc),a=o+1,f=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers2),i=f[3].split(","),n=f[4].split(","),c=o>=i.length-1;if(t.label_addProp.text=r+"%",t.label_curLv.text=o+"",t.label_curAdd.text=n[o]/100+"%",t.label_value.text=mo.STR.format("本次激励增加：+%s激励值",f[2]),c)t.grp_nextLv.visible=!1,t.label_maxLv.visible=!0,t.label_noCount.visible=!1,t.grp_jili.visible=!1,t.label_value.visible=!1,t.bar_value.maximum=i[o];else{t.grp_nextLv.visible=!0,t.label_maxLv.visible=!1,t.label_value.visible=!0,t.label_nextLv.text=a,t.label_nextAdd.text=n[a]/100+"%";var l=gd.coffersCtrl.getAddBuffNum(),g=gd.userCtrl.getVip(),d=mo.getJSONWithFileNameAndID(gc.cfg_c_vip,g),_=d[gc.c_vip_coffersBuff];if(-1!=_&&l>=_)t.grp_jili.visible=!1,t.label_noCount.visible=!0;else{t.grp_jili.visible=!0,t.label_noCount.visible=!1;var C=mo.getJSONWithFileNameAndID(gc.cfg_t_item,f[0]);t.label_costName.text=C[gc.t_item_name],t.label_cost.text=gd.userCtrl.getItemNum(f[0])+"/"+f[1],t.ico_item.source=resHelper.getItemIconPath(f[0]),-1!=_?t.label_leftCount.text=mo.STR.format("Vip%s今日剩余次数：%s/%s",g,_-l,_):t.label_leftCount.text=mo.STR.format("Vip%s每日激励不限次数",g)}t.bar_value.maximum=i[a]}t.bar_value.value=s},o._tap_btn_jili=function(){var e=this,t=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers2),r=t[0],o=gd.userCtrl.getItemNum(r),s=t[1];o>=s?gd.coffersCtrl.addBuff(function(){e.dataChanged()},e):g_base.GainWay.canBuyFromShop(r)?g_base.GainWayShop.create().setData({itemId:r,count:s-o}).show().onClose(function(){e.dataChanged()}):g_base.GainWay.create().setData({itemId:r}).show()},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:43}).show()},t}(mo.gui.Dlg);e.CoffersJili=t,egret.registerClass(t,"g_coffers.CoffersJili")}(g_coffers||(g_coffers={}));var g_coffers;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),o=r.prototype;return o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data,o=r[gc.dsConsts.ExDefenceData.isCanLoot],s=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers3),a=100-s[0]/100;t.label_cannotRob.text=a,t.label_failCount.text=r[gc.dsConsts.ExDefenceData.breakNum],t.label_coffer.text=utils.formatByWan2(r[gc.dsConsts.ExDefenceData.curResource]),t.label_rate.text=r[gc.dsConsts.ExDefenceData.lootRate],t.label_robCount.text=[s[7]-r[gc.dsConsts.ExDefenceData.todayLootNum],s[7]],t.grp_canRob.visible=o,t.label_cannotRob.visible=!o,t.label_name.text=r[gc.dsConsts.ExDefenceData.serverName]},o._tap_btn_rob=function(){var e=this,t=e.data;gd.coffersCtrl.fightCoffersStart(t[gc.dsConsts.ExDefenceData.serverId],function(){},e)},o._tap_btn_help=function(){var e=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.coffers3),t=100-e[0]/100;g_base.BaseShowTip.create().setData({id:60,param1:t+"%"}).show()},t}(mo.gui.Dlg);e.CoffersRob=t,egret.registerClass(t,"g_coffers.CoffersRob")}(g_coffers||(g_coffers={}));