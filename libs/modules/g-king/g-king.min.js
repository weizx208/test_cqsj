var g_king;!function(e){var i=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var t=(__define,i),n=t.prototype;return n._initProp=function(){e.prototype._initProp.call(this);var i=this;i._layerOpt.shownWithAction=!1,i._Item_list_items=g_defarena.DefArenaRankRewardCell,i.tabIndex=0,i.tabCompArr=null,i.tabCompArr=[],i.registerClassByKey(gd.kingCtrl,gc.dsConsts.King.kingGuildId.toString(),i._refreshTabComp),i.registerClassByKey(gd.kingCtrl,gc.dsConsts.King.buffOpenNum.toString(),i._refreshTabComp),i.registerClassByKey(gd.kingCtrl,gc.dsConsts.King.beWorshipNum.toString(),i._refreshTabComp),i.registerClassByKey(gd.kingCtrl,gc.dsConsts.King.buffEndTime.toString(),i._refreshTabComp)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this);var i=this;i.grp_king.visible=!1,i.grp_cloak.visible=!1,i.grp_welfare.visible=!1,i.grp_rankReward.visible=!1,i.tabCompArr=[i.grp_king,i.grp_cloak,i.grp_welfare,i.grp_rankReward],i.tab_king.selectedIndex=0,process.nextTick(function(){i._tap_tab_king()});gd.challengeCupCtrl.getIsOpen(function(){i.label_open.text=gd.challengeCupCtrl.nextOpenTime&&gd.challengeCupCtrl.nextOpenTime.toFormat("MM月DD日HH24:MI")},i)},n._data_tab_king=function(){var e;return e=gd.kingCtrl.isKing()?["tab_txt_bazhutequan","tab_txt_wangzepifeng","tab_txt_xiongdifuli","tab_txt_saisijianglig"]:["tab_txt_mobaibaz","tab_txt_wangzepifeng","tab_txt_xiongdifuli","tab_txt_saisijianglig"]},n._tap_tab_king=function(){var e=this,i=e.tabIndex=e.tab_king.selectedIndex,t=e.tabCompArr,n=t[i];if(n){for(var r=0,g=t.length;g>r;r++){var l=t[r];l.visible=!1}e._refreshTabComp(),n.visible=!0}},n._refreshTabComp=function(){var e=this,i=e.tabIndex;0==i?e._refreshKingGrp():1==i?e._refreshCloakGrp():2==i?e._refreshWelfarGrp():3==i&&e._refreshRankRewardGrp()},n._tap_btn_help=function(){var e=gd.kingCtrl.getKingData();g_base.BaseShowTip.create().setData({id:29,param1:e.buffOpenNeedNum,param2:e.dayBuffOpenNum}).show()},n._refreshKingGrp=function(){var e=this,i=gd.kingCtrl.getKingData(),t=gd.kingCtrl.getBuffData();gd.kingCtrl.isKingInGuild()?(e.label_king_guild.text="["+i.kingGuildName+"]",e.label_king_guild.visible=!0,e.icon_king_guild_bg.visible=!0):(e.label_king_guild.visible=!1,e.icon_king_guild_bg.visible=!1),e.label_king_vip.text=i.kingVip+"",e.label_king_name.text=i.kingName,e.label_king_lv.text="LV."+i.kingLvl,e.label_king_worship_num.text=i.beWorshipCount,e.label_king_des1.text=i.buffOpenNeedNum,t&&(e.label_king_des2.text=[t.des,t.conTime]),console.log("bar_king=================>>>beWorshipNum：%s，buffOpenNeedNum：%s",i.beWorshipNum,i.buffOpenNeedNum),e.label_king_bar_worship_num.text=i.beWorshipNum+"/"+i.buffOpenNeedNum,e.bar_king.value=i.beWorshipNum/i.buffOpenNeedNum*100,e.ico_king_buff.source=resHelper.getBuffIconPath(gd.kingCtrl.getKingBuffId());var n=i.avatarData;if(e.ico_king_avatar.setData({clothesID:n[0],weaponID:n[1],wingID:n[2],sex:n[3],isKing:!0}),e.setCDTime(i.buffEndCD),gd.kingCtrl.isKing())e.label_king_open_num.visible=!0,e.label_king_open_num.text=Math.floor(i.beWorshipNum/i.buffOpenNeedNum),e.label_king_my_worship_num.visible=!1,e.label_king_worship_award.visible=!1,e.icon_king_worship_award.visible=!1,e.label_king_worship_award_num.visible=!1,e.label_king_worshiped.visible=!1,e.btn_king.icon="ico_kaiqi",e.label_king_today_open_num.visible=!0,e.label_king_today_open_num.text=i.dayBuffOpenNum-i.buffOpenNum,e.btn_king.enabled=i.dayBuffOpenNum-i.buffOpenNum>0,e.btn_king.visible=!0;else{var r=gd.kingCtrl.getWorshipItemList(),g=r[0];e.label_king_open_num.visible=!1,e.label_king_my_worship_num.visible=!0,e.label_king_my_worship_num.text=gd.kingCtrl.getMyWorshipNum(),e.label_king_my_worship_num.visible=!1,e.btn_king.icon="ico_mobai",e.label_king_today_open_num.visible=!1,e.btn_king.visible=gd.kingCtrl.getMyWorshipNum()<1,e.label_king_worship_award.visible=gd.kingCtrl.getMyWorshipNum()<1,e.icon_king_worship_award.visible=e.label_king_worship_award.visible,e.icon_king_worship_award.source=g&&resHelper.getItemIconPath(g.itemId),e.label_king_worship_award_num.visible=e.label_king_worship_award.visible,e.label_king_worship_award_num.text=g&&g.count,e.label_king_worshiped.visible=gd.kingCtrl.getMyWorshipNum()>=1}},n.setCDTime=function(e){var i=this;if(e>0){i.timeTrigger&&(tm.timer.remove(i.timeTrigger),i.timeTrigger=null);var t=Date.newDate(Date.newDate().getTime()+1e3*e),n=i.timeTrigger=new tm.Trigger(t);n.on(tm.Trigger.ON_SECOND,i.timeSec,i),n.on(tm.Trigger.ON_END,i.timeOut,i),tm.timer.add(n)}else i.resetCdTimeView(0)},n.timeSec=function(e,i,t){var n=this,r=Date.newDate().getTime(),g=Date.newDate(t).getTime(),l=g-r;n.resetCdTimeView(l)},n.timeOut=function(e,i,t){var n=this;n.resetCdTimeView(0)},n.resetCdTimeView=function(e){var i=this;e>0?(i.label_king_time.visible=!0,i.ico_king_buff.visible=!0,i.label_king_time.text=mo.STR.format(mo.getTimeStr(e))):(i.label_king_time.visible=!1,i.ico_king_buff.visible=!1)},n._tap_btn_king=function(){var e=this;if(gd.kingCtrl.isKing()){var i=gd.kingCtrl.getKingData(),t=gd.kingCtrl.getBuffData();i.dayBuffOpenNum-i.buffOpenNum>0&&(i.beWorshipNum-i.buffOpenNeedNum>=0?mo.showMsg(gc.id_c_msgCode.ifOpenBuff,t.name,t.conTime,function(){gd.kingCtrl.openBuff(function(){e._refreshTabComp()},e)}):mo.showMsg(gc.id_c_msgCode.noBuffTimes))}else gd.kingCtrl.worship(function(){e._refreshTabComp()},e)},n._tap_ico_king_avatar=function(){mo.moduleMgr.pushModule(g_consts.moduleId.roleEnemyInfo,{userId:gd.kingCtrl.get(gc.dsConsts.King.kingId)})},n._refreshCloakGrp=function(){var e=this,i="[ubb color=0xEBC661]%s:[/ubb] [ubb color=0x00DD3D]+%s%[/ubb][/br]",t="";for(var n in gc.c_prop.equipProp)t+=mo.STR.format(i,gc.c_prop.equipProp[n],gd.kingCtrl.getCloakProAdd()/100);e.label_cloak_props.text=t;var r=mo.getJSONWithFileNameAndID(gc.cfg_c_help,30);r&&(e.label_cloak_des.text=r[gc.c_help_helpText])},n._refreshWelfarGrp=function(){for(var e=this,i=gd.kingCtrl.getWelfareItemList(),t=0;4>t;t++){var n=e["ico_welfare_item_"+t];if(n){var r=i[t];r?(n.visible=!0,n.setData(r)):n.visible=!1}}if(gd.kingCtrl.isKingInGuild()){var g=gd.kingCtrl.getKingData();e.grp_welfare_sub1.visible=!0,e.grp_welfare_sub2.visible=!1,e.label_welfare_guild.text="["+g.kingGuildName+"]"}else e.grp_welfare_sub1.visible=!1,e.grp_welfare_sub2.visible=!0;gd.kingCtrl.isKing()?(e.btn_welfare_get.visible=gd.kingCtrl.getMyWelfare()<1,e.ico_welfare_geted.visible=!(gd.kingCtrl.getMyWelfare()<1),e.label_welfare_no_get.visible=!1):gd.kingCtrl.isInSameGuild()?(e.btn_welfare_get.visible=gd.kingCtrl.getMyWelfare()<1,e.ico_welfare_geted.visible=!(gd.kingCtrl.getMyWelfare()<1),e.label_welfare_no_get.visible=!1):(e.btn_welfare_get.visible=!1,e.label_welfare_no_get.visible=!0,e.ico_welfare_geted.visible=!1)},n._tap_btn_welfare_get=function(){var e=this;gd.kingCtrl.receiveWelfare(function(){e._refreshTabComp()},e)},n._data_list_items=function(){var e=mo.getJSONWithFileName(gc.cfg_c_challengeCupRankReward),i=[];for(var t in e)i.push(e[t]);return i},n._refreshRankRewardGrp=function(){var e=this,i=gd.challengeCupCtrl.getRward(),t=mo.getJSONWithFileNameAndID(gc.cfg_t_item,i[0]);e.item_reward.setData({itemId:i[0],count:i[1]}),e.label_desc.text=t[gc.t_item_note]},i}(mo.gui.Dlg);e.King=i,egret.registerClass(i,"g_king.King"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=i,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,i){gd.kingCtrl.getInfo(function(e){return e&&e[gc.dsConsts.King.kingId]?void i():(i("err"),mo.showMsg(gc.id_c_msgCode.noKingNow,function(){gd.challengeCupCtrl.getIsOpen(function(e){gd.challengeCupCtrl.isOpen?mo.moduleMgr.runModule(g_consts.moduleId.defArena):mo.moduleMgr.runModule(g_consts.moduleId.defarenaWinner)},this)}))},this)})})}(g_king||(g_king={}));