var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t._childrenCreated=function(){a.prototype._childrenCreated.call(this)},t.dataChanged=function(){a.prototype.dataChanged.call(this);var e=this,r=e.data,t=r[gc.dsConsts.GuildWarRank.rank],i=["1st","2nd","3rd"];e.label_killValue.text=r[gc.dsConsts.GuildWarRank.points].toString();var l=r[gc.dsConsts.GuildWarRank.guildName]?r[gc.dsConsts.GuildWarRank.guildName]:"";e.label_guild.text=""==l?"":mo.STR.format("[%s]",l),3>=t?(e.ico_rank.source="ico_arena_"+i[t-1],e.ico_rank.visible=!0,e.label_rank.visible=!1):(e.label_rank.text=t,e.ico_rank.visible=!1,e.label_rank.visible=!0);var d,o=e.delegate.data.groupId,g=mo.getJSONWithFileName(gc.cfg_c_guildWarReward),n=g[t];if(!n){var s=Object.keys(g);n=g[s[s.length-1]]}o==gc.c_prop.guildGroupKey.diamond?d=n[gc.c_guildWarReward_diamond]:o==gc.c_prop.guildGroupKey.wGold?d=n[gc.c_guildWarReward_wgold]:o==gc.c_prop.guildGroupKey.hGold?d=n[gc.c_guildWarReward_hgold]:o==gc.c_prop.guildGroupKey.silver?d=n[gc.c_guildWarReward_silver]:o==gc.c_prop.guildGroupKey.copper&&(d=n[gc.c_guildWarReward_copper]);for(var c=0;4>c;++c){var u=e["grp_res"+c],_=d[c];if(_){var p=u.getElementAt(0),f=u.getElementAt(1);u.visible=!0,p.source=resHelper.getItemIconPath(_[0]),f.text=_[1]}else u.visible=!1}},e}(mo.gui.ItemRenderer);a.GuildWarRankGuildCell=e,egret.registerClass(e,"g_guildwar.GuildWarRankGuildCell")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t._childrenCreated=function(){a.prototype._childrenCreated.call(this)},t.dataChanged=function(){a.prototype.dataChanged.call(this);var e=this,r=e.data,t=r[gc.dsConsts.GuildWarUserRank.rank],i=["1st","2nd","3rd"];e.label_killValue.text=r[gc.dsConsts.GuildWarUserRank.points].toString();var l=r[gc.dsConsts.GuildWarUserRank.guildName]?r[gc.dsConsts.GuildWarUserRank.guildName]:"";e.label_guild.text=""==l?"":mo.STR.format("[%s]",l),e.ico_head.setData({icoId:r[gc.dsConsts.GuildWarUserRank.iconId],vip:r[gc.dsConsts.GuildWarUserRank.vip]}),e.label_name.text=r[gc.dsConsts.GuildWarUserRank.userName],3>=t?(e.ico_rank.source="ico_arena_"+i[t-1],e.ico_rank.visible=!0,e.label_rank.visible=!1):(e.label_rank.text=t,e.ico_rank.visible=!1,e.label_rank.visible=!0);var d,o=e.delegate.data.groupId,g=mo.getJSONWithFileNameAndID(gc.cfg_c_guildWarReward,t);o==gc.c_prop.guildGroupKey.diamond?d=g[gc.c_guildWarReward_diamondSp]:o==gc.c_prop.guildGroupKey.wGold?d=g[gc.c_guildWarReward_wgoldSp]:o==gc.c_prop.guildGroupKey.hGold?d=g[gc.c_guildWarReward_hgoldSp]:o==gc.c_prop.guildGroupKey.silver?d=g[gc.c_guildWarReward_silverSp]:o==gc.c_prop.guildGroupKey.copper&&(d=g[gc.c_guildWarReward_copperSp]);for(var n=0;4>n;++n){var s=e["grp_res"+n],c=d[n];if(c){var u=s.getElementAt(0),_=s.getElementAt(1);s.visible=!0,u.source=resHelper.getItemIconPath(c[0]),_.text=c[1]}else s.visible=!1}},e}(mo.gui.ItemRenderer);a.GuildWarRankGuildManagerCell=e,egret.registerClass(e,"g_guildwar.GuildWarRankGuildManagerCell")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t._childrenCreated=function(){a.prototype._childrenCreated.call(this)},t.dataChanged=function(){a.prototype.dataChanged.call(this);var e=this,r=e.data,t=r[gc.dsConsts.GuildWarUserRank.rank],i=["1st","2nd","3rd"];e.label_killValue.text=r[gc.dsConsts.GuildWarUserRank.points].toString();var l=r[gc.dsConsts.GuildWarUserRank.guildName]?r[gc.dsConsts.GuildWarUserRank.guildName]:"";e.label_guild.text=""==l?"":mo.STR.format("[%s]",l),e.ico_head.setData({icoId:r[gc.dsConsts.GuildWarUserRank.iconId],vip:r[gc.dsConsts.GuildWarUserRank.vip]}),e.label_name.text=r[gc.dsConsts.GuildWarUserRank.userName],3>=t?(e.ico_rank.source="ico_arena_"+i[t-1],e.ico_rank.visible=!0,e.label_rank.visible=!1):(e.label_rank.text=t,e.ico_rank.visible=!1,e.label_rank.visible=!0);var d,o=e.delegate.data.groupId,g=mo.getJSONWithFileName(gc.cfg_c_guildWarReward),n=g[t];if(!n){var s=Object.keys(g);n=g[s[s.length-1]]}o==gc.c_prop.guildGroupKey.diamond?d=n[gc.c_guildWarReward_diamondUser]:o==gc.c_prop.guildGroupKey.wGold?d=n[gc.c_guildWarReward_wgoldUser]:o==gc.c_prop.guildGroupKey.hGold?d=n[gc.c_guildWarReward_hgoldUser]:o==gc.c_prop.guildGroupKey.silver?d=n[gc.c_guildWarReward_silverUser]:o==gc.c_prop.guildGroupKey.copper&&(d=n[gc.c_guildWarReward_copperUser]);for(var c=0;4>c;++c){var u=e["grp_res"+c],_=d[c];if(_){var p=u.getElementAt(0),f=u.getElementAt(1);u.visible=!0,p.source=resHelper.getItemIconPath(_[0]),f.text=_[1]}else u.visible=!1}},e}(mo.gui.ItemRenderer);a.GuildWarRankPersonCell=e,egret.registerClass(e,"g_guildwar.GuildWarRankPersonCell")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t._initProp=function(){var e=this;a.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1},t._childrenCreated=function(){a.prototype._childrenCreated.call(this)},t.dataChanged=function(){a.prototype.dataChanged.call(this);for(var e=this,r=e.data.recData,t="",i="%s[ubb color=#00b150]%s[/ubb][ubb color=#7030a1][%s][/ubb][ubb color=#00b1f1]%s[/ubb]击杀了[ubb color=#00b150]%s[/ubb][ubb color=#7030a1][%s][/ubb][ubb color=#00b1f1]%s[/ubb]\n\n",l="%s[ubb color=#00b150]%s[/ubb][ubb color=#7030a1][%s][/ubb][ubb color=#00b1f1]%s[/ubb] 击破了 [ubb color=#00b150]%s[/ubb][ubb color=#7030a1][%s][/ubb][ubb color=#00b1f1]%s[/ubb] 守卫的%s门\n\n",d=r.length-1;d>=0;--d){var o=r[d],g=o[gc.dsConsts.GuildWarAttackRecord.isBreak],n=Date.newDate(o[gc.dsConsts.GuildWarAttackRecord.time]);t+=g?mo.STR.format(l,n.toFormat("HH24:MI"),o[gc.dsConsts.GuildWarAttackRecord.aServerName],o[gc.dsConsts.GuildWarAttackRecord.aGuildName],o[gc.dsConsts.GuildWarAttackRecord.aUserName],o[gc.dsConsts.GuildWarAttackRecord.dServerName],o[gc.dsConsts.GuildWarAttackRecord.dGuildName],o[gc.dsConsts.GuildWarAttackRecord.dUserName],gc.c_prop.guildWarDoor[o[gc.dsConsts.GuildWarAttackRecord.door]]):mo.STR.format(i,n.toFormat("HH24:MI"),o[gc.dsConsts.GuildWarAttackRecord.aServerName],o[gc.dsConsts.GuildWarAttackRecord.aGuildName],o[gc.dsConsts.GuildWarAttackRecord.aUserName],o[gc.dsConsts.GuildWarAttackRecord.dServerName],o[gc.dsConsts.GuildWarAttackRecord.dGuildName],o[gc.dsConsts.GuildWarAttackRecord.dUserName])}t=t.substr(0,t.length-2),e.label_rec.text=t},e}(mo.gui.Dlg);a.GuildWarAttackRecDlg=e,egret.registerClass(e,"g_guildwar.GuildWarAttackRecDlg")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t.dataChanged=function(){a.prototype.dataChanged.call(this);var e=this,r=e.data;if(r[gc.dsConsts.GuildWarDefenceRecord.time]){var t,i=r[gc.dsConsts.GuildWarDefenceRecord.isWin],l=Date.newDate(r[gc.dsConsts.GuildWarDefenceRecord.time]),d=r[gc.dsConsts.GuildWarDefenceRecord.attackServerName],o=r[gc.dsConsts.GuildWarDefenceRecord.attackGuildName],g=r[gc.dsConsts.GuildWarDefenceRecord.attackUserName],n=r[gc.dsConsts.GuildWarDefenceRecord.door],s=r[gc.dsConsts.GuildWarDefenceRecord.defenceUserName],c=r[gc.dsConsts.GuildWarDefenceRecord.hp],u=r[gc.dsConsts.GuildWarDefenceRecord.isDirect];i?(e.ico_def.source="ico_pvp_fail",u?(t="[%s]因无人守卫，%s门被[ubb color=#fd68ff]%s[/ubb]的%s[ubb color=red]%s[/ubb]攻打，损失了%s生命。",t=mo.STR.format(t,l.toFormat("HH24:MI"),gc.c_prop.guildWarDoor[n],d,o,g,c)):(t="[%s]来自[ubb color=#fd68ff]%s[/ubb]的%s[ubb color=red]%s[/ubb]击败了%s门守卫[ubb color=#00cdff]%s[/ubb]，%s门损失%s生命！",t=mo.STR.format(t,l.toFormat("HH24:MI"),d,o,g,gc.c_prop.guildWarDoor[n],s,gc.c_prop.guildWarDoor[n],c))):(e.ico_def.source="ico_pvp_win",t="[%s]来自[ubb color=#fd68ff]%s[/ubb]的%s[ubb color=red]%s[/ubb]攻击了%s门，被守卫[ubb color=#00cdff]%s[/ubb]击败，但%s门还是损失了%s生命。",t=mo.STR.format(t,l.toFormat("HH24:MI"),d,o,g,gc.c_prop.guildWarDoor[n],s,gc.c_prop.guildWarDoor[n],c)),e.label_desc.text=t}},e}(mo.gui.ItemRenderer);a.GuildWarDefenceRecCell=e,egret.registerClass(e,"g_guildwar.GuildWarDefenceRecCell")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(e){function r(){e.apply(this,arguments)}__extends(r,e);var t=(__define,r),i=t.prototype;return i._initProp=function(){var r=this;e.prototype._initProp.call(this),r._layerOpt.shownWithAction=!1,r._Item_list_rec=a.GuildWarDefenceRecCell},i._childrenCreated=function(){e.prototype._childrenCreated.call(this)},i.dataChanged=function(){e.prototype.dataChanged.call(this);var a=this;a.data.defData},i._data_list_rec=function(){var a=this;return a.data.defData.concat().reverse()},r}(mo.gui.Dlg);a.GuildWarDefenceRecDlg=e,egret.registerClass(e,"g_guildwar.GuildWarDefenceRecDlg")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t._childrenCreated=function(){a.prototype._childrenCreated.call(this);var e=this;e.barScore.maximum=100},t.dataChanged=function(){a.prototype.dataChanged.call(this);var e=this,r=e.data;e.label_name.text=[r[gc.dsConsts.GuildServer.guildName],r[gc.dsConsts.GuildServer.guildLvl]],e.label_live.text=[r[gc.dsConsts.GuildServer.doorLives],4],e.label_score.text=r[gc.dsConsts.GuildServer.points],e.barScore.value=r[gc.dsConsts.GuildServer.progress],e.btn_rob.visible=0!=r[gc.dsConsts.GuildServer.doorLives],e.label_server.text=r[gc.dsConsts.GuildServer.serverName]},t._tap_btn_rob=function(){var a=this,e=a.data;gd.guildWarCtrl.getWarAttackData(e[gc.dsConsts.GuildServer.serverId],e[gc.dsConsts.GuildServer.guildId],function(e){a.delegate.guildWarDef.data.atkData=e,gd.guildWarCtrl.curGuildServer=a.data,gd.guildWarCtrl.curDoor=0,a.delegate.guildWarDef["goto"](1),a.delegate.close()},a)},e}(mo.gui.ItemRenderer);a.GuildWarGuildCell=e,egret.registerClass(e,"g_guildwar.GuildWarGuildCell")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(e){function r(){e.apply(this,arguments),this.isRobTab=!1}__extends(r,e);var t=(__define,r),i=t.prototype;return i._initProp=function(){var a=this;e.prototype._initProp.call(this),a._layerOpt.shownWithAction=!1,a.registerClassByKey(gd.UserCtrl,gc.dsConsts.MyGuildWarData.guildReNum.toString(),a.updateMyGuildWarData),a.registerClassByKey(gd.UserCtrl,gc.dsConsts.MyGuildWarData.guildRank.toString(),a.updateMyGuildWarData),a.registerClassByKey(gd.UserCtrl,gc.dsConsts.MyGuildWarData.doorLives.toString(),a.updateMyGuildWarData),a.registerClassByKey(gd.UserCtrl,gc.dsConsts.MyGuildWarData.points.toString(),a.updateMyGuildWarData),a.registerClassByKey(gd.UserCtrl,gc.dsConsts.MyGuildWarData.nextFightTime.toString(),a.updateMyGuildWarData),a.registerClassByKey(gd.UserCtrl,gc.dsConsts.MyGuildWarData.inspireEndTime.toString(),a.updateMyGuildWarData),a.registerClassByKey(gd.UserCtrl,gc.dsConsts.MyGuildWarData.warEndTime.toString(),a.updateMyGuildWarData),a.registerClassByKey(gd.UserCtrl,gc.dsConsts.MyGuildWarData.isDefence.toString(),a.updateMyGuildWarData),a.registerClassByKey(gd.GuildWarCtrl,gd.GuildWarCtrl.ON_GUILD_ATK_UPDATE,function(e,r){gd.guildWarCtrl.getWarAttackData(e,r,function(e){a.data.atkData=e,a.dataChanged()},a)}),a.registerClassByKey(gd.GuildWarCtrl,gd.GuildWarCtrl.ON_GUILD_DEF_UPDATE,function(){gd.guildWarCtrl.getWarDefenceData(function(e){a.data.defData=e,a.dataChanged()},a)})},i.onEnter=function(){e.prototype.onEnter.call(this);var a=this;a.timerId=setInterval(function(){a.updateCd()},1e3)},i.onExit=function(){e.prototype.onExit.call(this);var a=this;clearInterval(a.timerId),gd.guildWarCtrl.exitSyncScenne()},i._childrenCreated=function(){e.prototype._childrenCreated.call(this);var a=this;a.data.atkData?a["goto"](1):a.data.defData&&a["goto"](0);for(var r=0;4>r;++r){var t=a["bar_defHp"+r],i=a["bar_robHp"+r],l=a["ico_robSel"+r];t.labelFunction=function(a,e){return"城门生命："+(a+"/"+e)},i.labelFunction=function(a,e){return""},l.addEventListener(egret.TouchEvent.TOUCH_TAP,a.onDoorSel,a)}a.bar_curHp.labelFunction=function(a,e){return"城门生命："+(a+"/"+e)},a.bar_curHp.slideDuration=100},i.dataChanged=function(){e.prototype.dataChanged.call(this);var a=this;a.data;if(a.isRobTab){var r=a.data.atkData;a.label_guild.text=r[gc.dsConsts.GuildWarData.guildName],a.updateAtkDoors(r[gc.dsConsts.GuildWarData.doorList])}else{var t=a.data.defData;a.updateDefDoors(t[gc.dsConsts.GuildWarData.doorList])}a.updateMyGuildWarData()},i["goto"]=function(a){var e=this;e.isRobTab=!!a,e.isRobTab?(e.grp_rob.visible=!0,e.grp_def.visible=!1,e.btn_attackRec.y=e.btn_score.y=208,gd.guildWarCtrl.setSyncSceneType(2),e.selectDoor(gd.guildWarCtrl.curDoor||0)):(e.grp_rob.visible=!1,e.grp_def.visible=!0,e.btn_attackRec.y=e.btn_score.y=80,gd.guildWarCtrl.setSyncSceneType(3)),e.dataChanged()},i.updateMyGuildWarData=function(){var a=this,e=gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.groupId),r=gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.guildReNum),t=gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.guildTotal);a.label_leftNum.text=[gc.c_prop.guildGroup[e],r,t],a.label_rank.text=gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.guildRank),a.label_live.text=gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.doorLives),a.label_point.text=gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.points),a.updateCd()},i.updateCd=function(){var a=this,e=gd.guildWarCtrl.getInspireReSeconds(),r=gd.guildWarCtrl.getFightCd(),t=gd.guildWarCtrl.getOverReSeconds();if(a.btn_clearCd.visible=!1,e>0){a.grp_guwuLeftTime.visible=!0,a.label_guwuLeftTime.text=mo.getTimeStr(1e3*e);var i=mo.getJSONWithFileNameAndID(gc.cfg_t_otherBuff,5);a.label_addProp.text=i[gc.t_otherBuff_addHurt]/100}else a.grp_guwuLeftTime.visible=!1,a.label_addProp.text=0;gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.doorLives)>0?gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.isDefence)?a.label_myState.text="防守中":r>0?(a.btn_clearCd.visible=!0,a.label_myState.text=mo.getTimeStr(1e3*r)+"后可进攻"):a.label_myState.text="可进攻":a.label_myState.text="行会已被攻破",a.label_leftTime.text=mo.getTimeStr(1e3*t,!0)},i._tap_btn_guwu=function(){var a=this;mo.showMsg(gc.id_c_msgCode.buyInspire,gd.guildWarCtrl.getInspireCount(),gd.guildWarCtrl.getInspireCost(),function(){gd.guildWarCtrl.inspire(function(e){a.updateCd()},a)})},i._tap_btn_clearCd=function(){var a=this;mo.showMsg(gc.id_c_msgCode.buyManyCD,gd.guildWarCtrl.getClearCdCount(),gd.guildWarCtrl.getClearCdCost(),function(){gd.guildWarCtrl.clearCd(function(){a.updateCd()},a)})},i.selectDoor=function(a){var e=this;if(e.isRobTab){var r=["东","南","西","北"];gd.guildWarCtrl.curDoor=a;for(var t=0;4>t;++t){var i=e["ico_robSel"+t];i.alpha=0}i=e["ico_robSel"+gd.guildWarCtrl.curDoor],i.alpha=1,e.label_robDoor.text=r[gd.guildWarCtrl.curDoor];for(var l=e.data.atkData[gc.dsConsts.GuildWarData.doorList],d=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.guildWar),o=d[1],t=0;4>t;++t){var g=l[t],n=g[gc.dsConsts.GuildWarDoor.door],s=g[gc.dsConsts.GuildWarDoor.isBreak];n==gd.guildWarCtrl.curDoor&&(e.ico_hasBreakCur.visible=s,e.ico_noDefCur.visible=!1,s||(e.ico_noDefCur.visible=!0),e.bar_curHp.maximum=o,e.bar_curHp.value=g[gc.dsConsts.GuildWarDoor.hp])}}},i.updateAtkDoors=function(a){for(var e=this,r=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.guildWar),t=r[1],i=0;4>i;++i){var l=a[i],d=l[gc.dsConsts.GuildWarDoor.door],o=(l[gc.dsConsts.GuildWarDoor.isBreak],l[gc.dsConsts.GuildWarDoor.hp]),g=e["ico_robSel"+d],n=e["bar_robHp"+d];g.alpha=0,n.maximum=t,n.value=o,n.validateNow()}g=e["ico_robSel"+gd.guildWarCtrl.curDoor],g.alpha=1},i.updateDefDoors=function(a){for(var e=this,r=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.guildWar),t=r[1],i=0;4>i;++i){var l=a[i],d=l[gc.dsConsts.GuildWarDoor.door],o=(l[gc.dsConsts.GuildWarDoor.userName],l[gc.dsConsts.GuildWarDoor.userIcon],l[gc.dsConsts.GuildWarDoor.isBreak]),g=l[gc.dsConsts.GuildWarDoor.hp],n=l[gc.dsConsts.GuildWarDoor.userId],s=e["bar_defHp"+d],c=e["ico_hasBreak"+d],u=e["ico_noDef"+i],_=e["ico_hasDef"+i];c.visible=o,s.maximum=t,s.value=g,u.visible=_.visible=!1,!o&&n?_.visible=!0:o||(u.visible=!0)}},i._data_list_guild=function(){var a=this;return a.data.list},i.onDoorSel=function(a){for(var e=this,r=0;4>r;++r){var t=e["ico_robSel"+r];if(t==a.currentTarget)break}e.selectDoor(r)},i._tap_btn_chat=function(){a.GuildWarChat.create().show()},i._tap_btn_defSetting=function(){var e=this;a.GuildWarDefSetting.create().setData({defData:e.data.defData,guildWarDef:e}).show()},i._tap_btn_attackRec=function(){var e=this;gd.guildWarCtrl.getAttackRecordList(function(e){a.GuildWarAttackRecDlg.create().setData({recData:e}).show()},e)},i._tap_btn_score=function(){var e=this;gd.guildWarCtrl.getGuildWarAllRank(function(e){a.GuildWarRank.create().setData({rankData:e,groupId:gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.groupId)}).show()},e)},i._tap_btn_defRec=function(){var e=this;gd.guildWarCtrl.getDefenceRecordList(function(e){a.GuildWarDefenceRecDlg.create().setData({defData:e}).show()},e)},i._tap_btn_back=function(){var a=this;a.isRobTab?a["goto"](0):mo.moduleMgr.runModule(g_consts.moduleId.fight)},i._tap_btn_rob=function(a){var e=this,r=e.data.atkData;gd.guildWarCtrl.fightStartDoor(r[gc.dsConsts.GuildWarData.serverId],r[gc.dsConsts.GuildWarData.guildId],gd.guildWarCtrl.curDoor,function(a){},e)},i._tap_btn_robList=function(){var e=this;gd.guildWarCtrl.getGuildList(function(r){a.GuildWarGuildList.create().setData({list:r,guildWarDef:e}).show()},e)},i._tap_btn_help=function(){var a=this;if(a.isRobTab){var e=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.guildWar);g_base.BaseShowTip.create().setData({id:64,param1:e[2],param2:e[3]}).show()}else g_base.BaseShowTip.create().setData({id:65}).show()},r}(mo.gui.Layer);a.GuildWarDef=e,egret.registerClass(e,"g_guildwar.GuildWarDef")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(e){function r(){e.apply(this,arguments)}__extends(r,e);var t=(__define,r),i=t.prototype;return i._initProp=function(){var r=this;e.prototype._initProp.call(this),r._layerOpt.shownWithAction=!1,r._Item_list_guild=a.GuildWarGuildCell,r.registerClassByKey(gd.GuildWarCtrl,gd.GuildWarCtrl.ON_GUILD_LIST_UPDATE,function(){gd.guildWarCtrl.getGuildList(function(a){r.data.list=a;var e=r.list_guild.dataProvider;e.replaceAll(a)},r)})},i.onExit=function(){e.prototype.onExit.call(this);var a=this;a.guildWarDef["goto"](a.guildWarDef.isRobTab?1:0)},i._childrenCreated=function(){e.prototype._childrenCreated.call(this);gd.guildWarCtrl.setSyncSceneType(1)},i.dataChanged=function(){e.prototype.dataChanged.call(this);var a=this;a.data;a.guildWarDef=a.data.guildWarDef},i._data_list_guild=function(){var a=this;return a.data.list},r}(mo.gui.Dlg);a.GuildWarGuildList=e,egret.registerClass(e,"g_guildwar.GuildWarGuildList")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t._initProp=function(){var e=this;a.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,e._Item_list_chat=g_mid.ChatItem,e.registerClassByKey(gd.ChatCtrl,gd.ChatCtrl.ON_GUILD_CHAT_UPDATE,function(a){e.onChatUpdate(gc.c_prop.chatTypeKey.guild,a)})},t.onChatUpdate=function(a,e){var r=this;r.refreshList("list_chat");var t=r.list_chat.scroller;process.nextTick(function(){r.list_chat&&t.throwVertically(t.getMaxScrollTop(),1)})},t._tap_btn_send=function(){var a=this;gd.chatCtrl.sendData(mo.trans4UBB(a.label_input.text),gc.c_prop.chatTypeKey.guild,!1,function(){a.label_input.text=""},a)},t._data_list_chat=function(){return gd.chatCtrl.getGuildAllList()},t._childrenCreated=function(){a.prototype._childrenCreated.call(this)},t.dataChanged=function(){a.prototype.dataChanged.call(this);var e=this;e.data},e}(mo.gui.Dlg);a.GuildWarChat=e,egret.registerClass(e,"g_guildwar.GuildWarChat")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t._initProp=function(){var e=this;a.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,e.registerClassByKey(gd.GuildWarCtrl,gd.GuildWarCtrl.ON_GUILD_DEF_UPDATE,function(){gd.guildWarCtrl.getWarDefenceData(function(a){e.data.defData=a,e.dataChanged()},e)})},t._childrenCreated=function(){a.prototype._childrenCreated.call(this);for(var e=this,r=0;4>r;++r){var t=e["btn_defUp"+r],i=e["btn_defDown"+r],l=e["bar_defHp"+r];l.labelFunction=function(a,e){return"城门生命："+(a+"/"+e)},t.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onUpClick,e),i.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onDownClick,e)}},t.dataChanged=function(){a.prototype.dataChanged.call(this);var e=this,r=e.data.defData;e.updateDefDoors(r[gc.dsConsts.GuildWarData.doorList])},t.updateDefDoors=function(a){for(var e=this,r=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.guildWar),t=r[1],i=0;4>i;++i){var l=a[i],d=l[gc.dsConsts.GuildWarDoor.door],o=l[gc.dsConsts.GuildWarDoor.userName],g=l[gc.dsConsts.GuildWarDoor.userIcon],n=l[gc.dsConsts.GuildWarDoor.isBreak],s=l[gc.dsConsts.GuildWarDoor.hp],c=l[gc.dsConsts.GuildWarDoor.userId],u=gd.guildPersonalCtrl.getPosition()==gc.c_prop.guildPostKey.chairman,_=e["btn_defUp"+d],p=e["btn_defDown"+d],f=e["label_defName"+d],b=e["ico_defFace"+d],h=e["ico_defBreak"+d],C=e["bar_defHp"+d],W=e["ico_noRole"+i];h.visible=n,C.maximum=t,C.value=s,W.visible=_.visible=p.visible=!1,!n&&c?(p.visible=u||c==gd.userCtrl.getId(),f.text=o||"",b.source=uiHelper.getHeroIcon(g,0)):(n||(W.visible=!0,_.visible=!gd.guildWarCtrl.get(gc.dsConsts.MyGuildWarData.isDefence)),f.text="",b.source=null)}},t.onUpClick=function(a){for(var e=this,r=0;4>r;++r){var t=e["btn_defUp"+r];if(t==a.currentTarget)break}gd.guildWarCtrl.upDoor(r,function(){gd.guildWarCtrl.getWarDefenceData(function(a){e.data.guildWarDef.data.defData=e.data.defData=a,e.dataChanged(),e.data.guildWarDef.dataChanged()},e)},e)},t.onDownClick=function(a){for(var e=this,r=0;4>r;++r){var t=e["btn_defDown"+r];if(t==a.currentTarget)break}gd.guildWarCtrl.downDoor(r,function(){gd.guildWarCtrl.getWarDefenceData(function(a){e.data.guildWarDef.data.defData=e.data.defData=a,e.dataChanged(),e.data.guildWarDef.dataChanged()},e)},e)},e}(mo.gui.Dlg);a.GuildWarDefSetting=e,egret.registerClass(e,"g_guildwar.GuildWarDefSetting")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(e){function r(){e.apply(this,arguments)}__extends(r,e);var t=(__define,r),i=t.prototype;return i._childrenCreated=function(){e.prototype._childrenCreated.call(this);var a=this;this.outsideClosable=!0,a._tap_tab_btn()},i._initProp=function(){var r=this;e.prototype._initProp.call(this),r._Item_list_rankGuild=a.GuildWarRankGuildCell,r._Item_list_rankGuildManager=a.GuildWarRankGuildManagerCell,r._Item_list_rankPerson=a.GuildWarRankPersonCell},i.onEnter=function(){e.prototype.onEnter.call(this)},i.dataChanged=function(){e.prototype.dataChanged.call(this)},i._tap_tab_btn=function(){var a=this,e=a.tab_btn.selectedIndex;a.list_rankGuild.visible=!1,a.list_rankGuildManager.visible=!1,a.list_rankPerson.visible=!1;var r,t,i,l=a.data.groupId,d=0,o=0,g=mo.getJSONWithFileName(gc.cfg_c_guildWarReward);if(0==e||-1==e){if(a.list_rankGuild.visible=!0,a.ico_myGuildRank.visible=!0,a.ico_myRank.visible=!1,a.label_myRank.x=a.ico_myGuildRank.x+a.ico_myGuildRank.width+10,a.ico_guild.visible=!0,a.ico_person.visible=!1,a.label_desc.text="点数相同根据优先到达者计算",r=gd.guildWarCtrl.getMyPointRank(),d=r?r[gc.dsConsts.GuildWarRank.rank]:0,d>0){if(t=g[d],!t){var n=Object.keys(g);t=g[n[n.length-1]]}o=r[gc.dsConsts.GuildWarRank.points],l==gc.c_prop.guildGroupKey.diamond?i=t[gc.c_guildWarReward_diamond]:l==gc.c_prop.guildGroupKey.wGold?i=t[gc.c_guildWarReward_wgold]:l==gc.c_prop.guildGroupKey.hGold?i=t[gc.c_guildWarReward_hgold]:l==gc.c_prop.guildGroupKey.silver?i=t[gc.c_guildWarReward_silver]:l==gc.c_prop.guildGroupKey.copper&&(i=t[gc.c_guildWarReward_copper])}}else if(1==e){if(a.list_rankGuildManager.visible=!0,a.label_desc.text="会长排名根据行会排名计算",a.ico_myGuildRank.visible=!0,a.ico_myRank.visible=!1,a.label_myRank.x=a.ico_myGuildRank.x+a.ico_myGuildRank.width+10,a.ico_guild.visible=!0,a.ico_person.visible=!1,r=gd.guildWarCtrl.getMyChairRank(),d=r?r[gc.dsConsts.GuildWarUserRank.rank]:0,d>0){if(t=g[d],!t){var n=Object.keys(g);t=g[n[n.length-1]]}o=r[gc.dsConsts.GuildWarUserRank.points],l==gc.c_prop.guildGroupKey.diamond?i=t[gc.c_guildWarReward_diamondSp]:l==gc.c_prop.guildGroupKey.wGold?i=t[gc.c_guildWarReward_wgoldSp]:l==gc.c_prop.guildGroupKey.hGold?i=t[gc.c_guildWarReward_hgoldSp]:l==gc.c_prop.guildGroupKey.silver?i=t[gc.c_guildWarReward_silverSp]:l==gc.c_prop.guildGroupKey.copper&&(i=t[gc.c_guildWarReward_copperSp])}}else if(2==e&&(a.list_rankPerson.visible=!0,a.label_desc.text="点数相同根据优先到达者计算",a.ico_myGuildRank.visible=!1,a.ico_myRank.visible=!0,a.label_myRank.x=a.ico_myRank.x+a.ico_myRank.width+10,a.ico_guild.visible=!1,a.ico_person.visible=!0,r=gd.guildWarCtrl.getMyUserRank(),d=r?r[gc.dsConsts.GuildWarUserRank.rank]:0,d>0)){if(t=g[d],!t){var n=Object.keys(g);t=g[n[n.length-1]]}o=r[gc.dsConsts.GuildWarUserRank.points],l==gc.c_prop.guildGroupKey.diamond?i=t[gc.c_guildWarReward_diamondUser]:l==gc.c_prop.guildGroupKey.wGold?i=t[gc.c_guildWarReward_wgoldUser]:l==gc.c_prop.guildGroupKey.hGold?i=t[gc.c_guildWarReward_hgoldUser]:l==gc.c_prop.guildGroupKey.silver?i=t[gc.c_guildWarReward_silverUser]:l==gc.c_prop.guildGroupKey.copper&&(i=t[gc.c_guildWarReward_copperUser])}if(d>0){a.grp_Rank.visible=!0;for(var s=0;4>s;++s){var c=a["grp_res"+s],u=i[s];if(u){var _=c.getElementAt(0),p=c.getElementAt(1);c.visible=!0,_.source=resHelper.getItemIconPath(u[0]),p.text=u[1]}else c.visible=!1}a.label_myRank.text=""+d,a.label_myKillValue.text=""+o}else a.grp_Rank.visible=!1},i._data_list_rankGuild=function(){var a=this;return a.data.rankData[gc.dsConsts.GuildWarAllRank.guildArr]},i._data_list_rankGuildManager=function(){var a=this,e=a.data.rankData[gc.dsConsts.GuildWarAllRank.chairArr];return e.length>10&&(e.length=10),e},i._data_list_rankPerson=function(){var a=this,e=a.data.rankData[gc.dsConsts.GuildWarAllRank.userArr];return e.length>10&&(e.length=10),e},i._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:49}).show()},r}(g_base.CloseInfoDlg);a.GuildWarRank=e,egret.registerClass(e,"g_guildwar.GuildWarRank")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(a){function e(){a.apply(this,arguments)}__extends(e,a);var r=(__define,e),t=r.prototype;return t._childrenCreated=function(){a.prototype._childrenCreated.call(this)},t.dataChanged=function(){a.prototype.dataChanged.call(this);var e,r=this,t=r.data,i=t[0],l=t[1],d=t[2];if(0==l)switch(i){case gc.c_prop.guildGroupKey.diamond:e=d[gc.c_guildWarReward_diamond];break;case gc.c_prop.guildGroupKey.wGold:e=d[gc.c_guildWarReward_wgold];break;case gc.c_prop.guildGroupKey.hGold:e=d[gc.c_guildWarReward_hgold];break;case gc.c_prop.guildGroupKey.silver:e=d[gc.c_guildWarReward_silver];break;case gc.c_prop.guildGroupKey.copper:e=d[gc.c_guildWarReward_copper]}else if(1==l)switch(i){case gc.c_prop.guildGroupKey.diamond:e=d[gc.c_guildWarReward_diamondSp];break;case gc.c_prop.guildGroupKey.wGold:e=d[gc.c_guildWarReward_wgoldSp];break;case gc.c_prop.guildGroupKey.hGold:e=d[gc.c_guildWarReward_hgoldSp];break;case gc.c_prop.guildGroupKey.silver:e=d[gc.c_guildWarReward_silverSp];break;case gc.c_prop.guildGroupKey.copper:e=d[gc.c_guildWarReward_copperSp]}else if(2==l)switch(i){case gc.c_prop.guildGroupKey.diamond:e=d[gc.c_guildWarReward_diamondUser];break;case gc.c_prop.guildGroupKey.wGold:e=d[gc.c_guildWarReward_wgoldUser];break;case gc.c_prop.guildGroupKey.hGold:e=d[gc.c_guildWarReward_hgoldUser];break;case gc.c_prop.guildGroupKey.silver:e=d[gc.c_guildWarReward_silverUser];break;case gc.c_prop.guildGroupKey.copper:e=d[gc.c_guildWarReward_copperUser]}r.label_index.text=d[gc.c_guildWarReward_name],uiHelper.setItemsGrp(r.grp_items,utils.kvArrItems2ObjArr(e))},e}(mo.gui.ItemRenderer);a.GuildWarRewardCell=e,egret.registerClass(e,"g_guildwar.GuildWarRewardCell")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(e){function r(){e.apply(this,arguments)}__extends(r,e);var t=(__define,r),i=t.prototype;return i._initProp=function(){e.prototype._initProp.call(this);var r=this;r._layerOpt.shownWithAction=!1,r._Item_list_items=a.GuildWarRewardCell},i._childrenCreated=function(){e.prototype._childrenCreated.call(this);var a=this,r=a.moduleParam.bossId,t=mo.getJSONWithFileName(gc.cfg_c_bossWorld);t[r]},i.dataChanged=function(){e.prototype.dataChanged.call(this);var a=this,r=a.data.group,t=["tit_txt_g_zhuangsijl","tit_txt_g_baijingjl","tit_txt_g_huangingjl","tit_txt_g_baiyingjl","tit_txt_g_qingtongjl"];a.ico_title.source=t[r-1]},i.getPropStr=function(a,e){for(var r="",t=0;t<a.length;++t)e&&t%2==1||(e||t%2!=0)&&(r+="[ubb color=#fff000]"+gc.c_prop.heroProp[a[t][0]]+": [/ubb]",r+="[ubb color=#00ff00]+"+a[t][1]+"[/ubb]",r+="\n");return r},i._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:55}).show()},i._tap_tab_btn=function(){var a=this;a.tab_btn.selectedIndex;a.refreshList("list_items")},i._data_list_items=function(){var a=this,e=a.data.group,r=mo.getJSONWithFileName(gc.cfg_c_guildWarReward),t=[],i=a.tab_btn.selectedIndex;-1==i&&(i=0);for(var l in r){var d=r[l];if(0==i)switch(e){case gc.c_prop.guildGroupKey.diamond:if(!d[gc.c_guildWarReward_diamond])continue;case gc.c_prop.guildGroupKey.wGold:if(!d[gc.c_guildWarReward_wgold])continue;case gc.c_prop.guildGroupKey.hGold:if(!d[gc.c_guildWarReward_hgold])continue;case gc.c_prop.guildGroupKey.silver:if(!d[gc.c_guildWarReward_silver])continue;case gc.c_prop.guildGroupKey.copper:if(!d[gc.c_guildWarReward_copper])continue}else if(1==i)switch(e){case gc.c_prop.guildGroupKey.diamond:if(!d[gc.c_guildWarReward_diamondSp])continue;case gc.c_prop.guildGroupKey.wGold:if(!d[gc.c_guildWarReward_wgoldSp])continue;case gc.c_prop.guildGroupKey.hGold:if(!d[gc.c_guildWarReward_hgoldSp])continue;case gc.c_prop.guildGroupKey.silver:if(!d[gc.c_guildWarReward_silverSp])continue;case gc.c_prop.guildGroupKey.copper:if(!d[gc.c_guildWarReward_copperSp])continue}else if(2==i)switch(e){case gc.c_prop.guildGroupKey.diamond:if(!d[gc.c_guildWarReward_diamondUser])continue;case gc.c_prop.guildGroupKey.wGold:if(!d[gc.c_guildWarReward_wgoldUser])continue;case gc.c_prop.guildGroupKey.hGold:if(!d[gc.c_guildWarReward_hgoldUser])continue;case gc.c_prop.guildGroupKey.silver:if(!d[gc.c_guildWarReward_silverUser])continue;case gc.c_prop.guildGroupKey.copper:if(!d[gc.c_guildWarReward_copperUser])continue}t.push([e,i,r[l]])}return t},r}(mo.gui.Dlg);a.GuildWarRewardLook=e,egret.registerClass(e,"g_guildwar.GuildWarRewardLook")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(e){function r(){e.apply(this,arguments)}__extends(r,e);var t=(__define,r),i=t.prototype;return i.show=function(){var r=this;e.prototype.show.call(this),gd.guildWarCtrl.isOpening()?async.parallel([function(a){gd.guildWarCtrl.getInfo(function(e){a(null,e)},r)},function(a){gd.guildWarCtrl.getGuildList(function(e){a(null,e)},r)}],function(e,t){gd.guildWarCtrl.getWarDefenceData(function(e){a.GuildWarDef.create().setData({defData:e,atkData:r.moduleParam.atkData}).show()},r)}):gd.guildWarCtrl.getSignUpData(function(e){a.GuildWarSign.create().setData({sign:e[0],lv:gd.guildCtrl.getLvl()}).show()},r)},r}(mo.gui.UIScene);a.GuildWarScene=e,egret.registerClass(e,"g_guildwar.GuildWarScene"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var a=new mo.ModuleCfgItem;a.fullScr=!0,a.targetClass=e,mo.moduleMgr.registerModule(a),a.onPreAsync(function(a,e){e()})})}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(e){function r(){e.apply(this,arguments)}__extends(r,e);var t=(__define,r),i=t.prototype;return i._initProp=function(){var r=this;e.prototype._initProp.call(this),r._layerOpt.shownWithAction=!1,r._Item_list_sign=a.GuildWarSignCell,r.registerClassByKey(gd.GuildWarCtrl,gd.GuildWarCtrl.ON_GUILD_OPEN_CHANGE,function(){gd.guildWarCtrl.isOpening()&&gd.guildWarCtrl.enter(function(){async.parallel([function(a){gd.guildWarCtrl.getInfo(function(e){a(null,e)
},r)},function(a){gd.guildWarCtrl.getGuildList(function(e){a(null,e)},r)}],function(e,t){gd.guildWarCtrl.getWarDefenceData(function(e){a.GuildWarDef.create().setData({defData:e}).show()},r)})},r)})},i.dataChanged=function(){e.prototype.dataChanged.call(this);var a=this,r=(mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.guildWar),gd.guildWarCtrl.getCfgData()),t=r[0],i=r[1];a.label_timeSign.text=[t[0],t[1],t[2]>9?t[2]:"0"+t[2],t[3],t[4],t[5]>9?t[5]:"0"+t[5]],a.label_timeActive.text=[i[0],i[1],i[2]>9?i[2]:"0"+i[2],i[3]>9?i[3]:"0"+i[3]],a.label_combat.text=a.data.lv;var l=gd.guildWarCtrl.getLastMyData();l[3]?(a.label_myGuildNo.visible=!0,a.label_myGuildNo.text="结算中",a.label_myGuildRank.text=""):null==l[1]?(a.label_myGuildRank.text="",a.label_myGuildNo.visible=!0,a.label_myGuildNo.text="未参与"):(a.label_myGuildRank.text=gc.c_prop.guildGroup[l[0]]+"组 第"+l[1]+"名",a.label_myGuildNo.visible=!1),l[3]?(a.label_myNo.visible=!0,a.label_myNo.text="结算中",a.label_myRank.text=""):null==l[2]?(a.label_myRank.text="",a.label_myNo.visible=!0,a.label_myNo.text="未参与"):(a.label_myRank.text=gc.c_prop.guildGroup[l[0]]+"组 第"+l[2]+"名",a.label_myNo.visible=!1),a.refreshList("list_sign")},i.getHourStr=function(a){return(a>9?a:"0"+a)+":00"},i._data_list_sign=function(){for(var a=this,e=[],r=gc.c_prop.guildGroupKey.diamond;r<=gc.c_prop.guildGroupKey.hGold;++r)e.push([r,a.data.sign]);return e},i._tap_btn_back=function(){mo.moduleMgr.runModule(g_consts.moduleId.fight)},i._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:63}).show()},r}(mo.gui.Layer);a.GuildWarSign=e,egret.registerClass(e,"g_guildwar.GuildWarSign")}(g_guildwar||(g_guildwar={}));var g_guildwar;!function(a){var e=function(e){function r(){e.apply(this,arguments)}__extends(r,e);var t=(__define,r),i=t.prototype;return i.dataChanged=function(){e.prototype.dataChanged.call(this);var a,r=this,t=r.data,i=0,l=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.guildWar),d=["ico_zsyt","ico_bjf","ico_hjj","ico_byt","ico_qt"];switch(t[0]){case gc.c_prop.guildGroupKey.diamond:a=l[11],i=0;break;case gc.c_prop.guildGroupKey.wGold:a=l[10],i=1;break;case gc.c_prop.guildGroupKey.hGold:a=l[9],i=2;break;case gc.c_prop.guildGroupKey.silver:a=l[8],i=3;break;case gc.c_prop.guildGroupKey.copper:a=l[7],i=4}r.label_condition.text=[a.split(",")[0],a.split(",")[1]],r.ico_title.source=d[i],r.ico_sign.visible=r.data[1]==r.data[0],r.btn_sign.visible=!r.data[1]},i._tap_btn_sign=function(){var a=this,e=a.data;gd.guildWarCtrl.signUp(e[0],function(e){a.delegate.data.sign=e,a.delegate.dataChanged()},a)},i._tap_btn_look=function(){var e=this;a.GuildWarRewardLook.create().setData({group:e.data[0]}).show()},i._tap_ico_lastWeak=function(){var e=this;gd.guildWarCtrl.getLastRankList(e.data[0],function(r){a.GuildWarRank.create().setData({rankData:r,groupId:e.data[0]}).show()},e)},r}(mo.gui.ItemRenderer);a.GuildWarSignCell=e,egret.registerClass(e,"g_guildwar.GuildWarSignCell")}(g_guildwar||(g_guildwar={}));