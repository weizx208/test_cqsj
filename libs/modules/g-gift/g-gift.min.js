var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){var i=this;e.prototype._initProp.call(this),i._Item_list_gift=t.GiftEquipCell},n.dtor=function(){e.prototype.dtor.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.hec=t.get("hec"),t.refreshList("list_gift")},n._data_list_gift=function(){var t=this,e=gd.heroTalismanCtrl.getHaveTrump(t.hec.get(gc.dsConsts.HeroEntity.id)),i=[];for(var a in e)i.push({hec:t.hec,gift:e[a],giftInfo:mo.getJSONWithFileNameAndID(gc.cfg_t_talisman,a)});return i},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:219}).show()},n._tap_btn_back=function(){var t=this;t.close()},i}(mo.gui.Dlg);t.GiftEquip=e,egret.registerClass(e,"g_gift.GiftEquip")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),a=i.prototype;return a._initProp=function(){t.prototype._initProp.call(this)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this)},a.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.hec=e.data.hec,e.gift=e.data.gift,e.giftInfo=e.data.giftInfo,e.label_name.text=[e.gift[0],e.giftInfo[gc.t_talisman_name]],e.label_ziZhi.text=e.gift[1],e.label_star.text=e.gift[2],e.ico_gift.setData({itemId:e.giftInfo[gc.t_talisman_id]});var i=e.giftInfo[gc.t_talisman_id]==gd.heroTalismanCtrl.getTalismanAdorn(e.hec.get(gc.dsConsts.HeroEntity.id));e.ico_equiped.visible=i,e.btn_equip.visible=!i},a._tap_btn_equip=function(){var t=this;gd.heroTalismanCtrl.wearTrump(t.hec.get(gc.dsConsts.HeroEntity.tempId),t.giftInfo[gc.t_talisman_id],function(e){t.dataChanged(),t.delegate.dataChanged()},t)},e}(mo.gui.ItemRenderer);t.GiftEquipCell=e,egret.registerClass(e,"g_gift.GiftEquipCell")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){var i=this;e.prototype._initProp.call(this),i._Item_list_skill=t.GiftSkillCell,i.registerClassByKey(gd.HeroTalismanCtrl,gd.HeroTalismanCtrl.ON_GIFT_CHANGED,i.onGiftChanged)},n.dtor=function(){e.prototype.dtor.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.hec=t.get("hec"),t.gift=t.get("gift"),t.giftInfo=t.get("giftInfo"),t.showStar(t.gift[2]);var i=gd.heroTalismanCtrl.getPropObjBy(t.giftInfo[gc.t_talisman_id],t.gift[1],t.gift[0]);t.label_propL.text=t.getPropStr(i,!0),t.label_propR.text=t.getPropStr(i,!1),t.label_level.text=t.gift[0],t.label_ziZhi.text=t.gift[1],parseInt(t.giftInfo[gc.t_talisman_effectId])>0?(t.effect_gift.effectId=t.giftInfo[gc.t_talisman_effectId],t.effect_gift.startLoadByKey(t.effect_gift.effectId)):t.ico_gift.source=resHelper.getGiftIcon(t.giftInfo[gc.t_talisman_id]),t.ico_giftWord.source=resHelper.getGiftIconWordPath(t.giftInfo[gc.t_talisman_id]),t.refreshList("list_skill")},n.onGiftChanged=function(t,e){var i=this;t==i.giftInfo[gc.t_talisman_id]&&(i.data.gift=e,i.dataChanged())},n.showStar=function(t){for(var e=this,i=0;t>i;++i)e.grp_star.getElementAt(i).source="ico_star";for(var i=t;i<e.grp_star.numElements;++i)if(i>0){var a=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanStar,e.giftInfo[gc.t_talisman_id]+i);a[gc.t_talismanStar_skillId]?e.grp_star.getElementAt(i).source="ico_xinjidenji":e.grp_star.getElementAt(i).source="ico_star_gray"}else e.grp_star.getElementAt(i).source="ico_star_gray"},n.getPropStr=function(t,e){for(var i="",a=33;40>=a;++a)e&&a%2==0||(e||a%2!=1)&&(i+="[ubb color=#fff000]"+gc.c_prop.heroProp[a]+": [/ubb]",i+="[ubb color=#00ff00]+"+(t[a]||0)+"[/ubb]",i+="\n");return i},n._data_list_skill=function(){var t=this;return gd.heroTalismanCtrl.getSkillList(t.giftInfo[gc.t_talisman_id],t.gift[4])},n._tap_btn_lvUp=function(){var e=this;t.GiftLvUp.create().setData({hec:e.hec,gift:e.gift,giftInfo:e.giftInfo}).show()},n._tap_btn_xiLian=function(){var e=this;t.GiftXiLian.create().setData({hec:e.hec,gift:e.gift,giftInfo:e.giftInfo}).show()},n._tap_btn_upStar=function(){var e=this;t.GiftUpStar.create().setData({hec:e.hec,gift:e.gift,giftInfo:e.giftInfo}).show()},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:220}).show()},n._tap_btn_back=function(){var t=this;t.close()},i}(mo.gui.Dlg);t.GiftForge=e,egret.registerClass(e,"g_gift.GiftForge")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),a=i.prototype;return a._initProp=function(){t.prototype._initProp.call(this)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this)},a.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=(e.data.giftInfo,e.data.hec),a=e.data.gongMingInfo,n=e.data.flags,l=(gd.heroTalismanCtrl.getHaveTrump(i.get(gc.dsConsts.HeroEntity.id)),a[gc.t_talismanRes_resonance]);e.ico_gift0.setData({itemId:l[0]}),e.ico_gift1.setData({itemId:l[1]});var r=!0;n&&n[0]?(e.ico_gift0.ico_gift.visible=!0,e.label_noAct0.visible=!1):(e.ico_gift0.ico_gift.visible=!1,e.label_noAct0.visible=!0,r=!1),n&&n[1]?(e.ico_gift1.ico_gift.visible=!0,e.label_noAct1.visible=!1):(e.ico_gift1.ico_gift.visible=!1,e.label_noAct1.visible=!0,r=!1),l[2]?(e.ico_gift2.setData({itemId:l[2]}),e.ico_gift2.visible=!0,e.ico_gongMingBg2.visible=!0,n&&n[2]?(e.ico_gift2.ico_gift.visible=!0,e.label_noAct2.visible=!1):(e.ico_gift2.ico_gift.visible=!1,e.label_noAct2.visible=!0,r=!1)):(e.ico_gift2.visible=!1,e.ico_gongMingBg2.visible=!1,e.label_noAct2.visible=!1);var g=a[gc.t_talismanRes_type],o=a[gc.t_talismanRes_extraPro],_="";if(1==g){for(var s=0;s<o.length;++s)_+=gc.c_prop.heroProp[o[s][0]],_+="+"+o[s][1],_+=" ";_=_.substr(0,_.length-1)}else{var c=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanSkill,o[0][0]);_=c[gc.t_talismanSkill_name]}_=r?"[ubb color=#00ff00]"+_+"[/ubb]":"[ubb color=#ff0000]"+_+"(未激活)[/ubb]",e.label_effect.text=_,e.label_name.text=a[gc.t_talismanRes_name],e.label_desc.text=a[gc.t_talismanRes_desc]},e}(mo.gui.ItemRenderer);t.GiftGongMingCell=e,egret.registerClass(e,"g_gift.GiftGongMingCell")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){var t=this;e.prototype._initProp.call(this),t.registerClassByKey(gd.HeroTalismanCtrl,gd.HeroTalismanCtrl.ON_GIFT_CHANGED,t.onGiftChanged)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,i=t.data.giftInfo,a=t.data.hec,n=i[gc.t_talisman_id];t.ico_gift.setData({itemId:n});var l=gd.heroTalismanCtrl.getHaveTrump(a.get(gc.dsConsts.HeroEntity.id)),r=l[n];if(t.label_combat.text=gd.heroTalismanCtrl.calTaliCombatById(a.get(gc.dsConsts.HeroEntity.id),n),r)t.grp_has.visible=!0,t.grp_no.visible=!1,t.label_lv.text=r[0],t.label_ziZhi.text=r[1],t.label_star.text=r[2],t.ico_gift.setData({itemId:i[gc.t_talisman_id]});else{t.grp_has.visible=!1,t.grp_no.visible=!0,gd.heroTalismanCtrl.isHaveTrupId(n)?(t.btn_act.visible=!0,t.btn_gain.visible=!1):(t.btn_act.visible=!1,t.btn_gain.visible=!0);for(var g=i[gc.t_talisman_skillStar],o=0;g>o;++o)t.grp_star.getElementAt(o).visible=!0;for(var o=g;o<t.grp_star.numElements;++o)t.grp_star.getElementAt(o).visible=!1}},n.onGiftChanged=function(t,e){var i=this;t==i.data.giftInfo[gc.t_talisman_id]&&i.dataChanged()},n._tap_btn_detail=function(){var e=this,i=e.data.giftInfo,a=e.data.hec,n=gd.heroTalismanCtrl.getHaveTrump(a.get(gc.dsConsts.HeroEntity.id));t.GiftForge.create().setData({hec:a,gift:n[i[gc.t_talisman_id]],giftInfo:i}).show()},n._tap_btn_act=function(){var t=this,e=t.data.giftInfo;e[gc.t_talisman_id];gd.heroTalismanCtrl.useTrumpItem(t.data.giftInfo[gc.t_talisman_id],function(){t.dataChanged()},t)},n._tap_btn_gain=function(){var t=this,e=t.data.giftInfo,i=e[gc.t_talisman_id];g_base.GainWay.canBuyFromShop(i)?g_base.GainWayShop.create().setData({itemId:i,count:1}).show().onClose(function(){t.dataChanged()}):g_base.GainWay.create().setData({itemId:i}).show()},i}(mo.gui.ItemRenderer);t.GiftInfoCell=e,egret.registerClass(e,"g_gift.GiftInfoCell")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){var i=this;e.prototype._initProp.call(this);var a={};a[0]=gc.c_prop.pointRedKey.role1_intensify,a[1]=gc.c_prop.pointRedKey.role2_intensify,a[2]=gc.c_prop.pointRedKey.role3_intensify;var n={};n[0]=gc.c_prop.pointRedKey.role1_star,n[1]=gc.c_prop.pointRedKey.role2_star,n[2]=gc.c_prop.pointRedKey.role3_star;var l={};l[0]=gc.c_prop.pointRedKey.role1_gem,l[1]=gc.c_prop.pointRedKey.role2_gem,l[2]=gc.c_prop.pointRedKey.role3_gem,t.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i),i._Item_list_giftInfo=t.GiftInfoCell,i._Item_list_merge=t.GiftMergeCell,i._Item_list_gongMing=t.GiftGongMingCell,i.registerClassByKey(gd.HeroTalismanCtrl,gd.HeroTalismanCtrl.ON_GIFT_CHANGED,i.dataChanged),i.registerClassByKey(gd.HeroTalismanCtrl,gd.HeroTalismanCtrl.ON_GIFT_EQUIP_CHANGED,i.dataChanged)},n._heroChanged=function(t){var e=this;e.setData({hec:t})},n.dtor=function(){e.prototype.dtor.call(this);var i=this;t.roleChgEmitter&&t.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this,i=gd.heroCtrl.getMainHeroCtrl();t.setData({hec:i}),t.tab_str.selectedIndex=0,t._tap_tab_str()},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.hec=t.get("hec"),t._tap_tab_str()},n._tap_tab_str=function(){var t=this,e=t.tab_str.selectedIndex;t.grp_detail.visible=0==e,t.grp_list.visible=1==e,t.grp_merge.visible=2==e,t.grp_gongMing.visible=3==e;var i=t.hec.get(gc.dsConsts.HeroEntity.id);if(0==e){var a=gd.heroTalismanCtrl.calTaliCombat(i);t.label_fabaoProp.text=gc.c_prop.heroJob[t.hec.job],t.label_addCombat.text=[gc.c_prop.heroJob[t.hec.job],a[0]],t.label_numGift.text=a[2],t.label_numSkill.text=a[3],t.label_numGongMing.text=a[4],t.label_propL.text=t.getPropStr(a[1],!0),t.label_propR.text=t.getPropStr(a[1],!1);var n=gd.heroTalismanCtrl.getTalismanAdorn(i);t.ico_gift.setData({itemId:n})}else 1==e?t.refreshList("list_giftInfo"):2==e?t.refreshList("list_merge"):3==e&&t.refreshList("list_gongMing")},n.getPropStr=function(t,e){for(var i="",a=33;40>=a;++a)e&&a%2==0||(e||a%2!=1)&&(i+="[ubb color=#fff000]"+gc.c_prop.heroProp[a]+": [/ubb]",i+="[ubb color=#00ff00]+"+(t[a]||0)+"[/ubb]",i+="\n");return i},n._data_list_giftInfo=function(){var t=this,e=t.hec,i=mo.getJSONWithFileName(gc.cfg_t_talisman),a=[];for(var n in i){var l=i[n];l[gc.t_talisman_job]==e.job&&l[gc.t_talisman_isOpen]&&a.push({hec:e,giftInfo:l})}return a.sort(function(t,i){var a=gd.heroTalismanCtrl.getHaveTrump(e.get(gc.dsConsts.HeroEntity.id)),n=t.giftInfo[gc.t_talisman_id],l=i.giftInfo[gc.t_talisman_id],t=a[n],i=a[l];if(t!=i)return t?-1:1;var r=gd.heroTalismanCtrl.isHaveTrupId(n),g=gd.heroTalismanCtrl.isHaveTrupId(l);return r!=g?r?-1:1:n-l}),a},n._data_list_merge=function(){var t=this,e=t.hec,i=mo.getJSONWithFileName(gc.cfg_t_talisman),a=mo.getJSONWithFileName(gc.cfg_t_talismanCom),n=[];for(var l in i){var r=i[l];if(r[gc.t_talisman_job]==e.job&&r[gc.t_talisman_isOpen]){var g=a[l];g&&n.push({hec:e,giftInfo:r,mergeInfo:g})}}return n},n._data_list_gongMing=function(){var t=this,e=t.hec,i=mo.getJSONWithFileName(gc.cfg_t_talisman),a=mo.getJSONWithFileName(gc.cfg_t_talismanRes),n=[],l=gd.heroTalismanCtrl.getTalismanFg(e.get(gc.dsConsts.HeroEntity.id));for(var r in i){var g=i[r];if(g[gc.t_talisman_job]==e.job&&g[gc.t_talisman_isOpen])for(var o in a){var _=a[o];_[gc.t_talismanRes_resonance][0]==r&&n.push({hec:e,giftInfo:g,gongMingInfo:_,flags:l[o]})}}return n},n._tap_btn_change=function(){var e=this;t.GiftEquip.create().setData({hec:e.hec}).show()},n._tap_btn_help=function(){var t=this,e=t.tab_str.selectedIndex,i=[218,218,218,218];g_base.BaseShowTip.create().setData({id:i[e]}).show()},n._tap_btn_back=function(){mo.moduleMgr.runModule(g_consts.moduleId.fight)},i}(mo.gui.Layer);t.GiftLayer=e,egret.registerClass(e,"g_gift.GiftLayer")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){e.prototype._initProp.call(this)},n.dtor=function(){e.prototype.dtor.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.hec=t.get("hec"),t.gift=t.get("gift"),t.giftInfo=t.get("giftInfo");var i=t.gift[0],a=gd.heroTalismanCtrl.getPropObjBy(t.giftInfo[gc.t_talisman_id],t.gift[1],i),n=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanLvl,t.giftInfo[gc.t_talisman_id]+i),l=mo.getJSONWithFileName(gc.cfg_t_talismanLvl)[t.giftInfo[gc.t_talisman_id]+i+1],r=gd.heroTalismanCtrl.getMaxZiZhi(t.giftInfo[gc.t_talisman_id],t.gift[3]);t.label_curLv.text=i,t.label_curProp.text=t.getPropStr(a),t.label_ziZhi.text=[t.gift[1],r];var g=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.trumpCfg);t.gift[2];t.label_canLvUp.text=n[gc.t_talismanLvl_starLimit];var o=mo.getJSONWithFileName(gc.cfg_t_talismanLvl),_=n[gc.t_talismanLvl_starLimit];for(var s in o)if(o[s][gc.t_talismanLvl_starLimit]==_+1){var c=parseInt(s)%1e3;break}if(c?t.label_canLvUpNext.text=mo.STR.format("%s级后星级上限：%s星",c,_+1):t.label_canLvUpNext.text="星级上限已至最高",i>=g[3])t.label_cannotLvUp.visible=!0,t.grp_lvUp.visible=!1,t.grp_next.visible=!1,t.label_lvUpNoLv.visible=!1;else if(gd.userCtrl.getLvl()<l[gc.t_talismanLvl_userLv]){var f=gd.heroTalismanCtrl.getPropObjBy(t.giftInfo[gc.t_talisman_id],t.gift[1],i+1);t.label_cannotLvUp.visible=!1,t.grp_lvUp.visible=!1,t.label_lvUpNoLv.visible=!0,t.label_lvUpNoLv.text=l[gc.t_talismanLvl_userLv],t.grp_next.visible=!0,t.label_nextLv.text=i+1,t.label_nextProp.text=t.getPropStr(f)}else{var f=gd.heroTalismanCtrl.getPropObjBy(t.giftInfo[gc.t_talisman_id],t.gift[1],i+1);t.label_cannotLvUp.visible=!1,t.label_lvUpNoLv.visible=!1,t.grp_lvUp.visible=!0,t.grp_next.visible=!0,t.label_nextLv.text=i+1,t.label_nextProp.text=t.getPropStr(f);var d=n[gc.t_talismanLvl_needItems];t.ico_item.source=resHelper.getItemIconPath(d[0][0]),t.label_itemName.text=mo.getJSONWithFileNameAndID(gc.cfg_t_item,d[0][0])[gc.t_item_name],t.label_itemNum.text=gd.userCtrl.getItemNum(d[0][0])+"/"+d[0][1],d.length>1?(t.ico_item1.visible=!0,t.grp_item1.visible=!0,t.ico_item1.source=resHelper.getItemIconPath(d[1][0]),t.label_itemName1.text=mo.getJSONWithFileNameAndID(gc.cfg_t_item,d[1][0])[gc.t_item_name],t.label_itemNum1.text=gd.userCtrl.getItemNum(d[1][0])+"/"+d[1][1]):(t.ico_item1.visible=!1,t.grp_item1.visible=!1)}parseInt(t.giftInfo[gc.t_talisman_effectId])>0?(t.effect_gift.effectId=t.giftInfo[gc.t_talisman_effectId],t.effect_gift.startLoadByKey(t.effect_gift.effectId)):t.ico_gift.source=resHelper.getGiftIcon(t.giftInfo[gc.t_talisman_id]),t.ico_giftWord.source=resHelper.getGiftIconWordPath(t.giftInfo[gc.t_talisman_id])},n.getPropStr=function(t){for(var e="",i=33;40>=i;++i){var a=mo.STR.format("%s +%s",gc.c_prop.heroProp[i],t[i]||0);a+="[/br]",e+=a}return e},n._tap_btn_lvUp=function(){var t=this,e=t.gift[0],i=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanLvl,t.giftInfo[gc.t_talisman_id]+e),a=i[gc.t_talismanLvl_needItems],n=0,l=0;if(gd.userCtrl.getItemNum(a[0][0])>=a[0][1]?a.length>1&&gd.userCtrl.getItemNum(a[1][0])<a[1][1]&&(n=a[1][0],l=a[1][1]-gd.userCtrl.getItemNum(a[1][0])):(n=a[0][0],l=a[0][1]-gd.userCtrl.getItemNum(a[0][0])),n){var r=n;g_base.GainWay.canBuyFromShop(r)?g_base.GainWayShop.create().setData({itemId:r,count:l}).show().onClose(function(){t.dataChanged()}):g_base.GainWay.create().setData({itemId:r}).show()}else gd.heroTalismanCtrl.upTrumpLvl(t.hec.get(gc.dsConsts.HeroEntity.tempId),t.giftInfo[gc.t_talisman_id],function(e){t.data.gift=e,t.dataChanged()},t)},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:221}).show()},n._tap_btn_back=function(){var t=this;t.close()},n._tap_btn_buyLingYun=function(){t.GiftBuyLingYun.create().show()},i}(mo.gui.Dlg);t.GiftLvUp=e,egret.registerClass(e,"g_gift.GiftLvUp")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){var i=this;e.prototype._initProp.call(this),i._Item_list_skill=t.GiftSkillCell},n.dtor=function(){e.prototype.dtor.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.hec=t.get("hec"),t.giftInfo=t.get("giftInfo");var i=mo.getJSONWithFileName(gc.cfg_t_talismanCom),a=i[t.giftInfo[gc.t_talisman_id]],n=a[gc.t_talismanCom_reqItems1],l=a[gc.t_talismanCom_reqItems2];t.ico_gift0.setData({itemId:n}),t.ico_gift0.label_giftTitle.visible=!1,t.ico_gift1.setData({itemId:l}),t.ico_gift1.label_giftTitle.visible=!1;var r=mo.getJSONWithFileNameAndID(gc.cfg_t_talisman,n);t.label_name0.text=[a[gc.t_talismanCom_needStar1],r[gc.t_talisman_name]],t.label_lv0.text=a[gc.t_talismanCom_needLvl1];var r=mo.getJSONWithFileNameAndID(gc.cfg_t_talisman,l);t.label_name1.text=[a[gc.t_talismanCom_needStar2],r[gc.t_talisman_name]],t.label_lv1.text=a[gc.t_talismanCom_needLvl2];var g=gd.heroTalismanCtrl.getGiftById(n);g?g[0]<a[gc.t_talismanCom_needLvl1]?t.label_no0.text="(等级未达标)":g[2]<a[gc.t_talismanCom_needStar1]?t.label_no0.text="(星级未达标)":t.label_no0.text="":t.label_no0.text="(未激活)";var o=gd.heroTalismanCtrl.getGiftById(l);o?o[0]<a[gc.t_talismanCom_needLvl2]?t.label_no1.text="(等级未达标)":o[2]<a[gc.t_talismanCom_needStar2]?t.label_no1.text="(星级未达标)":t.label_no1.text="":t.label_no1.text="(未激活)",parseInt(t.giftInfo[gc.t_talisman_effectId])>0?(t.effect_gift.effectId=t.giftInfo[gc.t_talisman_effectId],t.effect_gift.startLoadByKey(t.effect_gift.effectId)):t.ico_gift.source=resHelper.getGiftIcon(t.giftInfo[gc.t_talisman_id]),t.ico_giftWord.source=resHelper.getGiftIconWordPath(t.giftInfo[gc.t_talisman_id])},n._data_list_skill=function(){var t=this;return gd.heroTalismanCtrl.getSkillList(t.giftInfo[gc.t_talisman_id])},n._tap_btn_merge=function(){var t=this;gd.heroTalismanCtrl.compoundTrump(t.hec.get(gc.dsConsts.HeroEntity.tempId),t.giftInfo[gc.t_talisman_id],function(e){t.dataChanged()},t)},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:224}).show()},n._tap_btn_back=function(){var t=this;t.close()},i}(mo.gui.Dlg);t.GiftMerge=e,egret.registerClass(e,"g_gift.GiftMerge")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){e.prototype._initProp.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,i=t.data.giftInfo;t.data.hec;t.ico_gift.setData({itemId:i[gc.t_talisman_id]}),t.label_name.text=i[gc.t_talisman_name],t.label_desc.text=i[gc.t_talisman_desc]},n._tap_btn_merge=function(){var e=this,i=e.data.giftInfo,a=e.data.hec;t.GiftMerge.create().setData({hec:a,giftInfo:i}).show()},i}(mo.gui.ItemRenderer);t.GiftMergeCell=e,egret.registerClass(e,"g_gift.GiftMergeCell")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n.show=function(){e.prototype.show.call(this),g_base.modIdx=3;var i=g_base.BaseTopRole.create().setData({redType:2}).show();i.hideCombat(),t.roleChgEmitter=i.emitter;var a=t.GiftLayer.create();a.show()},n.dtor=function(){e.prototype.dtor.call(this),t.roleChgEmitter=null},i}(mo.gui.UIScene);t.GiftScene=e,egret.registerClass(e,"g_gift.GiftScene"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,t.sysId=gc.id_c_open.openTrump,t.onPreAsync(function(t,e){e()}),mo.moduleMgr.registerModule(t)})}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),a=i.prototype;return a._initProp=function(){t.prototype._initProp.call(this)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this)},a.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=e.data,a=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanSkill,i.skillId);e.ico_skill.source=resHelper.getGiftSkillIconPath(i.skillId),e.label_name.text=a[gc.t_talismanSkill_name],e.label_desc.text=a[gc.t_talismanSkill_desc],i.jiHuo?(e.label_jiHuo.visible=!1,e.label_name.textColor=65280):(e.label_jiHuo.visible=!0,e.label_jiHuo.text=i.star+1,e.label_name.textColor=16711680)},e}(mo.gui.ItemRenderer);t.GiftSkillCell=e,egret.registerClass(e,"g_gift.GiftSkillCell")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){var i=this;e.prototype._initProp.call(this),i._Item_list_skill=t.GiftSkillCell},n.dtor=function(){e.prototype.dtor.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.hec=t.get("hec"),t.gift=t.get("gift"),t.giftInfo=t.get("giftInfo");var i=t.gift[2],a=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanStar,t.giftInfo[gc.t_talisman_id]+i),n=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanLvl,t.giftInfo[gc.t_talisman_id]+t.gift[0]),l=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.trumpCfg),r=gd.heroTalismanCtrl.getMaxZiZhi(t.giftInfo[gc.t_talisman_id],t.gift[3]);if(t.showStar(t.gift[2]),t.label_ziZhi.text=r,i>=l[2])t.label_max.visible=!0,t.label_cannotLvUp.visible=!1,t.grp_upStar.visible=!1;else if(i>=n[gc.t_talismanLvl_starLimit]){t.label_max.visible=!1,t.label_cannotLvUp.visible=!0,t.grp_upStar.visible=!1;for(var g=t.gift[0];g<=l[3]&&(n=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanLvl,t.giftInfo[gc.t_talisman_id]+g),!(n[gc.t_talismanLvl_starLimit]>i));++g);t.label_cannotLvUp.text=[g,n[gc.t_talismanLvl_starLimit]]}else{t.label_max.visible=!1,t.label_cannotLvUp.visible=!1,t.grp_upStar.visible=!0;var o=a[gc.t_talismanStar_needItems][0];t.ico_item.source=resHelper.getItemIconPath(o[0]),t.label_itemName.text=mo.getJSONWithFileNameAndID(gc.cfg_t_item,o[0])[gc.t_item_name],t.label_itemNum.text=gd.userCtrl.getItemNum(o[0])+"/"+o[1]}t.refreshList("list_skill"),parseInt(t.giftInfo[gc.t_talisman_effectId])>0?(t.effect_gift.effectId=t.giftInfo[gc.t_talisman_effectId],t.effect_gift.startLoadByKey(t.effect_gift.effectId)):t.ico_gift.source=resHelper.getGiftIcon(t.giftInfo[gc.t_talisman_id]),t.ico_giftWord.source=resHelper.getGiftIconWordPath(t.giftInfo[gc.t_talisman_id])},n.showStar=function(t){for(var e=this,i=0;t>i;++i)e.grp_star.getElementAt(i).source="ico_star";for(var i=t;i<e.grp_star.numElements;++i)if(i>0){var a=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanStar,e.giftInfo[gc.t_talisman_id]+i);a[gc.t_talismanStar_skillId]?e.grp_star.getElementAt(i).source="ico_xinjidenji":e.grp_star.getElementAt(i).source="ico_star_gray"}else e.grp_star.getElementAt(i).source="ico_star_gray"},n._data_list_skill=function(){var t=this;return gd.heroTalismanCtrl.getSkillList(t.giftInfo[gc.t_talisman_id],t.gift[4])},n._tap_btn_upStar=function(){var e=this,i=e.gift[2],a=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanStar,e.giftInfo[gc.t_talisman_id]+i),n=a[gc.t_talismanStar_needItems][0],l=0,r=0;if(gd.userCtrl.getItemNum(n[0])<n[1]&&(l=n[0],r=n[1]-gd.userCtrl.getItemNum(n[0])),l){var g=l;g_base.GainWay.canBuyFromShop(g)?g_base.GainWayShop.create().setData({itemId:g,count:r}).show().onClose(function(){e.dataChanged()}):g_base.GainWay.create().setData({itemId:g}).show()}else gd.heroTalismanCtrl.upTrumpStar(e.hec.get(gc.dsConsts.HeroEntity.tempId),e.giftInfo[gc.t_talisman_id],function(i){e.data.gift=i[0],e.dataChanged(),t.GiftUpStarResult.create().setData({hec:e.hec,gift:e.gift,giftInfo:e.giftInfo,isGetSkill:i[1],isHighStar:i[2]}).show()},e)},n._tap_btn_reset=function(){var t=this;mo.showMsg(gc.id_c_msgCode.reRecast,function(){gd.heroTalismanCtrl.recastTrump(t.hec.get(gc.dsConsts.HeroEntity.tempId),t.giftInfo[gc.t_talisman_id],function(e){t.data.gift=e,t.dataChanged()},t)})},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:223}).show()},n._tap_btn_back=function(){var t=this;t.close()},n._tap_btn_buyLingYun=function(){t.GiftBuyLingYun.create().show()},i}(mo.gui.Dlg);t.GiftUpStar=e,egret.registerClass(e,"g_gift.GiftUpStar")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),a=i.prototype;return a._initProp=function(){t.prototype._initProp.call(this)},a.dtor=function(){t.prototype.dtor.call(this)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e._skillEfxPlayer=uiHelper.EfxPlayer.create(e.effect_skill)},a.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=(e.data.hec,e.data.gift),a=e.data.giftInfo,n=e.data.isGetSkill,l=e.data.isHighStar,r=a[gc.t_talisman_id],g=i[2],o=mo.getJSONWithFileName(gc.cfg_t_talismanStar),_=o[r+g-1],s=_[gc.t_talismanStar_skillId];if(s){var c=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanSkill,s);n?(e._skillEfxPlayer.play(),e.grp_skill.visible=!0,e.label_noAct.visible=!1,e.ico_skill.source=resHelper.getGiftSkillIconPath(s),e.label_name.text=c[gc.t_talismanSkill_name],e.label_desc.text=c[gc.t_talismanSkill_desc]):(e.grp_skill.visible=!1,e.label_noAct.visible=!0),e.label_noSkill.visible=!1}else e.grp_skill.visible=!1,e.label_noAct.visible=!1,e.label_noSkill.visible=!0;e.label_star.text=[g-1,g],l?e.label_ziZhi.text=[gd.heroTalismanCtrl.getMaxZiZhi(r,g-1),"[ubb color=green]"+gd.heroTalismanCtrl.getMaxZiZhi(r,i[3])+"[/ubb]"]:e.label_ziZhi.text=[gd.heroTalismanCtrl.getMaxZiZhi(r,i[3]),gd.heroTalismanCtrl.getMaxZiZhi(r,i[3])]},e}(mo.gui.Dlg);t.GiftUpStarResult=e,egret.registerClass(e,"g_gift.GiftUpStarResult")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),a=i.prototype;return a._initProp=function(){t.prototype._initProp.call(this)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.img_item.source=resHelper.getItemIconPath(56),e.dataChanged()},a.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.buyLingyunCfg);e.label_cost.text=gd.userCtrl.getBuyLingyunCos(),e.label_num.text=i[0];var a=gd.userCtrl.getVip();mo.getJSONWithFileNameAndID(gc.cfg_c_vip,a);e.label_vip.text=gd.userCtrl.getBuyLingyunCount(),e.label_yuanbao.text=gd.userCtrl.getDiamond()},a._tap_btn_buy=function(){var t=this;gd.userCtrl.buyLingyun(function(){t.dataChanged()},t)},e}(mo.gui.Dlg);t.GiftBuyLingYun=e,egret.registerClass(e,"g_gift.GiftBuyLingYun")}(g_gift||(g_gift={}));var g_gift;!function(t){var e=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var a=(__define,i),n=a.prototype;return n._initProp=function(){var t=this;e.prototype._initProp.call(this),t.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.diamond.toString(),t.diamondChange)},n.dtor=function(){e.prototype.dtor.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t._successEfxPlayer=uiHelper.EfxPlayer.create(t.effect_success)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.hec=t.get("hec"),t.gift=t.get("gift"),t.giftInfo=t.get("giftInfo");var i=t.gift[1],a=gd.heroTalismanCtrl.getMaxZiZhi(t.giftInfo[gc.t_talisman_id],t.gift[3]),n=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.trumpCfg);t.showStar(t.gift[2]),t.label_ziZhi.text=[i,a],t.bar_process.maximum=a,t.bar_process.value=i,t.label_result.visible=!1,t.label_resultSafe.visible=!1,i>=a?(t.grp_xiLian.visible=!1,t.label_max.visible=!0):(t.grp_xiLian.visible=!0,t.label_max.visible=!1,t.ico_item.source=resHelper.getItemIconPath(n[0]),t.label_itemName.text=mo.getJSONWithFileNameAndID(gc.cfg_t_item,n[0])[gc.t_item_name],t.label_itemNum.text=gd.userCtrl.getItemNum(n[0])+"/"+n[1]),t.label_cost.text=n[4],parseInt(t.giftInfo[gc.t_talisman_effectId])>0?(t.effect_gift.effectId=t.giftInfo[gc.t_talisman_effectId],t.effect_gift.startLoadByKey(t.effect_gift.effectId)):t.ico_gift.source=resHelper.getGiftIcon(t.giftInfo[gc.t_talisman_id]),t.ico_giftWord.source=resHelper.getGiftIconWordPath(t.giftInfo[gc.t_talisman_id])},n.showStar=function(t){for(var e=this,i=0;t>i;++i)e.grp_star.getElementAt(i).source="ico_star";for(var i=t;i<e.grp_star.numElements;++i)if(i>0){var a=mo.getJSONWithFileNameAndID(gc.cfg_t_talismanStar,e.giftInfo[gc.t_talisman_id]+i);a[gc.t_talismanStar_skillId]?e.grp_star.getElementAt(i).source="ico_xinjidenji":e.grp_star.getElementAt(i).source="ico_star_gray"}else e.grp_star.getElementAt(i).source="ico_star_gray"},n._tap_btn_xiLian=function(){var t=this,e=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.trumpCfg),i=0,a=0;if(gd.userCtrl.getItemNum(e[0])<e[1]&&(i=e[0],a=e[1]-gd.userCtrl.getItemNum(e[0])),i){var n=i;g_base.GainWay.canBuyFromShop(n)?g_base.GainWayShop.create().setData({itemId:n,count:a}).show().onClose(function(){t.dataChanged()}):g_base.GainWay.create().setData({itemId:n}).show()}else gd.heroTalismanCtrl.baptizeTrump(t.hec.get(gc.dsConsts.HeroEntity.tempId),t.giftInfo[gc.t_talisman_id],t.btn_safe.selected,function(e,i){t.data.gift=e,t.dataChanged();var a=t.gift[1],n=a-i,l=[n];i>0?(l.unshift("[ubb color=green]洗炼成功：[/ubb]"),l.push("[ubb color=green]↑"+a+"[/ubb]"),l.push("[ubb color=green]+"+i+"[/ubb]"),t._successEfxPlayer.play(),t.label_result.text=l,t.label_result.visible=!0,t.label_resultSafe.visible=!1):0>i?(l.unshift("[ubb color=red]洗炼失败：[/ubb]"),l.push("[ubb color=red]↓"+a+"[/ubb]"),l.push("[ubb color=red]"+i+"[/ubb]"),t.label_result.text=l,t.label_result.visible=!0,t.label_resultSafe.visible=!1):(t.label_result.visible=!1,t.label_resultSafe.visible=!0),clearTimeout(t._hideTimerId),t._hideTimerId=setTimeout(function(){clearTimeout(t._hideTimerId),t.label_result.visible=!1,t.label_resultSafe.visible=!1},2e3)},t)},n._tab_btn_safe=function(){var t=this,e=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.trumpCfg);gd.userCtrl.getDiamond()<e[4]&&(t.btn_safe.selected=!1,mo.showMsg(gc.id_c_msgCode.noDiamond))},n.diamondChange=function(){var t=this;if(t.btn_safe.selected){var e=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.trumpCfg);gd.userCtrl.getDiamond()<e[4]&&(t.btn_safe.selected=!1,mo.showMsg(gc.id_c_msgCode.noDiamond))}},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:222}).show()},n._tap_btn_back=function(){var t=this;t.close()},n._tap_btn_buyLingYun=function(){t.GiftBuyLingYun.create().show()},i}(mo.gui.Dlg);t.GiftXiLian=e,egret.registerClass(e,"g_gift.GiftXiLian")}(g_gift||(g_gift={}));