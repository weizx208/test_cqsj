var g_heart;!function(t){var e=function(e){function a(){e.apply(this,arguments)}__extends(a,e);var r=(__define,a),n=r.prototype;return n._initProp=function(){var a=this;e.prototype._initProp.call(this),a._Item_list_heart=t.HeartCell,a._layerOpt.shownWithAction=!1},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this)},n.reset=function(){var t=this;t.refreshList("list_heart")},n._data_list_heart=function(){for(var t=gd.heartStuntCtrl.getData(),e=t[gc.dsConsts.HeartStuntEntity.stateArr],a=[],r=0;3>r;++r)a[r]={id:e[r]||0};return a},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:50}).show()},a}(mo.gui.Layer);t.HeartLayer=e,egret.registerClass(e,"g_heart.HeartLayer"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,t.sysId=gc.id_c_open.heartStunt1,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){gd.heartStuntCtrl.getInfo(function(a){t.data=a,e()},this)})})}(g_heart||(g_heart={}));var g_heart;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var a=(__define,e),r=a.prototype;return r._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,e.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.gold.toString(),e.dataChanged)},r.onExit=function(){var t=this;t._tap_btn_stopAuto()},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.tab_btn.selectedIndex=0,process.nextTick(function(){e._tap_tab_btn()}),e.btn_stopAuto.visible=!1,e._winEfxPlayer=uiHelper.EfxPlayer.create(e.effect_win),e._failEfxPlayer=uiHelper.EfxPlayer.create(e.effect_fail)},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,a=e.data.id,r=gd.heartStuntCtrl.getHeartStuntArr(a),n=(r[0],r[1]),i=(r[2],e["grp_"+a]),l=mo.getJSONWithFileName(gc.cfg_c_heartStunt),o=(mo.getJSONWithFileNameAndID(gc.cfg_c_heartStunt,a),e.oldCeng>0&&e.oldCeng!=n);for(var c in l)e["grp_"+l[c][gc.c_heartStunt_id]].visible=!1;e.oldCeng=n,i.visible=!0;for(var _=e.getIndexAry(n,!1),s=0,g=0,h=2;h>=0;--h){var d=_[h];d?(e["ico_ceng"+h].source="txt_hz_"+d,e["ico_ceng"+h].visible=!0,e["ico_ceng"+h].y=g,g+=23,s=h):e["ico_ceng"+h].visible=!1}e.ico_ceng3.y=g,g+=23,e.grp_ceng.y=200-g/2,e.ico_title.source=resHelper.getHeartTitlePath(a),e.ico_heart_bg.source="heart_bg_"+a,e.showPoint(a,!0),e.onHeartLvChanged(),o&&e._tap_btn_stopAuto()},r.onHeartLvChanged=function(){var t=this,e=t.data.id,a=gd.heartStuntCtrl.getHeartStuntArr(e),r=a[0],n=a[1],i=mo.getJSONWithFileNameAndID(gc.cfg_c_heartStunt,e),l=mo.getJSONWithFileNameAndID(gc.cfg_c_heartStuntLvl,e+r),o=mo.getJSONWithFileName(gc.cfg_c_heartStuntLvl)[e+r+1];if(o){var c=o[gc.c_heartStuntLvl_addProperty];t.grp_canAdd.visible=!0,t.label_maxLevel.visible=!1,t.label_addProp.text=gc.c_prop.heroProp[c[0]],t.label_addValue.text="+"+c[1],t.ico_itemCost0.source=resHelper.getItemIconPath(gc.c_prop.spItemIdKey.genuineQi),t.label_itemNumCost0.text=l[gc.c_heartStuntLvl_cosGenqi],t.label_itemNumCost1.text=l[gc.c_heartStuntLvl_cosGold]}else t.grp_canAdd.visible=!1,t.label_maxLevel.visible=!0,t._tap_btn_stopAuto();t.ico_item0.source=resHelper.getItemIconPath(gc.c_prop.spItemIdKey.genuineQi),t.label_itemNum0.text=gd.demonLotusCtrl.calGenuineQi()[0],t.label_itemNum1.text=gd.userCtrl.getGold();var _=mo.getJSONWithFileNameAndID(gc.cfg_t_skill,i[gc.c_heartStunt_skillId]),s=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.heartStuntCfg);n>s[1]&&(_=mo.getJSONWithFileNameAndID(gc.cfg_t_skill,i[gc.c_heartStunt_skillId2]));for(var g=["一","二","三","四","五","六","七","八","九","十"],h=t.getIndexAry(n,!0),d="",u=0;u<h.length;++u)1==u&&(d+=g[9]),(u!=h.length-1||0!=h[u])&&(1!=h[u]||0!=u||2!=h.length)&&(d+=g[h[u]-1]);var p=_[gc.t_skill_damage]/1e4,f=_[gc.t_skill_buffID];0>=n&&(n=1);var v=10*_[gc.t_skill_cd]/1e3;if(0!=p){var m=_[gc.t_skill_damageScaleA]/1e4;p+=(n-1)*m,t.label_skillDesc.text=mo.STR.format(_[gc.t_skill_desc],Math.abs(Math.round(100*-p)),v)}else if(0!=f){var S=mo.getJSONWithFileNameAndID(gc.cfg_t_buff,f),b=S[gc.t_buff_linerScale],C=(S[gc.t_buff_baseValue1]+b*(n-1))/1e4;C=Math.abs(C),t.label_skillDesc.text=mo.STR.format(_[gc.t_skill_desc],Math.round(100*C),v)}else t.label_skillDesc.text=mo.STR.format(_[gc.t_skill_desc]);t.ico_skill.source=resHelper.getSkillIconPath(_[gc.t_skill_id]),t.label_skillName.text=["附加技能",d],t.label_propL.text=t.getPropStr(e,r,!0),t.label_propR.text=t.getPropStr(e,r,!1)},r.getIndexAry=function(t,e){for(var a=[];t;){var r=t%10;e?a.unshift(r):0==a.length?a.push(r):(a.push(10),r>1&&a.push(r)),t=t/10>>0}return a},r.getPropStr=function(t,e,a){for(var r,n={},i=1;e>=i;++i){r=mo.getJSONWithFileNameAndID(gc.cfg_c_heartStuntLvl,t+i);var l=r[gc.c_heartStuntLvl_addProperty],o=l[0];n[o]=(n[o]||0)+l[1]}for(var c="",i=33;40>=i;++i)a&&i%2==0||(a||i%2!=1)&&(c+="[ubb color=#fff000]"+gc.c_prop.heroProp[i]+": [/ubb]",c+="[ubb color=#00ff00]+"+(n[i]||0)+"[/ubb]",c+="\n");return c},r.showPoint=function(t,e){var a=this,r=gd.heartStuntCtrl.getHeartStuntArr(t),n=r[2],i=a["grp_"+t];if(e){for(var l=0;n>l;++l)i.getElementAt(l).visible=!0;for(var l=n;l<i.numElements;++l)i.getElementAt(l).visible=!1}else n>0&&(i.getElementAt(n-1).visible=!0);var t=a.data.id,r=gd.heartStuntCtrl.getHeartStuntArr(t),o=r[0];mo.getJSONWithFileNameAndID(gc.cfg_c_heartStuntLvl,t+o);n>=10?a.effect_point.visible=!1:(a.effect_point.x=i.x+i.getElementAt(n).x+11,a.effect_point.y=i.y+i.getElementAt(n).y+11)},r._tap_btn_add=function(){var t=this,e=t.data.index,a=t.data.id,r=gd.heartStuntCtrl.getHeartStuntArr(a),n=r[0],i=(r[1],r[2],mo.getJSONWithFileNameAndID(gc.cfg_c_heartStuntLvl,a+n)),l=gd.userCtrl.getGold()>=i[gc.c_heartStuntLvl_cosGold],o=gd.demonLotusCtrl.calGenuineQi()[0]>=i[gc.c_heartStuntLvl_cosGenqi];l&&o?gd.heartStuntCtrl.stuMenCulMethods(e,function(e){var a=e[0];a?t._winEfxPlayer.play():t._failEfxPlayer.play(),t.dataChanged()},t):(l?o||mo.showMsg(gc.id_c_msgCode.noGas):gd.userCtrl.noGolds(function(){},this),t._tap_btn_stopAuto())},r._tap_btn_autoAdd=function(){var t=this;t._autoTimeId=setInterval(function(){t._tap_btn_add()},1e3),t.btn_stopAuto.visible=!0,t.btn_add.visible=!1,t.btn_autoAdd.visible=!1,t.label_auto.visible=!1},r._tap_btn_stopAuto=function(){var t=this;clearInterval(t._autoTimeId),t.btn_stopAuto.visible=!1,t.btn_add.visible=!0,t.btn_autoAdd.visible=!0,t.label_auto.visible=!0},r._tap_tab_btn=function(){var t=this,e=t.tab_btn.selectedIndex;t.grp_prop.visible=0==e,t.grp_add.visible=t.effect_point.visible=1==e;var a=t.data.id,r=gd.heartStuntCtrl.getHeartStuntArr(a),n=r[0];mo.getJSONWithFileNameAndID(gc.cfg_c_heartStuntLvl,a+n);r[2]>=10&&(t.effect_point.visible=!1)},r._tap_btn_close=function(){},r._tap_btn_help=function(){var t=this;g_base.BaseShowTip.create().setData({id:52}).show(),t._tap_btn_stopAuto()},e}(mo.gui.Layer);t.HeartDetail=e,egret.registerClass(e,"g_heart.HeartDetail")}(g_heart||(g_heart={}));var g_heart;!function(t){var e=function(e){function a(){e.apply(this,arguments)}__extends(a,e);var r=(__define,a),n=r.prototype;return n._initProp=function(){e.prototype._initProp.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,a=t.itemIndex,r=t.data.id;if(r){t.grp_can.visible=!1,t.grp_cannot.visible=!1,t.grp_heart.visible=!0;var n=gd.heartStuntCtrl.getHeartStuntArr(r),i=n[1],l=mo.getJSONWithFileNameAndID(gc.cfg_c_heartStunt,r);t.ico_heart.source=resHelper.getHeartIconPath(r),t.ico_title.source=resHelper.getHeartNamePath(r),t.label_ceng.text=i+"",t.label_desc.text=l[gc.c_heartStunt_desc];var o=gd.heartStuntCtrl.getData();o[gc.dsConsts.HeartStuntEntity.stateArr],mo.getJSONWithFileName(gc.cfg_c_heartStunt);t.btn_change.visible=!0}else{t.ico_heart.source="ico_xinfahuitai",t.grp_heart.visible=!1;var c=["一","二","三","四","五","六","七","八","九"],_=gd.heartStuntCtrl.getOpenCon(a);gd.userCtrl.getLvl()>=_[0]||gd.userCtrl.getVip()>=_[1]?(t.grp_can.visible=!0,t.grp_cannot.visible=!1,t.label_title_can.text=c[a]):(t.grp_can.visible=!1,t.grp_cannot.visible=!0,t.label_title_cannot.text=c[a],t.label_cannot.text=_),t.btn_change.visible=!1}},n._tap_rect_touch=function(){var e=this,a=e.itemIndex,r=e.data.id;if(r)t.HeartDetail.create().setData({id:r,index:a}).show().onClose(function(){e.delegate.reset()});else{var n=gd.heartStuntCtrl.getOpenCon(a);gd.userCtrl.getLvl()>=n[0]||gd.userCtrl.getVip()>=n[1]?t.HeartSelect.create().setData({index:a}).show().onClose(function(){e.delegate.reset()}):mo.showMsg(gc.id_c_msgCode.formulaNoOpen,n[0],n[1])}},n._tap_btn_change=function(){var e=this;t.HeartChangeSelect.create().setData({index:e.itemIndex}).show().onClose(function(){e.delegate.reset()})},a}(mo.gui.ItemRenderer);t.HeartCell=e,egret.registerClass(e,"g_heart.HeartCell")}(g_heart||(g_heart={}));var g_heart;!function(t){var e=function(e){function a(){e.apply(this,arguments)}__extends(a,e);var r=(__define,a),n=r.prototype;return n._initProp=function(){var a=this;e.prototype._initProp.call(this),a._Item_list_select=t.HeartSelectCell,a._layerOpt.shownWithAction=!1},n._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.index=t.data.index},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.refreshList("list_select")},n._data_list_select=function(){var t=gd.heartStuntCtrl.getData(),e=t[gc.dsConsts.HeartStuntEntity.stateArr],a=mo.getJSONWithFileName(gc.cfg_c_heartStunt),r=[];for(var n in a){var i=a[n][gc.c_heartStunt_id];-1==e.indexOf(i)&&r.push({id:i})}return r},n._tap_btn_close=function(){},n._tap_btn_help=function(){var t=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.heartStuntCfg);g_base.BaseShowTip.create().setData({id:51,param1:t[2]}).show()},a}(mo.gui.Layer);t.HeartSelect=e,egret.registerClass(e,"g_heart.HeartSelect")}(g_heart||(g_heart={}));var g_heart;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var a=(__define,e),r=a.prototype;return r._initProp=function(){t.prototype._initProp.call(this)},r._childrenCreated=function(){t.prototype._childrenCreated.call(this)},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,a=e.data.id,r=mo.getJSONWithFileNameAndID(gc.cfg_c_heartStunt,a);e.ico_heart.source=resHelper.getHeartIconPath(a),e.ico_name.source=resHelper.getHeartNamePath(a),e.label_desc.text=r[gc.c_heartStunt_desc],e.label_skillDesc.text=r[gc.c_heartStunt_skillDesc]},r._tap_btn_learn=function(){var t=this,e=t.data.id,a=mo.getJSONWithFileNameAndID(gc.cfg_c_heartStunt,e);mo.showMsg(gc.id_c_msgCode.ifLearnFormula,a[gc.c_heartStunt_name],function(){gd.heartStuntCtrl.choMenCulMethods(t.delegate.index,e,function(){t.delegate.close()},t)})},e}(mo.gui.ItemRenderer);t.HeartSelectCell=e,egret.registerClass(e,"g_heart.HeartSelectCell")}(g_heart||(g_heart={}));var g_heart;!function(t){var e=function(e){function a(){e.apply(this,arguments)}__extends(a,e);var r=(__define,a),n=r.prototype;return n._initProp=function(){var a=this;e.prototype._initProp.call(this),a._Item_list_select=t.HeartChangeSelectCell,a._layerOpt.shownWithAction=!1},n._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.index=t.data.index},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.refreshList("list_select");var a=gd.heartStuntCtrl.getData(),r=a[gc.dsConsts.HeartStuntEntity.stateArr],n=r[t.index],i=gd.heartStuntCtrl.getHeartStuntArr(n);t.label_point.text=[i[1],i[2],10];var l=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.heartStuntCfg);t.label_cost.text=l[2]},n._data_list_select=function(){var t=this,e=gd.heartStuntCtrl.getData(),a=e[gc.dsConsts.HeartStuntEntity.stateArr],r=mo.getJSONWithFileName(gc.cfg_c_heartStunt),n=[];for(var i in r){var l=r[i][gc.c_heartStunt_id];a[t.index]!=l&&n.push({id:l})}return n},n._tap_btn_close=function(){},n._tap_btn_help=function(){var t=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.heartStuntCfg);g_base.BaseShowTip.create().setData({id:51,param1:t[2]}).show()},a}(mo.gui.Layer);t.HeartChangeSelect=e,egret.registerClass(e,"g_heart.HeartChangeSelect")}(g_heart||(g_heart={}));var g_heart;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var a=(__define,e),r=a.prototype;return r._initProp=function(){t.prototype._initProp.call(this)},r._childrenCreated=function(){t.prototype._childrenCreated.call(this)},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,a=e.data.id,r=mo.getJSONWithFileNameAndID(gc.cfg_c_heartStunt,a);e.ico_heart.source=resHelper.getHeartIconPath(a),e.ico_name.source=resHelper.getHeartNamePath(a),e.label_desc.text=r[gc.c_heartStunt_desc],e.label_skillDesc.text=r[gc.c_heartStunt_skillDesc]},r._tap_btn_select=function(){var t=this,e=t.data.id;gd.heartStuntCtrl.chaMenCulMethods(t.delegate.index,e,function(){t.delegate.close()},t)},e}(mo.gui.ItemRenderer);t.HeartChangeSelectCell=e,egret.registerClass(e,"g_heart.HeartChangeSelectCell")}(g_heart||(g_heart={}));var g_heart;!function(t){var e=function(e){function a(){e.apply(this,arguments)}__extends(a,e);var r=(__define,a),n=r.prototype;return n.show=function(){var a=this;e.prototype.show.call(this),t.HeartLayer.create().setData(a.moduleParam.data).show()},a}(mo.gui.UIScene);t.HeartScene=e,egret.registerClass(e,"g_heart.HeartScene"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,t.sysId=gc.id_c_open.heartStunt1,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){gd.heartStuntCtrl.getInfo(function(a){t.data=a,e()},this)})})}(g_heart||(g_heart={}));