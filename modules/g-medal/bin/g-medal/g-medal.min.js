var g_medal;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var a=(__define,e),r=a.prototype;return r._initProp=function(){t.prototype._initProp.call(this)},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,a=e.data,r=e.ico_item;e.name="cell_"+a.tempId,r.set("itemId",a.tempId),e.ico_item.set("count",a.count),e.ico_item.label_text.visible=!1,e.label_name.text=a.name},e}(mo.gui.ItemRenderer);t.MedalCell=e,egret.registerClass(e,"g_medal.MedalCell")}(g_medal||(g_medal={}));var g_medal;!function(t){var e=gc.dsConsts,a=function(a){function r(){a.apply(this,arguments)}__extends(r,a);var i=(__define,r),l=i.prototype;return l._initProp=function(){a.prototype._initProp.call(this)},l.dataChanged=function(){a.prototype.dataChanged.call(this);var t=this,r=t.data;t.ico_item.set("itemId",r[gc.t_medal_id]),t.label_name.text=mo.getJSONWithFileNameAndID(gc.cfg_t_item,r[gc.t_medal_id])[gc.t_item_name],t.label_loot.text=r[gc.t_medal_outputWay];var i=r[gc.t_medal_lootArg],l=null!=i;if(t.label_lootArg.visible=t.label_lootArg.includeInLayout=l,l){var n="%s/%s",d=i[0],_=0,s=i[1];1==d&&(_=gd.pkOutCtrl.getAccWinCount()),2==d&&(_=gd.userCtrl.get(e.UserEntity.coffersKillNum)),t.label_lootArg.text=mo.STR.format(n,_,s)}},l._tap_btn_detail=function(){var e=this;t.PrintDetail.create().setData(e.data).show()},r}(mo.gui.ItemRenderer);t.MedalAchiItem=a,egret.registerClass(a,"g_medal.MedalAchiItem")}(g_medal||(g_medal={}));var g_medal;!function(t){function e(t,e,a){for(var r=Math.ceil(e.length/a),i=0,l=r;l>i;i++){var n=t.getChildByName("prop_part"+i);if(!n)break;for(var d="",_=0,s=a;s>_;_++){var o=_+i*a,g=e[o];if(!g)break;d+=mo.STR.format("[ubb color=#ebcd50]%s: [/ubb][ubb color=#4aca00] +%s[/ubb]",gc.c_prop.equipProp[g[0]],g[1]),s>_+1&&(d+="[/br]")}n.text=d}}var a=function(a){function r(){a.apply(this,arguments)}__extends(r,a);var i=(__define,r),l=i.prototype;return l._initProp=function(){a.prototype._initProp.call(this);var e=this;e._layerOpt.shownWithAction=!1,e.tabIndex=0,e.tabCompArr=null,e.tabCompArr=[],e._Item_list_print=t.PrintItem,e._Item_list_medal=t.MedalCell,e._Item_list_achivement=t.MedalAchiItem,e.warPrints=[],e.registerClassByKey(gd.userCtrl,gc.dsConsts.UserEntity.medalTitle.toString(),e._refreshUI),e.registerClassByKey(gd.MedalCtrl,gd.MedalCtrl.ON_STR_SUCC,e._refreshUI),e.registerClassByKey(gd.MedalCtrl,gd.MedalCtrl.ON_ACTVATE_SUCC,e._refreshUI),e.registerClassByKey(gd.userCtrl,gc.dsConsts.UserEntity.bag.toString(),e._refreshMedalGrp)},l._childrenCreated=function(){a.prototype._childrenCreated.call(this);var t=this;t.grp_combat.visible=!1,t.grp_print.visible=!1,t.grp_medal.visible=!1,t.img_printRed.visible=!1,t.tabCompArr=[t.grp_combat,t.grp_print,t.grp_medal,t.grp_achivement],t.tab_medal.selectedIndex=0,process.nextTick(function(){t._tap_tab_medal()})},l._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:44}).show()},l._tap_img_printBg=function(){var e=this,a=gd.medalCtrl,r=a.getMedalTitle(),i=!!r;return i||0!=e.warPrints.length?void t.MedalChange.create().show():mo.showMsg(gc.id_c_msgCode.noMedalActivated)},l._tap_tab_medal=function(){var t=this,e=t.tabIndex=t.tab_medal.selectedIndex,a=t.tabCompArr,r=a[e];if(r){for(var i=0,l=a.length;l>i;i++){var n=a[i];n.visible=!1}t._refreshUI(),r.visible=!0}},l._refreshUI=function(){var t=this;t._refreshTabComp(),t.img_printRed.visible=gd.medalCtrl.isMedalUp().length>0||gd.medalCtrl.getToBeActivatedList().length>0},l._refreshTabComp=function(){var t=this,e=t.tabIndex;0==e?t._refreshCombatGrp():1==e?t._refreshPrintGrp():2==e?t._refreshMedalGrp():3==e&&t._refreshAchivementGrp()},l._refreshCombatGrp=function(){var t=this,a=gd.medalCtrl,r=a.getMedalTitle();t.warPrints=a.getWarPrintedList(),t.img_onNoPrint.source=t.warPrints.length?"ico_kepeidai":"ico_wuzhanyind";var i=!!r;t.ico_medalItem.visible=i,t.img_onNoPrint.visible=!i,e(t.grp_props,a.getTotalPrintProperty(),4),r&&t.ico_medalItem.setData({itemId:r})},l._refreshPrintGrp=function(){var t=this,e=gd.medalCtrl;t.warPrints=e.getAllWarPrintList();t.warPrints.sort(function(t,e){var a=t[0],r=e[0],i=mo.getJSONWithFileNameAndID(gc.cfg_t_item,a),l=mo.getJSONWithFileNameAndID(gc.cfg_t_item,r),n=gd.medalCtrl.transWarPrintData(a)[1],d=mo.getJSONWithFileName(gc.cfg_t_medalLvl),_=d[100*a+n+1],s=gd.medalCtrl.transWarPrintData(r)[1],o=d[100*r+s+1],g=gd.userCtrl.getLvl()>=i[gc.t_item_level],m=gd.userCtrl.getLvl()>=l[gc.t_item_level],c=!gd.medalCtrl.isActiveMedal(a)&&g?1:0,p=!gd.medalCtrl.isActiveMedal(r)&&m?1:0,v=gd.medalCtrl.isMedalItemEnough(a),h=gd.medalCtrl.isMedalItemEnough(r),u=!_||gd.userCtrl.getLvl()>=_[gc.t_medalLvl_needLvl],f=!o||gd.userCtrl.getLvl()>=o[gc.t_medalLvl_needLvl],b=v&&u?1:0,C=h&&f?1:0;if(c!=p)return c?-1:1;if(b!=C)return b?-1:1;if(v!=h)return v?1:-1;if(!u&&!f)return _[gc.t_medalLvl_needLvl]-o[gc.t_medalLvl_needLvl];if(g!=m)return i[gc.t_item_level]-l[gc.t_item_level];var I=gd.medalCtrl.transWarPrintData(a)[2],y=gd.medalCtrl.transWarPrintData(r)[2];return I!=y?y-I:a-r}),t.refreshList("list_print"),t.label_noPrints.visible=0==t.warPrints.length},l._data_list_print=function(){var t=this;return t.warPrints},l._refreshMedalGrp=function(){var t=this;t.refreshList("list_medal")},l._data_list_medal=function(){var t=this,e=gd.BagDataCtrl,a=e.getList(e.getFilterOpt(5),e.getSortOpt(5));return t.label_noMedal.visible=0==a.length,a},l._click_list_medal=function(t){var e=t.item;g_base.BaseItemDetail.create().setData({bdc:e}).show()},l._refreshAchivementGrp=function(){},l._data_list_achivement=function(){return gd.medalCtrl.getAchievmentMedal()},r}(mo.gui.Dlg);t.Medal=a,egret.registerClass(a,"g_medal.Medal"),t.setProps=e,egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=a,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){e()})})}(g_medal||(g_medal={}));var g_medal;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var a=(__define,e),r=a.prototype;return r._initProp=function(){t.prototype._initProp.call(this)},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,a=e.data;e.ico_medalItem.setData({itemId:a[0]})},r._tap_btn_equip=function(){var t=this;gd.medalCtrl.setMedalTitle(t.data[0],function(){t.delegate.close()},t)},e}(mo.gui.ItemRenderer);t.MedalChooseItem=e,egret.registerClass(e,"g_medal.MedalChooseItem")}(g_medal||(g_medal={}));var g_medal;!function(t){var e=function(e){function a(){e.apply(this,arguments)}__extends(a,e);var r=(__define,a),i=r.prototype;return i._initProp=function(){var a=this;e.prototype._initProp.call(this),a._layerOpt.shownWithAction=!1,a._Item_list_print=t.MedalChooseItem},i._childrenCreated=function(){var t=this;e.prototype._childrenCreated.call(this),t.dataChanged()},i.getCurrentSkinState=function(){return gd.medalCtrl.getMedalTitle()?"change":"choose"},i.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,a=gd.medalCtrl;t.warPrints=[];for(var r=a.getWarPrintedList(gd.medalCtrl.getMedalTitle()?1:0),i=0;i<r.length;++i)gd.medalCtrl.isActiveMedal(r[i][0])&&t.warPrints.push(r[i]);t.refreshList("list_print");var l=a.getMedalTitle();if(l){a.getWarPrintData(l);t.ico_medalItem.setData({itemId:l})}},i._data_list_print=function(){var t=this;return t.warPrints},a}(mo.gui.Dlg);t.MedalChange=e,egret.registerClass(e,"g_medal.MedalChange")}(g_medal||(g_medal={}));var g_medal;!function(t){var e=function(e){function a(){e.apply(this,arguments)}__extends(a,e);var r=(__define,a),i=r.prototype;return i._initProp=function(){e.prototype._initProp.call(this)},i._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.img_red.visible=!1,t.ico_medalItem.noAnimate=!0},i.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,a=t.data,r=a[0],i=mo.getJSONWithFileNameAndID(gc.cfg_t_item,r);if(t.ico_item.set("itemId",a[0]),t.ico_item.label_text.visible=!1,t.label_strLvl.text=a[1],t.label_grade.text=a[2],t.ico_medalItem.setData({itemId:r}),gd.medalCtrl.isActiveMedal(r)){var l=mo.getJSONWithFileName(gc.cfg_t_medalLvl),n=l[100*r+a[1]+1];t.btn_str.visible=!0,t.btn_active.visible=!1,t.label_cannotActive.visible=!1,!n||gd.userCtrl.getLvl()>=n[gc.t_medalLvl_needLvl]?(t.label_cannotStr.visible=!1,t.img_red.visible=gd.medalCtrl.isMedalItemEnough(r)):(t.label_cannotStr.visible=!0,t.label_cannotStr.text=n[gc.t_medalLvl_needLvl],t.img_red.visible=!1)}else t.btn_str.visible=!1,t.btn_active.visible=!0,t.label_cannotStr.visible=!1,gd.userCtrl.getLvl()>=i[gc.t_item_level]?(t.label_cannotActive.visible=!1,t.img_red.visible=!0):(t.label_cannotActive.visible=!0,t.label_cannotActive.text=i[gc.t_item_level],t.img_red.visible=!1);var d=mo.getJSONWithFileNameAndID(gc.cfg_t_medal,r),_=d[gc.t_medal_metalType];t.label_medal.visible=3==_,3==_&&(t.label_medal.text=i[gc.t_item_name])},i._tap_btn_str=function(){var e=this;t.PrintStr.create().setData({itemId:e.data[0]}).show()},i._tap_btn_active=function(){var t=this;gd.medalCtrl.activeMedal(t.data[0],function(){t.delegate._refreshPrintGrp()},t)},a.ON_BTN_EQUIP="on_btn_equip",a}(mo.gui.ItemRenderer);t.PrintItem=e,egret.registerClass(e,"g_medal.PrintItem")}(g_medal||(g_medal={}));var g_medal;!function(t){var e=function(e){function a(){e.apply(this,arguments)}__extends(a,e);var r=(__define,a),i=r.prototype;return i._initProp=function(){var t=this;e.prototype._initProp.call(this),t._layerOpt.shownWithAction=!1,t.registerClassByKey(gd.MedalCtrl,gd.MedalCtrl.ON_STR_SUCC,function(){t.setData(gd.medalCtrl.transWarPrintData(t.data[0]))})},i.dataChanged=function(){e.prototype.dataChanged.call(this);var a=this,r=a.data,i=r[0],l=gd.medalCtrl.getStrId(i,r[1]),n=gd.medalCtrl.getStrProperty(i,l);t.setProps(a.grp_props,n,4),a.label_strLvl.text=r[1],a.ico_medalItem.setData({itemId:i});var d=mo.getJSONWithFileNameAndID(gc.cfg_t_medal,i);a.label_loot.text=d[gc.t_medal_outputWay]},i._tap_btn_str=function(){var e=this;t.PrintStr.create().setData({itemId:e.data[0]}).show()},a}(mo.gui.Dlg);t.PrintDetail=e,egret.registerClass(e,"g_medal.PrintDetail")}(g_medal||(g_medal={}));var g_medal;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var a=(__define,e),r=a.prototype;return r._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,e.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.bag.toString(),e.dataChanged),e.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.lvl.toString(),e.dataChanged)},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.ico_item0.label_text.visible=!1,e.ico_item1.label_text.visible=!1,e.ico_item.label_text.visible=!1},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,a=e.data.itemId;e.ico_item.set("itemId",a),e.ico_medalItem.setData(e.data),e._setBeforeEquipInfo(e.grp_before),e._setAfterEquipInfo(e.grp_after),e._setRequireItems();var r=gd.medalCtrl.getWarPrintData(a)[0],i=mo.getJSONWithFileName(gc.cfg_t_medalLvl),l=i[r+1];!l||gd.userCtrl.getLvl()>=l[gc.t_medalLvl_needLvl]?e.label_cannotStr.visible=!1:(e.label_cannotStr.visible=!0,e.label_cannotStr.text=l[gc.t_medalLvl_needLvl])},r._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:44}).show()},r._tap_btn_str=function(){var t=this,e=gd.medalCtrl.transWarPrintData(t.data.itemId)[0],a=mo.getJSONWithFileName(gc.cfg_t_medalLvl),r=a[100*e+1];if(r&&gd.userCtrl.getLvl()<r[gc.t_medalLvl_needLvl])return mo.showMsg(gc.id_c_msgCode.NoLvlOpen);var i=gd.medalCtrl.getWarPrintStrOpt(t.data.itemId);if(i.isItemEnough)gd.medalCtrl.warPrintedStrength(i,function(){t.dataChanged()},t);else{if(!i.medalEnough)return mo.showMsg(gc.id_c_msgCode.noMedal);for(var l=0,n=i.reqItems.length;n>l;l++){var d=i.reqItems[l],e=d[0],_=mo.getJSONWithFileNameAndID(gc.cfg_t_item,e)[gc.t_item_type];if(_!=gc.c_prop.itemTypeKey.medal&&d[1]>gd.userCtrl.getItemNum(e)){g_base.GainWay.canBuyFromShop(e)?g_base.GainWayShop.create().setData({itemId:e,count:d[1]}).show().onClose(function(){t.dataChanged()}):g_base.GainWay.create().setData({itemId:e}).show();break}}}},r._tap_ico_item0=function(){var t=this;t.on_ico_item(0)},r._tap_ico_item1=function(){var t=this;t.on_ico_item(1)},r.on_ico_item=function(t){var e=this,a=e.data.itemId,r=gd.medalCtrl.getWarPrintStrOpt(a),i=r.reqItems,l=i[t],n=gd.BagDataCtrl.create(l[0],1);g_base.BaseItemDetail.create().setData({bdc:n}).show()},r._setRequireItems=function(){var t=this,e=t.data.itemId,a=gd.medalCtrl.getWarPrintStrOpt(e),r=a.reqItems,i=r[0];t.grp_item0.visible=null!=i;var l="%s: %s/%s";if(i){var n=i[0],d=i[1];t.ico_item0.setData({itemId:n}),t.label_reqItem0.text=mo.STR.format(l,t.ico_item0.label_text.text,gd.userCtrl.getItemNum(n),d)}if(i=r[1],t.grp_item1.visible=null!=i,i){var n=i[0],d=i[1];t.ico_item1.setData({itemId:n}),t.label_reqItem1.text=mo.STR.format(l,t.ico_item1.label_text.text,gd.userCtrl.getItemNum(n),d)}},r._setAfterEquipInfo=function(t){var e=this,a=e.data.itemId,r=t.getChildByName("label_name_lvl"),i=t.getChildByName("label_score"),l=t.getChildByName("grp_props").getChildByName("label_props"),n=gd.medalCtrl.getWarPrintStrOpt(a);if(e.grp_strReq.visible=!n.isStrMax,e.grp_after.visible=!n.isStrMax,e.grp_max.visible=n.isStrMax,e.btn_str.visible=!n.isStrMax,!n.isStrMax){var d=n.nextStrId,_=mo.getJSONWithFileNameAndID(gc.cfg_t_medalLvl,d);r.text=mo.STR.format("[ubb color=#E8CA47]强化+%s[/ubb]",_[gc.t_medalLvl_lvl]),i.text=_[gc.t_medalLvl_grade];for(var s,o=gd.medalCtrl.getStrProperty(a,d,!1),g="[ubb color=green]%s: +%s[/ubb][/br]",m="",c=0,p=o.length;p>c;c++){s=o[c];var v=s[0],h=s[1];m+=mo.STR.format(g,gc.c_prop.equipProp[v],h)}l.text=m}},r._setBeforeEquipInfo=function(t){var e=this,a=e.data.itemId,r=t.getChildByName("label_name_lvl"),i=t.getChildByName("label_score"),l=t.getChildByName("grp_props").getChildByName("label_props"),n=gd.medalCtrl.getWarPrintData(a)[0],d=mo.getJSONWithFileNameAndID(gc.cfg_t_medalLvl,n);r.text=mo.STR.format("[ubb color=#E8CA47]强化+%s[/ubb]",d[gc.t_medalLvl_lvl]),i.text=d[gc.t_medalLvl_grade];for(var _,s=gd.medalCtrl.getStrProperty(a,n,!1),o="[ubb]%s: +%s[/ubb][/br]",g="",m=0,c=s.length;c>m;m++){_=s[m];var p=_[0],v=_[1];g+=mo.STR.format(o,gc.c_prop.equipProp[p],v)}l.text=g},e}(mo.gui.Dlg);t.PrintStr=e,egret.registerClass(e,"g_medal.PrintStr")}(g_medal||(g_medal={}));