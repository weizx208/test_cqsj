var g_arena;!function(e){var t=function(t){function a(){t.apply(this,arguments),this.pkUserDatas=[]}__extends(a,t);var r=(__define,a),n=r.prototype;return n._initProp=function(){var a=this;t.prototype._initProp.call(this),a._layerOpt.shownWithAction=!1,a._Item_list_items=e.ArenaItem,a.registerClassByKey(gd.ArenaCtrl,gc.dsConsts.ArenaEntity.reNumData.toString(),a._updatePkNum),a.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.prestige.toString(),a.updataJf)},n.onEnter=function(){t.prototype.onEnter.call(this);var e=this;e.label_myRank.text=gd.arenaCtrl.getRank(),e._updatePkNum(),e.label_jf.text=gd.userCtrl.getPrestige(),e.setCDTime(gd.arenaCtrl.getCDSeconds()),gd.arenaCtrl.getRefreshRemainTime(function(e){}),gd.arenaCtrl.getFightUserList(function(t){e.pkUserDatas=t,e.refreshList("list_items")},e),e._secondTimerId=egret.setInterval(e.onSecond,this,1e3),e.onSecond()},n.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null),e.timeTrigger2&&(tm.timer.remove(e.timeTrigger2),e.timeTrigger2=null),egret.clearInterval(e._secondTimerId)},n.onSecond=function(){var e=this,t=e.getLeftTime();e.label_timeChange.visible=t>0,e.label_timeChange.text=mo.getTimeStr(1e3*t)},n.getLeftTime=function(){var e=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.arenaCfg),t=gd.arenaCtrl.get(gc.dsConsts.ArenaEntity.reNumData),a=t[gc.c_prop.arenaDataKey.lastResetTime],r=0;if(a){var n=e[6]||999999,i=Date.newDate(),s=(i.getTime()-Date.newDate(a).getTime())/1e3>>0;r=n-s}return r},n.updataJf=function(){var e=this;e.label_jf.text=gd.userCtrl.getPrestige()},n._updatePkNum=function(){var e=this;e.label_count.text=mo.STR.format("%s/%s",gd.arenaCtrl.getRePKNum(),10)},n._data_list_items=function(){var e=this;return e.pkUserDatas},n._tap_btn_rank=function(){var t=this;gd.arenaCtrl.getRankList(function(t){e.ArenaRank.create().setData({rankData:t}).show()},t)},n._tap_btn_change=function(){var e=this,t=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.arenaCfg),a=e.getLeftTime();a>0?mo.showMsg(gc.id_c_msgCode.reGetMatch,t[7],function(){gd.arenaCtrl.resetArenaFightRanks(function(){gd.arenaCtrl.getFightUserList(function(t){e.pkUserDatas=t,e.refreshList("list_items")},e)},e)}):gd.arenaCtrl.resetArenaFightRanks(function(){gd.arenaCtrl.getFightUserList(function(t){e.pkUserDatas=t,e.refreshList("list_items")},e)},e)},n._tap_btn_refresh=function(){var e=this;gd.arenaCtrl.refreshCD(function(){e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null),e.resetCdTimeView(0)},e)},n.setCDTime=function(e){var t=this;if(e>0){t.timeTrigger&&(tm.timer.remove(t.timeTrigger),t.timeTrigger=null);var a=Date.newDate(Date.newDate().getTime()+1e3*e),r=t.timeTrigger=new tm.Trigger(a);r.on(tm.Trigger.ON_SECOND,t.timeSec,t),r.on(tm.Trigger.ON_END,t.timeOut,t),tm.timer.add(r)}else t.resetCdTimeView(0)},n.timeSec=function(e,t,a){var r=this,n=Date.newDate().getTime(),i=Date.newDate(a).getTime(),s=i-n;r.resetCdTimeView(s)},n.timeOut=function(e,t,a){var r=this;r.resetCdTimeView(0)},n.resetCdTimeView=function(e){var t=this;e>0?(t.btn_refresh.visible=!0,t.label_time.text=mo.STR.format("下次挑战 %s",mo.getTimeStr(e))):(t.btn_refresh.visible=!1,t.label_time.text="可挑战")},n.setCDTime2=function(e){var t=this;if(e>0){t.timeTrigger&&(tm.timer.remove(t.timeTrigger),t.timeTrigger2=null);var a=Date.newDate(Date.now()+1e3*e),r=t.timeTrigger2=new tm.Trigger(a);r.on(tm.Trigger.ON_SECOND,t.timeSec2,t),r.on(tm.Trigger.ON_END,t.timeOut2,t),tm.timer.add(r)}else t.nexttime(0)},n.timeSec2=function(e,t,a){var r=this,n=Date.now(),i=Date.newDate(a).getTime(),s=i-n;r.nexttime(s)},n.timeOut2=function(e,t,a){var r=this;r.nexttime(0)},n.nexttime=function(e){var t=this;e>0?t.label_next_time.text="竞技场下次重置时间："+mo.getTimeStr(e,!0):t.label_next_time.text="正在重置！"},n._tap_btn_log=function(){var t=this;gd.arenaCtrl.getRecordList(function(t){e.ArenaLog.create().setData({logs:t}).show()},t)},n._tap_btn_buy=function(){mo.moduleMgr.runModule(g_consts.moduleId.arenaShop)},n._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:5}).show()},a}(mo.gui.Dlg);e.Arena=t,egret.registerClass(t,"g_arena.Arena"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=t,e.sysId=gc.id_c_open.arena,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){gd.arenaCtrl.getInfo(function(e){t()},this)})})}(g_arena||(g_arena={}));var g_arena;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var a=(__define,t),r=a.prototype;return r._childrenCreated=function(){e.prototype._childrenCreated.call(this)},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t,a=this,r=a.data,n=["1st","2nd","3rd"];a.label_name.text=r[gc.dsConsts.PKUserData.name],a.label_lv.text=mo.STR.format("Lv.%s",r[gc.dsConsts.PKUserData.lvl]),t=r[gc.dsConsts.PKUserData.rank],3>=t?(a.ico_rank.source="ico_arena_"+n[t-1],a.ico_rank.visible=!0,a.label_rank.visible=!1):(a.label_rank.text=t,a.ico_rank.visible=!1,a.label_rank.visible=!0),t>gd.arenaCtrl.getRank()?a.label_name.textColor=7258977:a.label_name.textColor=13422001,a.label_combat.text=mo.STR.format("战斗力：%s",r[gc.dsConsts.PKUserData.combat]),a.ico_head.setData({icoId:r[gc.dsConsts.PKUserData.iconId],vip:r[gc.dsConsts.PKUserData.vip]});var i=r[gc.dsConsts.PKUserData.guildName]?r[gc.dsConsts.PKUserData.guildName]:"";a.label_guild.text=""==i?"":mo.STR.format("[%s]",i)},r._tap_btn_fight=function(){var e=this;gd.arenaCtrl.fightStart(e.data[gc.dsConsts.PKUserData.rank],function(e){var t=gd.heroCtrl.getFightList();gd.fightCtrl.startPvpFight(t,e,gc.c_prop.fightTypeKey.arena)},e)},r._tap_ico_head=function(){var e=this,t=e.data,a=t[gc.dsConsts.PKUserData.userId];mo.moduleMgr.pushModule(g_consts.moduleId.roleEnemyInfo,{userId:a})},t}(mo.gui.ItemRenderer);e.ArenaItem=t,egret.registerClass(t,"g_arena.ArenaItem")}(g_arena||(g_arena={}));var g_arena;!function(e){var t=function(t){function a(){t.apply(this,arguments)}__extends(a,t);var r=(__define,a),n=r.prototype;return n._childrenCreated=function(){t.prototype._childrenCreated.call(this),this.outsideClosable=!0},n._initProp=function(){t.prototype._initProp.call(this);var a=this;a._Item_list_items=e.ArenaLogItem},n._data_list_items=function(){var e=this;return e.data.logs},a}(mo.gui.Dlg);e.ArenaLog=t,egret.registerClass(t,"g_arena.ArenaLog")}(g_arena||(g_arena={}));var g_arena;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var a=(__define,t),r=a.prototype;return r.dataChanged=function(){e.prototype.dataChanged.call(this);var t,a=this,r=a.data,n=r[gc.dsConsts.ArenaRecordEntity.userId]==r[gc.dsConsts.ArenaRecordEntity.enemyId],i=r[gc.dsConsts.ArenaRecordEntity.isWin],s=mo.timeFormat(r[gc.dsConsts.ArenaRecordEntity.fightTime]),o=r[gc.dsConsts.ArenaRecordEntity.enemyName],g=r[gc.dsConsts.ArenaRecordEntity.fightData].curRank,l=r[gc.dsConsts.ArenaRecordEntity.fightData].changeRank;n?i?(t="[ubb color=0xffaa28]%s[/ubb] [ubb color=0xff1a00]%s[/ubb]向你发起挑战，你胜利了，你的排名不变",a.label_log.text=mo.STR.format(t,s,o)):0!=l?(t="[ubb color=0xffaa28]%s[/ubb] [ubb color=0xff1a00]%s[/ubb]向你发起挑战，你失败了，你的排名下降至第%s名",a.label_log.text=mo.STR.format(t,s,o,g)):(t="[ubb color=0xffaa28]%s[/ubb] [ubb color=0xff1a00]%s[/ubb]向你发起挑战，你失败了，你的排名不变",a.label_log.text=mo.STR.format(t,s,o)):i?0!=l?(t="[ubb color=0xffaa28]%s[/ubb] 你向[ubb color=0xff1a00]%s[/ubb]发起挑战，你胜利了，你的排名上升至第%s名",a.label_log.text=mo.STR.format(t,s,o,g)):(t="[ubb color=0xffaa28]%s[/ubb] 你向[ubb color=0xff1a00]%s[/ubb]发起挑战，你胜利了，你的排名不变",a.label_log.text=mo.STR.format(t,s,o)):(t="[ubb color=0xffaa28]%s[/ubb] 你向[ubb color=0xff1a00]%s[/ubb]发起挑战，你失败了，你的排名不变",a.label_log.text=mo.STR.format(t,s,o))},t}(mo.gui.ItemRenderer);e.ArenaLogItem=t,egret.registerClass(t,"g_arena.ArenaLogItem")}(g_arena||(g_arena={}));var g_arena;!function(e){var t=function(t){function a(){t.apply(this,arguments)}__extends(a,t);var r=(__define,a),n=r.prototype;return n._childrenCreated=function(){t.prototype._childrenCreated.call(this),this.outsideClosable=!0},n._initProp=function(){var a=this;t.prototype._initProp.call(this),a._Item_list_rank=e.ArenaRankItem},n.onEnter=function(){t.prototype.onEnter.call(this);var e=this,a=gd.arenaCtrl.getRank(),r=gd.arenaCtrl.getRankReward(a);e.label_myRank.text=a.toString(),uiHelper.setResGrp(e.grp_res0,gc.c_prop.spItemIdKey.gold,r[0]),uiHelper.setResGrp(e.grp_res1,gc.c_prop.spItemIdKey.honor,r[2])},n.dataChanged=function(){t.prototype.dataChanged.call(this)},n._data_list_rank=function(){var e=this;return e.data.rankData},n._tap_btn_info=function(){e.ArenaRankReward.create().show()},a}(g_base.CloseInfoDlg);e.ArenaRank=t,egret.registerClass(t,"g_arena.ArenaRank")}(g_arena||(g_arena={}));var g_arena;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var a=(__define,t),r=a.prototype;return r._initProp=function(){var t=this;e.prototype._initProp.call(this),t.DS_DATA_KEY=gc.dsConsts.Rank},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,a=t.data,r=t.DS_DATA_KEY,n=a[r.rank],i=["1st","2nd","3rd"];t.label_name.text=a[r.name],t.label_lvl.text=a[r.lvl],t.setRankDesc(),3>=n?(t.ico_rank.source="ico_arena_"+i[n-1],t.ico_rank.visible=!0,t.label_rank.visible=!1):(t.label_rank.text=n,t.ico_rank.visible=!1,t.label_rank.visible=!0),t.ico_head.setData({icoId:a[r.iconId],vip:a[r.vip]}),t.seteRankReward(n)},r.seteRankReward=function(e){var t=this,a=gd.arenaCtrl.getRankReward(e);uiHelper.setResGrp(t.grp_res0,gc.c_prop.spItemIdKey.gold,a[0]),uiHelper.setResGrp(t.grp_res1,gc.c_prop.spItemIdKey.honor,a[2])},r.setRankDesc=function(){var e=this,t=e.data;e.label_combat.text=t[e.DS_DATA_KEY.combat]},t}(mo.gui.ItemRenderer);e.ArenaRankItem=t,egret.registerClass(t,"g_arena.ArenaRankItem")}(g_arena||(g_arena={}));var g_arena;!function(e){var t=function(t){function a(){t.apply(this,arguments)}__extends(a,t);var r=(__define,a),n=r.prototype;return n._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.label_desc.text="排名奖励每日0点结算，结算后1小时内通过邮件发放。 "},n._initProp=function(){t.prototype._initProp.call(this);var a=this;a._Item_list_items=e.ArenaRankRewardCell},n._data_list_items=function(){var e=mo.getJSONWithFileName(gc.cfg_c_arenaRankReward),t=[];for(var a in e)t.push(e[a]);return t},a}(mo.gui.Dlg);e.ArenaRankReward=t,egret.registerClass(t,"g_arena.ArenaRankReward")}(g_arena||(g_arena={}));var g_arena;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var a=(__define,t),r=a.prototype;return r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;if(null!=t.data[gc.c_arenaRankReward_id]){t.data[gc.c_arenaRankReward_id]>8&&(t.label_rank.size=16),t.label_rank.text=t.data[gc.c_arenaRankReward_name];var a=mo.getJSONWithFileNameAndID(gc.cfg_c_reward,t.data[gc.c_arenaRankReward_rewardId]);uiHelper.setResGrp(t.grp_res0,gc.c_prop.spItemIdKey.gold,a[gc.c_reward_gold]),uiHelper.setResGrp(t.grp_res1,gc.c_prop.spItemIdKey.honor,a[gc.c_reward_prestige])}},t}(mo.gui.ItemRenderer);e.ArenaRankRewardCell=t,egret.registerClass(t,"g_arena.ArenaRankRewardCell")}(g_arena||(g_arena={}));