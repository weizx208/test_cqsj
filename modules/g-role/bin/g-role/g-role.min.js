var g_role;!function(e){e.SUBMID_SKILL=1,e.SUBMID_WING=3;var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._heroChanged=function(e,t){var i=this;if(i.setData({hec:e}),3>t){var r=i._isWingUnlocked();i.btn_no_wing.visible=!r,i.btn_wing_light.visible=r}else i.btn_no_wing.visible=!1,i.btn_wing_light.visible=!1},o.dtor=function(){t.prototype.dtor.call(this);var i=this;e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o._childrenCreated=function(){t.prototype._childrenCreated.call(this);var i=this;i.registerClassByKey(gd.HeroEntityCtrl,gd.HeroEntityCtrl.ON_EQUIP_CHANGED,i.dataChanged),i.registerClassByKey(gd.EquipCtrl,gd.EquipCtrl.ON_WEAR_PAR_RING,i.dataChanged),i.registerClassByKey(gd.EquipCtrl,gd.EquipCtrl.ON_BREAK_PAR_RING,i.dataChanged),i.registerClassByKey(gd.EquipCtrl,gd.EquipCtrl.ON_BREAK_MERGED,i.dataChanged),i.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.redPointData.toString(),i.checkRedPoint),i.registerClassByKey(gd.UserCtrl,gc.dsConsts.UserEntity.rebirthLvl.toString(),i._refreshRebirthGrp),e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i),i.ico_medalItem.visible=!1;var r=gc.c_prop.heroEquipIndex;for(var o in r){var a=i["eq_"+o];a&&a.onClick(i._onEquipItemClick,i,a)}var n=i._isWingUnlocked();i.btn_no_wing.visible=!n,i.btn_wing_light.visible=n,i.hec=gd.heroCtrl.getMainHeroCtrl(),i.setData({hec:i.hec});var l=i.moduleParam.subModuleId;switch(l){case e.SUBMID_SKILL:i._tap_btn_skill();break;case e.SUBMID_WING:i._tap_btn_wing_light()}i._refreshRebirthGrp()},o.onEnter=function(){t.prototype.onEnter.call(this)},o.checkRedPoint=function(){var e=this,t=gd.heroCtrl.getHeroIndex(e.hec),i=!1,r=!1,o=!1;0==t?i=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role1_skill):1==t?i=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role2_skill):2==t&&(i=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role3_skill)),0==t?r=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role1_realm):1==t?r=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role2_realm):2==t&&(r=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role3_realm)),0==t?o=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role1_wing):1==t?o=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role2_wing):2==t&&(o=gd.pointCtrl.isShow(gc.c_prop.pointRedKey.role3_wing)),e.img_redSkill.visible=i,e.img_redMatrix.visible=r,e.img_redWing.visible=o},o._isWingUnlocked=function(){var e=mo.getJSONWithFileName(gc.cfg_c_open),t=e[gc.id_c_open.wing][gc.c_open_lvlRequired];return gd.userCtrl.getLvl()>=t},o._refreshRebirthGrp=function(){var e=this,t=gd.reBirthCtrl.getRebirthLvl();0==t?e.grp_rebirth.visible=!1:(e.grp_rebirth.visible=!0,t>=1&&10>=t&&(e.img_rebirthNum.source="txt_hz_"+t))},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.hec=e.get("hec"),e.hec&&(e.updateEquipItems(),e.checkRedPoint(),e.ico_avatar.setData({clothesID:e.hec.getClothDisplayID(),weaponID:e.hec.getWeaponDisplayID(),wingID:e.hec.getWingDisplayID(),sex:e.hec.sex,isKing:e.hec.getIsKing()}))},o.updateEquipItems=function(){var e=this,t=e.hec,i=t.equipData,r=gc.c_prop.heroEquipIndex;for(var o in r){var a,n=i[o],l=e["eq_"+o];l&&(a={hec:t,part:parseInt(o),equipId:n},l.setData(a))}},o._tap_btn_no_wing=function(){var e,t=mo.getJSONWithFileName(gc.cfg_c_open);return e=t[gc.id_c_open.wing][gc.c_open_lvlRequired],gd.userCtrl.getLvl()<e?mo.showMsg(gc.id_c_msgCode.noRoleLvl,e):void 0},o._tap_btn_skill=function(){var t=this;e.RoleSkill.create().setData({hec:t.hec}).show()},o._tap_btn_detail=function(){var t=this,i=t.hec;e.RoleDetail.create().setData({hec:i}).show()},o._tap_btn_matrix=function(){var t,i=this,r=mo.getJSONWithFileName(gc.cfg_c_open);return t=r[gc.id_c_open.ream][gc.c_open_lvlRequired],gd.userCtrl.getLvl()<t?mo.showMsg(gc.id_c_msgCode.noRoleLvl,t):void e.RoleMatrix.create().setData({hec:i.hec}).show()},o._tap_btn_wing_light=function(){var t,i=mo.getJSONWithFileName(gc.cfg_c_open);if(t=i[gc.id_c_open.wing][gc.c_open_lvlRequired],gd.userCtrl.getLvl()<t)return mo.showMsg(gc.id_c_msgCode.noRoleLvl,t);var r=this.hec;e.baseTopRole.hide4thRole(!0),e.RoleWing.create().setData({hec:r}).show().onClose(function(){e.baseTopRole.hide4thRole(!1)})},o._tap_btn_equip=function(){var t=this,i=t.hec;e.EquipDetail.create().setData({hec:i}).show()},o._onEquipItemClick=function(t){gd.equipCtrl.isBreakRing(t.part)?null==t.equipId?e.RoleMatrixInfo.create().setData({hec:t.hec,isMatrix:!1,part:t.part}).show().onClose(function(){}):e.BreakDetail.create().setData({itemId:t.equipId,hero:t.hec}).show().onClose(function(){}):(t.canAdd&&e.EquipChoose.create().setData({hec:t.hec,part:t.part}).show(),t.isEmpty||e.EquipDetail.create().setData({hec:t.hec,part:t.part}).show(),t.isEmpty&&!t.canAdd&&mo.showMsg("无可穿戴装备"))},o._tap_btn_back=function(){mo.moduleMgr.runModule(g_consts.moduleId.fight)},o._tap_btn_buzhen=function(){var t=mo.getJSONWithFileNameAndID(gc.cfg_c_open,gc.id_c_open.fightList),i=mo.getJSONWithFileNameAndID(gc.cfg_c_open,gc.id_c_open.buzhen);return gd.userCtrl.getLvl()<t[gc.c_open_lvlRequired]&&gd.userCtrl.getVip()<i[gc.c_open_lvlRequired]?void mo.showMsg(gc.id_c_msgCode.functionOpen,t[gc.c_open_lvlRequired],i[gc.c_open_lvlRequired]):void(gd.heroCtrl.getList().length>1?e.RoleBuzhen.create().show().onClose(function(){e.baseTopRole.dataChanged()}):mo.showMsg(gc.id_c_msgCode.noRole))},i}(mo.gui.Layer);e.RoleLayer=t,egret.registerClass(t,"g_role.RoleLayer")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var i=this;t.prototype._initProp.call(this),e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o._heroChanged=function(e){var t=this;t.setData({hec:e})},o.dtor=function(){t.prototype.dtor.call(this);var i=this;e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=e.data.hec,r="ID: %s[/br]生    命:    %s[/br]攻    击:    %s[/br]物    防:    %s[/br]法    防:    %s[/br]命    中:    %s[/br]闪    避:    %s[/br]暴    击:    %s[/br]抗    暴:    %s[/br]伤害加深:    %s%[/br]伤害减免:    %s%[/br]麻    痹:    %s%[/br]抗    麻:    %s%[/br]",o=mo.STR.format(r,i.id,i.maxHpFight,i.attackFight,i.defenceFight,i.magicDefenceFight,i.hitFight,i.dodgeFight,i.criticalFight,i.disCriticalFight,Math.round(100*i.damageIncreaseFight),Math.round(100*i.damageDecreaseFight),Math.round(100*i.benumbProFight),Math.round(100*i.disBenumbProFight));e.label_prop.text=o},i}(mo.gui.Layer);e.RoleDetail=t,egret.registerClass(t,"g_role.RoleDetail")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var i=this;t.prototype._initProp.call(this),e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._onHeroChanged,i),i.registerClassByKey(gd.HeroCtrl,gd.HeroCtrl.ON_WEAR_RUNE,i.reset)},o._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.efx_btn.visible=!1,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onIconItemTap,e)},o.onEnter=function(){t.prototype.onEnter.call(this);var e=this;e.reset()},o.reset=function(){for(var e=this,t=e.data.hec,i=t.getHeroRealmList(),r=mo.getJSONWithFileNameAndID(gc.cfg_c_realm,i[0]),o=i[1],a=i[2],n=i[3],l=[[33,0],[34,0],[35,0],[36,0],[37,0],[38,0],[39,0],[40,0]],s=[],_=null==mo.getJSONWithFileName(gc.cfg_c_realm)[i[0]+1],c=r[gc.c_realm_propertys],g=0;g<l.length;++g)for(var p=0;p<c.length;++p)l[g][0]==c[p][0]&&(l[g][1]+=c[p][1]);e.label_name.text=r[gc.c_realm_name];for(var g=0;6>g;++g){var h=mo.gui.helper.getChild(e.grp_item,"ico_item"+g);if(o[g]&&0!=o[g]){for(var d=mo.getJSONWithFileNameAndID(gc.cfg_t_itemRealm,o[g]),u=d[gc.t_itemRealm_propertys],m=0;m<u.length;++m)s.push(u[m]);h.source=resHelper.getItemIconPath(d[gc.t_item_id])}else h.source=null}for(var g=0;6>g;++g){var v=mo.gui.helper.getChild(e.grp_item,"ico_plus"+g);v.visible=!1}for(var g=0;g<a.length;++g){var v=mo.gui.helper.getChild(e.grp_item,"ico_plus"+a[g]);v.visible=t.isSelf}uiHelper.playUIEffect(e.efx_btn,n&&t.isSelf),e.btn_up.visible=t.isSelf&&n,e.btn_equipAll.visible=t.isSelf&&!n;for(var f="",g=0;g<l.length;++g){for(var b=mo.STR.format("%s %s",gc.c_prop.heroProp[l[g][0]],l[g][1]),C=0,p=0;p<s.length;++p)s[p][0]==l[g][0]&&(C+=s[p][1]);C>0&&(b+=mo.STR.format(" [ubb color=green]+%s[/ubb]",C)),b+="[/br]",f+=b}e.label_desc.text=f,_?(e.grp_item.visible=!1,e.label_max.visible=!0,e.btn_equipAll.visible=!1):(e.grp_item.visible=!0,e.label_max.visible=!1)},o._tap_btn_equipAll=function(){var e=this,t=e.data.hec.get(gc.dsConsts.HeroEntity.id);gd.heroCtrl.wearAllRune(t,function(){},e)},o._tap_btn_up=function(){var e=this,t=e.data.hec.get(gc.dsConsts.HeroEntity.id);gd.heroCtrl.upRealm(t,function(){e.effect_round.visible=!0,e.effect_round.startLoadByKey(16),e.effect_round.play(1),e.effect_round.addEventListener(egret.Event.COMPLETE,function(t){e.effect_round.visible=!1,e.effect_round.stop()},e),egret.setTimeout(function(){e.effect_word.visible=!0,e.effect_word.startLoadByKey(14),e.effect_word.play(1),e.effect_word.addEventListener(egret.Event.COMPLETE,function(t){e.effect_word.visible=!1,e.effect_word.stop(),e.reset()},e);for(var t=0;6>t;++t){var i=mo.gui.helper.getChild(e.grp_item,"ico_item"+t),r=new g_comp.UIEffect;r.x=i.x+i.width/2,r.y=i.y+i.height/2,e.grp_item.addElement(r),r.startLoadByKey(15),r.play(1),r.addEventListener(egret.Event.COMPLETE,function(t){e.grp_item.removeElement(t.currentTarget)},e)}},this,1e3)},e)},o.onIconItemTap=function(t){for(var i=this,r=-1,o=0;6>o;++o){var a=mo.gui.helper.getChild(i.grp_item,"ico_item"+o),n=a.globalToLocal(t.stageX,t.stageY),l=new egret.Rectangle(0,0,a.width,a.height);if(l.containsPoint(n)){r=o;break}}if(-1!=r){var s=i.data.hec;(s.isSelf||null!=s.getHeroRealmList()[1][r])&&e.RoleMatrixInfo.create().setData({hec:s,isMatrix:!0,part:r,delegate:i}).show()}},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:7}).show()},o._onHeroChanged=function(e){var t=this;t.setData({hec:e}),t.reset()},o.dtor=function(){t.prototype.dtor.call(this);var i=this;e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._onHeroChanged,i)},i}(mo.gui.Layer);e.RoleMatrix=t,egret.registerClass(t,"g_role.RoleMatrix")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var i=this;t.prototype._initProp.call(this),e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o._heroChanged=function(e){var t=this;t.setData({hec:e}),t._tap_btn_stopAuto()},o.dtor=function(){t.prototype.dtor.call(this);var i=this;e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;this.efx_btn.visible=!1,e._upStarEfxPlayer=uiHelper.EfxPlayer.create(e.efx_hit1),e._hitEfxPlayer=uiHelper.EfxPlayer.create(e.efx_hit2),e._evoEfxPlayer=uiHelper.EfxPlayer.createPlayGroup([e.efx_evo1,e.efx_evo2]),e.grp_stop.visible=!1,e.checkAuto()},o.onEnter=function(){t.prototype.onEnter.call(this),e.baseBottomBar&&(e.baseBottomBar.visible=!1)},o.onExit=function(){t.prototype.onExit.call(this);var i=this;i._tap_btn_stopAuto(),e.baseBottomBar&&(e.baseBottomBar.visible=!0)},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=e.get("hec"),r=i.getWingOpt();e.img_wing.source=resHelper.getWingIconPath(r.wingId),e.label_name.text=r.wingName,e.label_lvl.text=r.wingLvl+"";var o=i.isWingActived(),a=!1;if(i.isSelf){if(e.grp_train.visible=o,e.btn_active.visible=!o,e.btn_evolution.visible=o,uiHelper.playUIEffect(e.efx_btn,!o),o){var n=r.nowStarCount;a=n>=10,e.grp_train.visible=!a,e.btn_evolution.visible=a,uiHelper.playUIEffect(e.efx_btn,a),a&&e._tap_btn_stopAuto()}e.ico_str.visible=o,e.label_cost_gold.text=r.comTrain,e.label_cost_yuanbao.text=r.advTrain,e.label_gold.text=gd.userCtrl.getGold().toString(),e.label_yuanbao.text=gd.userCtrl.getDiamond().toString(),e.label_feather.text=r.featherCount,e.pb_exp.value=r.nowExpPer,e.pb_exp.labelFunction=function(e,t){return mo.STR.format("%s/%s",r.nowExp,r.needExp)}}else e.pb_exp.visible=!1,e.grp_res.visible=!1,e.grp_train.visible=!1,e.btn_active.visible=!1,e.btn_evolution.visible=!1,e.ico_str.visible=!1;var l=r.nowPro,s=r.nextPro;e.label_cAttack.text=l[gc.c_prop.heroPropKey.attackTemp],e.label_cHp.text=l[gc.c_prop.heroPropKey.maxHpTemp],e.label_cPDefense.text=l[gc.c_prop.heroPropKey.defenceTemp],e.label_cMDefense.text=l[gc.c_prop.heroPropKey.magicDefenceTemp],e.grp_next.visible=o&&!a,e.label_nAttack.text=s[gc.c_prop.heroPropKey.attackTemp],e.label_nHp.text=s[gc.c_prop.heroPropKey.maxHpTemp],e.label_nPDefense.text=s[gc.c_prop.heroPropKey.defenceTemp],e.label_nMDefense.text=s[gc.c_prop.heroPropKey.magicDefenceTemp];for(var _=0,c=10;c>_;_++){var g=e.grp_star_light.getChildByName("star_"+_);g.visible=_<r.nowStarCount}},o.fosOne=function(e){var t,i=this,r=i.get("hec"),o=r.getWingOpt();if(e){if(o.gold<o.comTrain)return gd.userCtrl.noGolds(function(){},this),void i._tap_btn_stopAuto();t=gc.c_prop.wingFosTypeKey.comFoster}else{if(o.plumageCount<=0&&o.diamond<o.advTrain)return i._tap_btn_stopAuto(),mo.showMsg(gc.id_c_msgCode.noDiamond);t=gc.c_prop.wingFosTypeKey.advFoster}var a=o.nowStarCount;r.wingFos(o,t,function(e){i.dataChanged();var t=r.wingData[2];t!=a&&i._upStarEfxPlayer.play();var o=e[1];o&&i._hitEfxPlayer.play()},i)},o._tap_btn_normalAuto=function(){var e=this;e._autoTimeId=setInterval(function(){e.fosOne(!0)},1e3),e.checkGrpStop(!0)},o._tap_btn_highAuto=function(){var e=this;e._autoTimeId=setInterval(function(){e.fosOne(!1)},1e3),e.checkGrpStop(!1)},o._tap_btn_stopAuto=function(){var e=this;clearInterval(e._autoTimeId),e.grp_stop.visible=!1,e.grp_fos.visible=!0},o.checkGrpStop=function(e){var t=this,i=t.get("hec"),r=i.getWingOpt();t.grp_stop.visible=!0,t.grp_fos.visible=!1,t.grp_costDescAuto.visible=!e,t.ico_costAuto.source=e?"ico_gold":"ico_yuanbao",t.label_costAuto.text=e?r.comTrain:r.advTrain},o._tap_btn_normal=function(){var e=this;e.fosOne(!0)},o._tap_btn_high=function(){var e=this;e.fosOne(!1)},o._tap_btn_checkAuto=function(){var e=this;e.checkAuto()},o.checkAuto=function(){var e=this;e.btn_checkAuto.selected?(e.btn_normalAuto.visible=!0,e.btn_highAuto.visible=!0,e.btn_normal.visible=!1,e.btn_high.visible=!1):(e.btn_normalAuto.visible=!1,e.btn_highAuto.visible=!1,e.btn_normal.visible=!0,e.btn_high.visible=!0)},o._tap_btn_evolution=function(){var e=this,t=e.get("hec");t.upWing(function(){e.dataChanged(),e._evoEfxPlayer.play()},e)},o._tap_btn_active=function(){var e=this,t=e.get("hec");t.wingActivate(function(){e.dataChanged()},e)},o._tap_btn_help=function(){var e=this,t=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.wingCrit);g_base.BaseShowTip.create().setData({id:12,param1:t[7]}).show(),e._tap_btn_stopAuto()},o._tap_ico_str=function(){var t=this,i=t.get("hec"),r=i.getWingOpt(),o=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.wingCrit);r.wingLvl>=o[7]?(e.RoleWingStr.create().setData({hec:t.data.hec}).show().onClose(function(){t.dataChanged()}),t._tap_btn_stopAuto()):mo.showMsg(gc.id_c_msgCode.wingLevelRequire,o[7])},o._tap_btn_keyUpgrade=function(){var t=this;e.RoleWingUpgrade.create().setData({hec:t.data.hec,root:t}).show()},i}(mo.gui.Layer);e.RoleWing=t,egret.registerClass(t,"g_role.RoleWing")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=__define,o=i,a=o.prototype;return r(a,"isLeft",function(){return this._isLeft},function(e){this._isLeft=e,this.ico_selLeft.alpha=this.isLeft?1:0,this.ico_selRight.alpha=this.isLeft?0:1}),a._initProp=function(){var i=this;t.prototype._initProp.call(this),e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},a._heroChanged=function(e){var t=this;t.setData({hec:e})},a.dtor=function(){t.prototype.dtor.call(this);var i=this;e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.isLeft=!0,e.grp_result.visible=!1,e._winEfxPlayer=uiHelper.EfxPlayer.create(e.effect_win),e._critEfxPlayer=uiHelper.EfxPlayer.create(e.effect_crit),e._failEfxPlayer=uiHelper.EfxPlayer.create(e.effect_fail),e._downEfxPlayer=uiHelper.EfxPlayer.create(e.effect_downLv)},a.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=e.data.hec,r=i.getWingOpt();e.label_name.text=r.wingName,e.label_wingName.text=e.isLeft?"左翼":"右翼",e.label_lvLeft.text="左翼Lv."+r.leftLvl,e.label_lvRight.text="右翼Lv."+r.rightLvl;var o=e.isLeft?r.leftLvl:r.rightLvl,a=o+1,n=mo.getJSONWithFileName(gc.cfg_t_wingStrength),l=n[o],s=n[a],_=void 0==s||!s.hasOwnProperty("A");if(e.label_curLv.text=o+"",e.label_curProp1.text=e.getPropStr(l,e.isLeft,1),e.label_curProp2.text=e.getPropStr(l,e.isLeft,2),_)e.label_maxLv.visible=!0,e.grp_next.visible=!1,e.grp_lvUp.visible=!1,e.label_needWingLv.visible=!1;else{if(e.label_maxLv.visible=!1,e.grp_next.visible=!0,r.wingLvl>=l[gc.t_wingStrength_needWingLvl]){e.grp_lvUp.visible=!0,e.label_needWingLv.visible=!1,e.label_cost.text=l[gc.t_wingStrength_consume]+"";l[gc.t_wingStrength_successPro]/100;e.checkGrpCost()}else e.grp_lvUp.visible=!1,e.label_needWingLv.visible=!0,e.label_needWingLv.text=mo.STR.format("翅膀到达%s阶后可继续强化",l[gc.t_wingStrength_needWingLvl]);e.label_nextLv.text=a,e.label_nextProp1.text=e.getPropStr(s,e.isLeft,1),e.label_nextProp2.text=e.getPropStr(s,e.isLeft,2)}e.label_yuanbao.text=gd.userCtrl.getDiamond().toString(),e.label_feather.text=r.featherCount},a.checkGrpCost=function(){var e=this,t=e.data.hec,i=t.getWingOpt(),r=e.isLeft?i.leftLvl:i.rightLvl,o=mo.getJSONWithFileNameAndID(gc.cfg_t_wingStrength,r);e.btn_useYB.selected?i.plumageCount>=o[gc.t_wingStrength_consume]?e.grp_costYB.owner&&e.grp_costYB.owner.removeElement(e.grp_costYB):(i.plumageCount<=0&&e.grp_cost.owner&&e.grp_cost.owner.removeElement(e.grp_cost),e.label_cost.text=i.plumageCount+"",e.label_costYB.text=5*(o[gc.t_wingStrength_consume]-i.plumageCount)+"",e.grp_costParent.addElement(e.grp_costYB)):(e.grp_costYB.owner&&e.grp_costYB.owner.removeElement(e.grp_costYB),e.label_cost.text=o[gc.t_wingStrength_consume]+"",e.grp_costParent.addElement(e.grp_cost))},a._tap_btn_useYB=function(){var e=this;e.checkGrpCost()},a._tap_ico_selLeft=function(){var e=this;e.isLeft=!0,e.dataChanged()},a._tap_ico_selRight=function(){var e=this;e.isLeft=!1,e.dataChanged()},a._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:42}).show()},a._tap_btn_str=function(){var e=this,t=e.data.hec,i=t.getWingOpt(),r=e.isLeft?i.leftLvl:i.rightLvl,o=mo.getJSONWithFileNameAndID(gc.cfg_t_wingStrength,r);if(i.plumageCount>=o[gc.t_wingStrength_consume]||e.btn_useYB.selected)t.wingStrength(i,e.isLeft?gc.c_prop.wingStrengthKey.left:gc.c_prop.wingStrengthKey.right,e.btn_useYB.selected,function(t){var r=t[0],o=t[1],a=t[2],n=t[3],l=e.isLeft?i.leftLvl:i.rightLvl;mo.getJSONWithFileNameAndID(gc.cfg_t_wingStrength,l),mo.getJSONWithFileNameAndID(gc.cfg_t_wingStrength,o);e.grp_result.visible=!0,r?(e._winEfxPlayer.play(),a&&e._critEfxPlayer.play()):(e._failEfxPlayer.play(),n&&e._downEfxPlayer.play()),e.dataChanged()},e);else{var a=gc.c_prop.spItemIdKey.plumage;g_base.GainWay.canBuyFromShop(a)?g_base.GainWayShop.create().setData({itemId:a,count:o[gc.t_wingStrength_consume]-i.plumageCount}).show().onClose(function(){e.dataChanged()}):g_base.GainWay.create().setData({itemId:a}).show()}},a._tap_btn_confirm=function(){var e=this;e.grp_result.visible=!1},a.getPropStr=function(e,t,i){var r="";return t?1==i?r="翅膀攻击：+"+(e[gc.t_wingStrength_attack]/100).toFixed(1)+"%":2==i&&(r="翅膀物防：+"+(e[gc.t_wingStrength_defence]/100).toFixed(1)+"%"):1==i?r="翅膀生命：+"+(e[gc.t_wingStrength_maxHp]/100).toFixed(1)+"%":2==i&&(r="翅膀法防：+"+(e[gc.t_wingStrength_magicDefence]/100).toFixed(1)+"%"),r},i}(mo.gui.Layer);e.RoleWingStr=t,egret.registerClass(t,"g_role.RoleWingStr")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var i=this;t.prototype._initProp.call(this),i._Item_list_skills=e.SkillItem,e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o._heroChanged=function(e){var t=this;t.setData({hec:e})},o.dtor=function(){t.prototype.dtor.call(this);var i=this;e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.res_bar.visible=e.data.hec.isSelf,e.refreshList("list_skills")},o._data_list_skills=function(){for(var e,t=this,i=t.data.hec,r=[],o=0;o<i.skillIds.length;++o){var a=mo.getJSONWithFileNameAndID(gc.cfg_t_skill,i.skillIds[o]);a[gc.t_skill_canExtends]||(e={heroID:i.get(gc.dsConsts.HeroEntity.id),skillId:i.skillIds[o],skillLv:i.skillLevels[o],index:o,hec:i},r.push(e))}return r},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:1}).show()},i}(mo.gui.Layer);e.RoleSkill=t,egret.registerClass(t,"g_role.RoleSkill")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var i=this;t.prototype._initProp.call(this),e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i),i.registerClassByKey(gd.HeroEntityCtrl,gd.HeroEntityCtrl.ON_EQUIP_CHANGED,i.close)},o._heroChanged=function(e){var t=this;t.setData({hec:e})},o.dtor=function(){t.prototype.dtor.call(this);var i=this;e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o._tap_btn_replace=function(){var t=this,i=t.data.part,r=t.data.hec;e.EquipChange.create().setData({hec:r,part:i}).show()},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=e.data.part,r=e.data.hec,o=r.isPartEquiped(i);if(e.label_noEquip.visible=!o,e.scr_hasEquip.visible=o,e.btn_replace.visible=o&&r.isSelf,e.img_red.visible=!1,o){var a=r.getEquipTempIdByPart(i),n=(r.getEquipIdByPart(i),r.getEquipInfoByPart(i)),l=gd.equipCtrl.equipTrans(n);e.ico_item.setData({itemId:a}),e.label_name.text=l.name;for(var s,_=mo.STR.format("[ubb]评分:%s[/ubb]",l.score),c=l.basePropArr,g=utils.kvArr2KvObj(l.extraPropArr),p="[/br][ubb]%s: %s[/ubb][ubb] +%s[/ubb]",h="[/br][ubb color=0x2EAAF7]%s: %s[/ubb][ubb color=0x2EAAF7] +%s[/ubb]",d=0,u=c.length;u>d;d++){s=c[d];var m=s[0],v=s[1];_+=mo.STR.format(0==d?p:h,gc.c_prop.equipProp[m],v,g[m]||0)}e.label_desc.text=_;var f=r.getStrLvlInfoByEquipPart(i),b=f[0],C=f[1],y=f[2],_=mo.STR.format("[/br][ubb]%s+%s[/ubb]",gc.c_prop.heroProp[C],y);e.label_str_lvl.text=[b,_];var x=r.getStarLvlInfoByEquipPart(i),I=r.getUpStarOpt(i),E=x[0],y=x[1],_=mo.STR.format("[/br][ubb]装备基础属性+%s%[/ubb]",y),R=I.topLv>0?mo.STR.format("[/br][/br][ubb]升星突破：Lv.%s[/ubb][/br]%s+%s",I.topLv,gc.c_prop.heroProp[I.topCurProp[0]],I.topCurProp[1]):"";e.label_str_star.text=[E,_,R],e.gem_stone.setData({hec:r,part:i});var S=r.isEquipReddot();e.img_red.visible=-1!=S.indexOf(i)}},i}(mo.gui.Layer);e.EquipDetail=t,egret.registerClass(t,"g_role.EquipDetail")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var i=this;t.prototype._initProp.call(this),i._Item_list_items=e.EquipChooseItem},o._data_list_items=function(){var e=this,t=e.data.part,i=e.data.hec;return process.nextTick(function(){mo.emitter.emit("equipList")}),gd.BagDataCtrl.getEquipList(i.getStanbyEquip(t))},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,i=e.data.part,r=e.data.hec,o=r.getEquipIdByPart(i),a=gd.equipCtrl.equipTrans(o),n=r.getEquipTempIdByPart(i);e.ico_curEquip.setData({itemId:n});for(var l,s=gd.BagDataCtrl.create(n,o),_=mo.STR.format("[ubb color=%s]%s[/ubb] [ubb]评分:%s[/ubb][/br]",uiHelper.getColorByQuality(s.quality),s.name,s.score),c=s.proptys,g=utils.kvArr2KvObj(a.extraPropArr),p="[ubb]%s: %s[/ubb][ubb] +%s[/ubb][/br]",h="[ubb color=0x2EAAF7]%s: %s[/ubb][ubb color=0x2EAAF7] +%s[/ubb][/br]",d=0,u=c.length;u>d;d++){l=c[d];var m=l[0],v=l[1];_+=mo.STR.format(0==d?p:h,gc.c_prop.equipProp[m],v,g[m]||0)}e.label_curDesc.text=_},o._initItem_list_items=function(t){var i=this,r=i.get("hec");t.emitter.on(e.EquipChooseItem.ON_BTN_EQUIP,function(e){r.changeEquip(i.get("part"),e,i.close,i)},i)},i}(mo.gui.Dlg);e.EquipChange=t,egret.registerClass(t,"g_role.EquipChange")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var i=this;t.prototype._initProp.call(this),i._Item_list_items=e.EquipChooseItem},o._data_list_items=function(){var e=this,t=e.data.part,i=e.data.hec;return process.nextTick(function(){mo.emitter.emit("equipList")}),gd.BagDataCtrl.getEquipList(i.getStanbyEquip(t))},o._initItem_list_items=function(t){var i=this,r=i.data.hec;t.emitter.on(e.EquipChooseItem.ON_BTN_EQUIP,function(e){r.changeEquip(i.data.part,e,i.close,i)},i)},i}(mo.gui.Dlg);e.EquipChoose=t,egret.registerClass(t,"g_role.EquipChoose")}(g_role||(g_role={}));var g_role;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),r=i.prototype;return r._initProp=function(){e.prototype._initProp.call(this)},r._childrenCreated=function(){e.prototype._childrenCreated.call(this)},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.name="eqp_cell_"+t.itemIndex;var i=t.data,r=gd.equipCtrl.equipTrans(i.equipId);t.ico_item.set("itemId",i.tempId);for(var o,a=mo.STR.format("[ubb color=%s]%s[/ubb] [ubb]评分:%s[/ubb][/br]",uiHelper.getColorByQuality(i.quality),i.name,i.score),n=i.proptys,l=utils.kvArr2KvObj(r.extraPropArr),s="[ubb]%s: %s[/ubb][ubb] +%s[/ubb][/br]",_="[ubb color=0x2EAAF7]%s: %s[/ubb][ubb color=0x2EAAF7] +%s[/ubb][/br]",c=0,g=n.length;g>c;c++){o=n[c];var p=o[0],h=o[1];a+=mo.STR.format(0==c?s:_,gc.c_prop.equipProp[p],h,l[p]||0)}t.label_desc.text=a},r._tap_btn_equip=function(){var e=this,t=e.data;e.emitter.emit(e.__class.ON_BTN_EQUIP,t.equipId,e)},t.ON_BTN_EQUIP="on_btn_equip",t}(mo.gui.ItemRenderer);e.EquipChooseItem=t,egret.registerClass(t,"g_role.EquipChooseItem")}(g_role||(g_role={}));var g_role;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),r=i.prototype;return r._childrenCreated=function(){e.prototype._childrenCreated.call(this)},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,i=t.data.skillId,r=t.data.skillLv,o=t.data.index,a=t.data.hec,n=mo.getJSONWithFileNameAndID(gc.cfg_t_skill,i),l=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.skillRate),s=l[4].split(",")[o];t.ico_skill.source=resHelper.getSkillIconPath(i);var _=n[gc.t_skill_damage]/1e4,c=n[gc.t_skill_buffID];0>=r&&(r=1);var g=10*n[gc.t_skill_cd]/1e3;if(0!=_){var p=n[gc.t_skill_damageScaleA]/1e4;_+=(r-1)*p,t.label_desc.text=mo.STR.format(n[gc.t_skill_desc],Math.abs(Math.round(100*-_)),g)}else if(0!=c){var h=mo.getJSONWithFileNameAndID(gc.cfg_t_buff,c),d=h[gc.t_buff_linerScale],u=(h[gc.t_buff_baseValue1]+d*(r-1))/1e4;u=Math.abs(u),t.label_desc.text=mo.STR.format(n[gc.t_skill_desc],Math.round(100*u),g)}else t.label_desc.text=mo.STR.format(n[gc.t_skill_desc]);if(gd.userCtrl.getLvl()<s)t.ico_new.visible=!1,t.label_open.text=mo.STR.format("角色%s级开放",s),t.label_open.visible=!0,t.grp_needMoney.visible=!1,t.label_name.text=mo.STR.format("%s",n[gc.t_skill_name]),t.btn_lvUp.visible=!1;else if(t.ico_new.visible=1==r,t.btn_lvUp.visible=!0,t.label_name.text=mo.STR.format("%s Lv.%s",n[gc.t_skill_name],r),r<gd.userCtrl.getLvl()){t.label_open.visible=!1,t.grp_needMoney.visible=!0,t.btn_lvUp.enabled=!0;var m=mo.getJSONWithFileName(gc.cfg_c_lvl);for(var i in m)if(m[i][gc.c_lvl_upSkillLevel]==r+1){t.label_needMoney.text=m[i][gc.c_lvl_skillNeedGold];break}}else t.label_open.visible=!0,t.grp_needMoney.visible=!1,t.btn_lvUp.enabled=!1,t.label_open.text=mo.STR.format("角色%s级可继续升级",gd.userCtrl.getLvl()+1);a.isSelf||(t.label_open.visible=!1,t.grp_needMoney.visible=!1,t.ico_new.visible=!1,t.btn_lvUp.visible=!1)},r._tap_btn_lvUp=function(){var e=this;gd.heroCtrl.upSkill(e.data.heroID,e.data.index,function(){e.data.skillLv+=1,e.efx_up.gotoAndPlay(0,1),e.dataChanged()},e)},t}(mo.gui.ItemRenderer);e.SkillItem=t,egret.registerClass(t,"g_role.SkillItem")}(g_role||(g_role={}));var g_role;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),r=i.prototype;return r._childrenCreated=function(){e.prototype._childrenCreated.call(this),this.outsideClosable=!0,this.ico_item.label_text.visible=!1},r._initProp=function(){e.prototype._initProp.call(this)},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;this.data.hec&&t.reset()},r.reset=function(){var e,t,i=this,r=i.data.hec,o=i.data.isMatrix,a=i.data.part,n=i.itemId=r.getHeroRealmRune(a)||gd.equipCtrl.getInitBreakRing(a),l=!0;if(n=o?i.itemId=r.getHeroRealmRune(a):i.itemId=gd.equipCtrl.getInitBreakRing(a),t=mo.getJSONWithFileNameAndID(gc.cfg_t_item,n),i.ico_item.setData({itemId:n,count:0}),i.btn_equip.visible=!1,i.btn_gainWay.visible=!1,i.btn_merge.visible=!1,i.btn_ok.visible=!1,t[gc.t_item_type]==gc.c_prop.itemTypeKey.rebirth){e=gd.heroCtrl.getRealmCount(n)>0||gd.heroCtrl.isRuneCom(n)&&gd.heroCtrl.canRuneCom(n);var s=r.getHeroRealmList(),_=s[1];l=_[a]&&0!=_[a];var c=mo.getJSONWithFileNameAndID(gc.cfg_t_itemRealm,n);i.label_prop.text=gd.heroCtrl.getPropsStr(c[gc.t_itemRealm_propertys]);var g=gd.heroCtrl.getRealmCount(n);if(i.label_has.text=mo.STR.format("拥有 %s 件",g),i.ico_red.visible=!l&&e,l)i.btn_ok.visible=!0;else if(g>=1)i.btn_equip.visible=!0;else{var p=gd.heroCtrl.isRuneCom(n)&&gd.heroCtrl.canRuneCom(n);p?i.btn_merge.visible=!0:i.btn_gainWay.visible=!0}i.label_name.text=t[gc.t_item_name],i.label_needLv.text=mo.STR.format("需求等级 lv%s",t[gc.t_item_level])}else{e=-1!=r.isTringReddot().indexOf(a),l=r.getEquipIdByPart(i.data.part);var g=gd.heroCtrl.getRealmCount(n);i.ico_red.visible=!l&&e,l?i.btn_ok.visible=!0:g>=1?i.btn_equip.visible=!0:i.btn_gainWay.visible=!0,i.label_has.text=mo.STR.format("拥有 %s 件",g),i.label_name.text=t[gc.t_item_name],i.label_needLv.text=mo.STR.format("需求等级 lv%s",t[gc.t_item_level]);var h=mo.getJSONWithFileNameAndID(gc.cfg_t_itemBreak,n);i.label_prop.text=h[gc.t_itemBreak_desc]}i.label_has.visible=r.isSelf},r._tap_btn_merge=function(){var e=this;g_base.ItemMerge.create().setData({itemId:e.itemId,delegate:e}).show()},r._tap_btn_ok=function(){this.close()},r._tap_btn_gainWay=function(){var e=this,t=e.itemId;g_base.ItemMerge.create().setData({itemId:t,delegate:e}).show()},r._tap_btn_equip=function(){var e=this,t=e.data.hec.get(gc.dsConsts.HeroEntity.id),i=e.data.part,r=e.itemId,o=mo.getJSONWithFileNameAndID(gc.cfg_t_item,r);o[gc.t_item_type]==gc.c_prop.itemTypeKey.rebirth?gd.heroCtrl.wearRune(t,i,function(){e.data.delegate.reset(),e.close()},e):gd.equipCtrl.wearParRing(t,e.itemId,function(){e.close()},e)},t}(mo.gui.Dlg);e.RoleMatrixInfo=t,egret.registerClass(t,"g_role.RoleMatrixInfo")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1},o._childrenCreated=function(){t.prototype._childrenCreated.call(this)},o.onEnter=function(){t.prototype.onEnter.call(this);var e=this;e.btn_tupo.visible=e.data.hero.isSelf;var i=e.data.itemId,r=mo.getJSONWithFileNameAndID(gc.cfg_t_item,i),o=mo.getJSONWithFileNameAndID(gc.cfg_t_itemBreak,i);e.ico_item.setData({itemId:i,count:0}),e.ico_item.label_text.visible=!1,e.label_name.text=r[gc.t_item_name],e.label_props.text=o[gc.t_itemBreak_desc];var a=parseInt(i)+1,n=mo.getJSONWithFileName(gc.cfg_t_item);if(null!=n[a]){var l=mo.getJSONWithFileNameAndID(gc.cfg_c_compound,a);
e.label_needLv.text="Lv"+l[gc.c_compound_needLvl],e.grp_needLv.visible=!0}else e.grp_needLv.visible=!1},o._tap_btn_tupo=function(){var t=this,i=parseInt(t.data.itemId)+1,r=mo.getJSONWithFileName(gc.cfg_t_item);null!=r[i]?e.BreakTuPo.create().setData({itemId:t.data.itemId,aimItemId:i,hero:t.data.hero,delegate:t}).show():mo.showMsg("特戒已经突破到最高")},i}(mo.gui.Dlg);e.BreakDetail=t,egret.registerClass(t,"g_role.BreakDetail")}(g_role||(g_role={}));var g_role;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),r=i.prototype;return r.onEnter=function(){e.prototype.onEnter.call(this);var t=this,i=t.data.aimItemId,r=mo.getJSONWithFileNameAndID(gc.cfg_t_item,i),o=mo.getJSONWithFileNameAndID(gc.cfg_t_itemBreak,i),a=mo.getJSONWithFileNameAndID(gc.cfg_c_compound,i),n=a[gc.c_compound_reqItems1],l=a[gc.c_compound_reqCount1],s=mo.getJSONWithFileNameAndID(gc.cfg_t_item,n);t.ico_item.setData({itemId:i,count:0}),t.ico_item.label_text.visible=!1,t.label_name.text=r[gc.t_item_name],t.label_props.text=o[gc.t_itemBreak_desc],t.ico_item2.setData({itemId:n,count:l,pileCount:gd.heroCtrl.getRealmCount(n)}),t.label_name2.text=s[gc.t_item_name],gd.userCtrl.get(gc.dsConsts.UserEntity.lvl)>=a[gc.c_compound_needLvl]?(t.grp_needLv.visible=!1,t.btn_tupo.visible=!0):(t.label_needLv.text="Lv"+a[gc.c_compound_needLvl],t.grp_needLv.visible=!0,t.btn_tupo.visible=!1)},r._tap_btn_tupo=function(){var e=this,t=e.data.hero,i=t.get(gc.dsConsts.HeroEntity.id),r=e.data.itemId,o=parseInt(r),a=mo.getJSONWithFileName(gc.cfg_c_compound),n=mo.getJSONWithFileName(gc.cfg_t_itemBreak),l=gd.heroCtrl.getEquipData(i),s=gd.userCtrl.get(gc.dsConsts.UserEntity.bag),_=n[o][gc.t_itemBreak_position];if(!l[_]||l[_]!=o)return mo.showMsg("还未拥有用于突破的特戒");if(!a[o+1])return mo.showMsg("特戒已经突破到最高");var c=e.data.aimItemId,g=a[c][gc.c_compound_reqItems1],p=a[c][gc.c_compound_reqCount1],h=s[g]||0;p>h?g_base.ItemMerge.create().setData({itemId:g}).show():gd.equipCtrl.ringBreak(i,r,function(){e.data.delegate.close(),e.close()},e)},r._tap_ico_item2=function(){var e=this,t=e.data.aimItemId,i=mo.getJSONWithFileNameAndID(gc.cfg_c_compound,t),r=i[gc.c_compound_reqItems1];g_base.ItemMerge.create().setData({itemId:r}).show()},t}(mo.gui.Dlg);e.BreakTuPo=t,egret.registerClass(t,"g_role.BreakTuPo")}(g_role||(g_role={}));var g_role;!function(e){logger.initLogger(e,"g-role"),logger.setLvl("g-role",4);var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o.show=function(){var i=this;t.prototype.show.call(this);var r=e.baseTopRole=g_base.BaseTopRole.create().show();e.roleChgEmitter=r.emitter;var o=e.RoleLayer.create();o.moduleParam=i.moduleParam,o.show(),e.baseBottomBar=g_base.BaseBottomBar.create().show()},o.dtor=function(){t.prototype.dtor.call(this),e.roleChgEmitter=null},i}(mo.gui.UIScene);e.RoleScene=t,egret.registerClass(t,"g_role.RoleScene"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,e.onValid(function(e){var t,i=mo.getJSONWithFileName(gc.cfg_c_open);return e&&3==e.subModuleId&&(t=i[gc.id_c_open.wing][gc.c_open_lvlRequired]),null!=t&&t>gd.userCtrl.getLvl()?(mo.showMsg(gc.id_c_msgCode.noRoleLvl,t),!1):(g_base.modIdx=2,!0)}),e.onPreAsync(function(e,t){t()}),mo.moduleMgr.registerModule(e)})}(g_role||(g_role={}));var g_role;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),r=i.prototype;return r._initProp=function(){var t=this;e.prototype._initProp.call(this),mo.gui.helper.setSkinName(this,g_base.BaseTopRole.__className),t._curHeroIdx=0},r._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.label_nickName.visible=!0,t.img_title.visible=!1,t.ico_hero0.onClick(t.onIconClick,t),t.ico_hero1.onClick(t.onIconClick,t),t.ico_hero2.onClick(t.onIconClick,t),t.ico_hero3.onClick(t.onIconClick,t);var i=gd.enemyHeroCtrl.getHeroByIndex(0);t._curHeroIdx=0,t.label_job.text=gc.c_prop.heroJob[i.job],t.label_combat.text=i.combat,t.label_nickName.text=gd.enemyHeroCtrl.getUserName(),t.setRoleSelected(t.ico_hero0),t.dataChanged()},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.ico_hero0.setData({index:0,heroCtrl:gd.enemyHeroCtrl}),t.ico_hero1.setData({index:1,heroCtrl:gd.enemyHeroCtrl}),t.ico_hero2.setData({index:2,heroCtrl:gd.enemyHeroCtrl}),t.ico_hero3.setData({index:3,heroCtrl:gd.enemyHeroCtrl}),t.img_title.source=0==(t.data.redType||0)?"ntc_text_role":"ntc_text_forge"},r.setRoleSelected=function(e){var t=this;t.ico_hero0.setSelected(!1),t.ico_hero1.setSelected(!1),t.ico_hero2.setSelected(!1),t.ico_hero3.setSelected(!1),e.setSelected(!0)},r.onIconClick=function(e){var t=this,i=e.data.index;if(gd.enemyHeroCtrl.hasHeroByIndex(i)){t.setRoleSelected(e),t._curHeroIdx=i;var r=gd.enemyHeroCtrl.getHeroByIndex(i);t.emitter.emit(t.__class.ON_HERO_CHANGED,r,i,t),t.label_job.text=gc.c_prop.heroJob[r.job],t.label_combat.text=r.combat}},r.hide4thRole=function(e){var t=this;t.ico_hero3.visible=!e,t.ico_hero3.includeInLayout=!e},t.ON_HERO_CHANGED="on_hero_changed",t}(mo.gui.MenuLayer);e.EnemyTopRole=t,egret.registerClass(t,"g_role.EnemyTopRole")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){t.prototype._initProp.call(this),mo.gui.helper.setSkinName(this,e.RoleLayer.__className)},o._heroChanged=function(e,t){var i=this;if(i.setData({hec:e}),3>t){var r=i._isWingUnlocked();i.btn_no_wing.visible=!r,i.btn_wing_light.visible=r}else i.btn_no_wing.visible=!1,i.btn_wing_light.visible=!1},o.dtor=function(){t.prototype.dtor.call(this);var i=this;e.roleChgEmitter.un(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i)},o._childrenCreated=function(){t.prototype._childrenCreated.call(this);var i=this;i.checkRedPoint();var r=i.topRoleLayer=e.EnemyTopRole.create().show();e.roleChgEmitter=r.emitter,e.roleChgEmitter.on(g_base.BaseTopRole.ON_HERO_CHANGED,i._heroChanged,i);var o=gc.c_prop.heroEquipIndex;for(var a in o){var n=i["eq_"+a];n.onClick(i._onEquipItemClick,i,n)}var l=i._isWingUnlocked();i.btn_no_wing.visible=!l,i.btn_wing_light.visible=l,i.hec=gd.enemyHeroCtrl.getMainHeroCtrl(),i.setData({hec:i.hec}),i._refreshRebirthGrp(),i.btn_buzhen.visible=!1},o.onEnter=function(){t.prototype.onEnter.call(this)},o._refreshRebirthGrp=function(){var e=this,t=e.hec.getRebirthLvl();0==t?e.grp_rebirth.visible=!1:(e.grp_rebirth.visible=!0,t>=1&&10>=t&&(e.img_rebirthNum.source="txt_hz_"+t))},o.checkRedPoint=function(){var e=this;e.img_redSkill.visible=!1,e.img_redMatrix.visible=!1,e.img_redWing.visible=!1},o._isWingUnlocked=function(){var e=mo.getJSONWithFileName(gc.cfg_c_open),t=e[gc.id_c_open.wing][gc.c_open_lvlRequired];return gd.enemyHeroCtrl.getLvl()>=t},o.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;if(e.hec=e.get("hec"),e.hec){e.updateEquipItems(),e.ico_avatar.setData({clothesID:e.hec.getClothDisplayID(),weaponID:e.hec.getWeaponDisplayID(),wingID:e.hec.getWingDisplayID(),sex:e.hec.sex,isKing:e.hec.getIsKing()});var i=e.hec.getMedalTitle(),r=!!i;e.ico_medalItem.visible=r&&gd.enemyHeroCtrl.getMainHeroCtrl()==e.hec,r&&e.ico_medalItem.setData({itemId:i})}},o.updateEquipItems=function(){var e=this,t=e.hec,i=t.equipData,r=gc.c_prop.heroEquipIndex;for(var o in r){var a,n=i[o],l=e["eq_"+o];l&&(a={hec:t,part:parseInt(o),equipId:n},l.setData(a))}},o._tap_btn_skill=function(){var t=this;e.RoleSkill.create().setData({hec:t.hec}).show()},o._tap_btn_detail=function(){var t=this,i=t.hec;e.RoleDetail.create().setData({hec:i}).show()},o._tap_btn_matrix=function(){var t,i=this,r=mo.getJSONWithFileName(gc.cfg_c_open);return t=r[gc.id_c_open.ream][gc.c_open_lvlRequired],gd.userCtrl.getLvl()<t?mo.showMsg(gc.id_c_msgCode.noRoleLvl,t):void e.RoleMatrix.create().setData({hec:i.hec}).show().onClose(function(){})},o._tap_btn_wing_light=function(){var t,i=this,r=mo.getJSONWithFileName(gc.cfg_c_open);if(t=r[gc.id_c_open.wing][gc.c_open_lvlRequired],gd.userCtrl.getLvl()<t)return mo.showMsg(gc.id_c_msgCode.noRoleLvl,t);var o=this.hec;i.topRoleLayer.hide4thRole(!0),e.RoleWing.create().setData({hec:o}).show().onClose(function(){i.topRoleLayer.hide4thRole(!1)})},o._onEquipItemClick=function(t){gd.equipCtrl.isBreakRing(t.part)?null!=t.equipId&&e.BreakDetail.create().setData({itemId:t.equipId,hero:t.hec}).show().onClose(function(){}):t.isEmpty||e.EquipDetail.create().setData({hec:t.hec,part:t.part}).show()},o._tap_btn_back=function(){var e=this;e.topRoleLayer.close(),e.close()},i}(mo.gui.Layer);e.RoleEnemyInfo=t,egret.registerClass(t,"g_role.RoleEnemyInfo"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,e.fullScr=!0,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){gd.enemyHeroCtrl.getShowHeroData(e.userId,function(e){t()},this)})})}(g_role||(g_role={}));var g_role;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.trainType=0,this.isUseDiamond=!1}__extends(t,e);var i=(__define,t),r=i.prototype;return r._initProp=function(){e.prototype._initProp.call(this)},r._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this,i=gd.heroCtrl.getWingUpgradeTypeStr();i=""==i?"common":i,t.setType(i)},r.onExit=function(){e.prototype.onExit.call(this)},r._tap_btn_keyUpgrade=function(){var e=this,t=e.data.hec;if(null!=t){var i=t.id,r=gd.heroCtrl.getIsUseStoneOpt();gd.heroCtrl.wingFos2Top(i,e.trainType,r,function(){var t=e.get("root");t.dataChanged(),e.close()},e)}},r._chg_ckb_common=function(){var e=this;e.setType("common")},r._chg_ckb_advanced=function(){var e=this;e.setType("advanced")},r._chg_ckb_useStone=function(){var e=this;if(e.trainType==gc.c_prop.wingFosTypeKey.advFoster){var t=e.ckb_useStone.selected;gd.heroCtrl.setIsUseStoneOpt(t),e.showNeedResource()}else e.ckb_useStone.selected=!1},r.setType=function(e){var t=this,i="common"==e?!0:!1;if(t.ckb_common.selected=i,t.ckb_advanced.selected=!i,t.isUseDiamond=!i,i)t.setTrainType(gc.c_prop.wingFosTypeKey.comFoster),t.ckb_useStone.selected=!1;else{t.setTrainType(gc.c_prop.wingFosTypeKey.advFoster);var r=gd.heroCtrl.getIsUseStoneOpt();t.ckb_useStone.selected=r}gd.heroCtrl.setWingUpgradeTypeStr(e),t.updateWing(),t.showNeedResource()},r.setTrainType=function(e){var t=this;t.trainType=e},r.checkCanOneKeyUpgrade=function(){return!0},r._tap_btn_close=function(){var e=this;e.close()},r.updateWing=function(){var e=this,t=e.getWingData();t&&(e.labelCurreLevel.text=t.level.toString(),e.labelCurreStar.text=t.star.toString(),e.labelNextLevel.text=t.nextLevel.toString())},r.getWingData=function(){var e=this,t=e.data.hec;if(null==t)return null;var i=t.getWingOpt(),r=i.wingLvl,o=i.nowStarCount,a=i.wingIdLimit,n=i.wingId,l={};return l.level=r,l.star=o,n>=a?l.nextLevel=l.level:l.nextLevel=l.level+1,l},r.showNeedResource=function(){var e=this,t=e.get("hec"),i=t.getWingOpt(),r=0;r=e.trainType==gc.c_prop.wingFosTypeKey.comFoster?i.comTrain:i.advTrain;var o=e.getContNum(e.trainType),a=r*o;if(e.trainType==gc.c_prop.wingFosTypeKey.comFoster)e.labelFeather.text="升阶总需:"+a+"金币",e.labelMoney.text="";else{e.labelFeather.text="升阶总需羽毛:"+o+"个";var n=i.featherCount;if(gd.heroCtrl.getIsUseStoneOpt()&&o>n){var l=(o-n)*r;e.labelMoney.text="当前升阶仍需:"+l+"元宝"}else e.labelMoney.text=""}},r.getContNum=function(e){var t=this,i=t.get("hec"),r=i.getWingOpt(),o=r.wingId,a=r.nowStarCount,n=t.getTotalNeedExp(o,a),l=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.wingCrit),s=0;s=t.trainType==gc.c_prop.wingFosTypeKey.comFoster?l[5]:l[0];var _=r.nowExp,c=Math.ceil((n-_)/s);return c},r.getTotalNeedExp=function(e,t){var i=mo.getJSONWithFileName(gc.cfg_t_wing),r=0,o=10-t,a=e;for(var n in i)if(n==a.toString()&&o>0){var l=i[n],s=l[gc.t_wing_needExp];r+=s,a+=1,o-=1}return r},t}(mo.gui.Dlg);e.RoleWingUpgrade=t,egret.registerClass(t,"g_role.RoleWingUpgrade")}(g_role||(g_role={}));var g_role;!function(e){var t=function(t){function i(){t.apply(this,arguments)}__extends(i,t);var r=(__define,i),o=r.prototype;return o._initProp=function(){var i=this;t.prototype._initProp.call(this),i._Item_list_items=e.RoleBuzhenItem},o._childrenCreated=function(){t.prototype._childrenCreated.call(this)},o._data_list_items=function(){var e=this,t=gd.heroCtrl.getFightList();return e.posArr||(e.posArr=[].concat(t)),e.posArr},o._click_list_items=function(e){var t=this,i=e.item;console.log("hec.name = ",gc.c_prop.heroJob[i.job]),t.selectA?(t.selectB=i,t._swapPos(t.selectA,t.selectB),t.selectA=null,t.selectB=null):t.selectA=i},o._swapPos=function(e,t){var i=this,r=i.posArr.indexOf(e),o=i.posArr.indexOf(t);i.posArr[r]=t,i.posArr[o]=e,i.refreshList("list_items")},o._tap_btn_cancel=function(){var e=this;e.close()},o._tap_btn_save=function(){var e=this;console.log("-->保存布阵"),gd.heroCtrl.saveFightList(e.posArr,function(){e.close()},e)},i}(mo.gui.Dlg);e.RoleBuzhen=t,egret.registerClass(t,"g_role.RoleBuzhen")}(g_role||(g_role={}));var g_role;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),r=i.prototype;return r._childrenCreated=function(){e.prototype._childrenCreated.call(this)},r.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,i=t.data;t.ico.source=mo.STR.format("avatar_%s_%s_0",i.job,i.sex),t.label_name.text=gc.c_prop.heroJob[i.job],t.label_num.text=t.itemIndex+1},t}(mo.gui.ItemRenderer);e.RoleBuzhenItem=t,egret.registerClass(t,"g_role.RoleBuzhenItem")}(g_role||(g_role={}));