var g_smelting;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n._initProp=function(){e.prototype._initProp.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.ckb_keep.selected=!0,t._setData()},n._tap_btn_info=function(){g_base.BaseShowTip.create().setData({id:4}).show()},n._setData=function(){var e=this,t=e.ckb_keep.selected;e.white_txt.text="白色装备×"+gd.equipCtrl.getSmeltArr(t?1:0,1).length,e.green_txt.text="绿色装备×"+gd.equipCtrl.getSmeltArr(t?1:0,2).length,e.blue_txt.text="蓝色装备×"+gd.equipCtrl.getSmeltArr(t?1:0,3).length,e.purple_txt.text="紫色装备×"+gd.equipCtrl.getSmeltArr(t?1:0,4).length,e.orange_txt.text="橙色装备×"+gd.equipCtrl.getSmeltArr(t?1:0,5).length},n._tap_btn_whiteResolve=function(){var e=this;e._ResolveEquip(1)},n._tap_btn_greenResolve=function(){var e=this;e._ResolveEquip(2)},n._tap_btn_blueResolve=function(){var e=this;e._ResolveEquip(3)},n._tap_btn_purpleResolve=function(){var e=this;e._ResolveEquip(4)},n._tap_btn_orangeResolve=function(){var e=this;e._ResolveEquip(5)},n._chg_ckb_keep=function(){var e=this;e._setData()},n._ResolveEquip=function(e){var t=this,i=e,n=t.ckb_keep.selected,r=gd.equipCtrl.getSmeltArr(n?1:0,e);return 0==gd.equipCtrl.getSmeltArr(n?1:0,e).length?mo.showMsg("没有该类装备需要熔炼！"):void gd.equipCtrl.smelt(r,i,function(){t._setData()},t)},t}(g_base.CloseInfoDlg);e.SmeltingBatch=t,egret.registerClass(t,"g_smelting.SmeltingBatch")}(g_smelting||(g_smelting={}));var g_smelting;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.registerClassByKey(gd.EquipCtrl,gd.EquipCtrl.ON_SMELT,t.playEffect),t.efx.autoPlay=!1,t.efx.visible=!1;var i=function(){t.efx.gotoAndStop(1),t.efx.visible=!1,t.ico_item.visible=!0};t.emitter.on("dtor",function(){var e=t.efx;e.removeEventListener(egret.Event.COMPLETE,i,t)}),t.efx.addEventListener(egret.Event.COMPLETE,i,t),t.ico_item.onClick(t._dropMe,t)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,i=t.data;if(t.grp_add.visible=!i,t.ico_item.visible=!!i,i){var n=t.ico_item,r=gd.equipCtrl.getTempIdByEquipId(i);t.name="cell_"+r,n.set("itemId",r)}},n._tap_img_add=function(){var e=this;e.delegate.chooseEquipForIdx(e.itemIndex)},n._dropMe=function(){var e=this;e.delegate.dropEquipByIdx(e.itemIndex)},n.playEffect=function(){var e=this;e.ico_item.visible=!1,e.efx.visible=!0,e.efx.play(1)},t}(mo.gui.ItemRenderer);e.SmeltingItem=t,egret.registerClass(t,"g_smelting.SmeltingItem")}(g_smelting||(g_smelting={}));var g_smelting;!function(e){var t=function(t){function i(){t.apply(this,arguments),this._playingEffect=!1,this._fromChoose=!1,this._counter=0}__extends(i,t);var n=(__define,i),r=n.prototype;return r._initProp=function(){var i=this;t.prototype._initProp.call(this),i._helpDataId=4,i._Item_list_items=e.SmeltingItem},r._initItem_list_items=function(e){var t=this,i=e.efx,n=function(){t._counter++,t._counter>=t.equipIds.length&&(t.refreshList("list_items"),t._playingEffect=!1)};t.emitter.on("dtor",function(){var e=i;e.removeEventListener(egret.Event.COMPLETE,n,t)}),i.addEventListener(egret.Event.COMPLETE,n,t)},r._data_list_items=function(){var e=this,t=e._fromChoose?e.equipIds:gd.equipCtrl.getSmeltArr(e.ckb_keep.selected?1:0);return e._fromChoose=!1,e.equipIds=e._fillArr(t,9,null),e._counter=0,t},r._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.ckb_keep.selected=!0,e.registerClassByKey(gd.EquipCtrl,gd.EquipCtrl.ON_BATCH_SMELT,function(){e.refreshList("list_items")})},r._tap_btn_batchResolve=function(){e.SmeltingBatch.create().show()},r._tap_btn_resolve=function(){var e=this;if(!e._playingEffect){var t;e._hasCustomEquip&&(t=gc.id_c_msgCode.ifSmeltCustom),e._hasSpecailEquip&&(t=gc.id_c_msgCode.ifSmeltHeirloom),t?mo.showMsg(t,function(){e._doSmelting()}):e._doSmelting()}},r._doSmelting=function(){var e=this,t=e.equipIds.filter(function(e){return null!=e});t.length>0&&(e._playingEffect=!0),gd.equipCtrl.smelt(t,0,function(){e._hasSpecailEquip=!1,e._hasCustomEquip=!1},e)},r._chg_ckb_keep=function(){var e=this;e.refreshList("list_items")},r.chooseEquipForIdx=function(t){var i=this,n=i.equipIds.filter(function(e){return null!=e}),r=e.SmeltEquipChoose.create().setData({equipIds:n,maxNum:9}).show();r.onClose(function(e){r.doWhat<=0||(i.equipIds=n,i._fromChoose=!0,i._hasSpecailEquip=r.specialEquipNum>0,i._hasCustomEquip=r.customEquipNum>0,i.refreshList("list_items"))})},r.dropEquipByIdx=function(e){var t=this;t.equipIds[e]=null,t._fromChoose=!0,t.refreshList("list_items")},r._fillArr=function(e,t,i){if(t<=e.length)return e;for(var n=0,r=t-e.length;r>n;n++)e.push(i);return e},i}(g_base.CloseInfoDlg);e.Smelting=t,egret.registerClass(t,"g_smelting.Smelting"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.targetClass=t,e.notOwnRes=!0,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){t()})})}(g_smelting||(g_smelting={}));var g_smelting;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n._initProp=function(){e.prototype._initProp.call(this)},n._childrenCreated=function(){e.prototype._childrenCreated.call(this)},n.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.name="eqp_cell_"+t.itemIndex;var i=t.data;t.ico_item.set("itemId",i.tempId);for(var n,r=mo.STR.format("[ubb color=%s]%s[/ubb] [ubb]评分:%s[/ubb][/br]",uiHelper.getColorByQuality(i.quality),i.name,gd.equipCtrl.getEquipEvaluate(i.equipId)),s=i.proptys,o=gd.equipCtrl.getEquipExtraObj(i.equipId),l="[ubb]%s: %s[/ubb][ubb] +%s[/ubb][/br]",u="[ubb color=0x2EAAF7]%s: %s[/ubb][ubb color=0x2EAAF7] +%s[/ubb][/br]",a=0,p=s.length;p>a;a++){n=s[a];var _=n[0],d=n[1];r+=mo.STR.format(0==a?l:u,gc.c_prop.equipProp[_],d,o[_]||0)}t.label_desc.text=r,t.ckb_selected.selected=t.delegate.isSelected(i.equipId)},t}(mo.gui.ItemRenderer);e.SmeltChooseItem=t,egret.registerClass(t,"g_smelting.SmeltChooseItem")}(g_smelting||(g_smelting={}));var g_smelting;!function(e){var t=function(t){function i(){t.apply(this,arguments),this.specialEquipNum=0,this.customEquipNum=0,this.doWhat=0,this.maxNum=0}__extends(i,t);var n=(__define,i),r=n.prototype;return r._initProp=function(){var i=this;t.prototype._initProp.call(this),i._Item_list_items=e.SmeltChooseItem,i.showType=1},r._childrenCreated=function(){t.prototype._childrenCreated.call(this)},r.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this;e.updateNum()},r.updateNum=function(){var e=this,t=e.data.equipIds||[];e.label_num.text=[t.length,e.data.maxNum]},r.isSelected=function(e){var t=this,i=t.data.equipIds||[];return i.indexOf(e)>=0},r.pickEquip=function(e){var t=this,i=t.data.equipIds||[],n=i.indexOf(e);0>n&&(i.push(e),t.updateNum(),gd.equipCtrl.isSpecialEquip(gd.equipCtrl.getTempIdByEquipId(e))&&t.specialEquipNum++,gd.equipCtrl.isCustomEquipByTempId(gd.equipCtrl.getTempIdByEquipId(e))&&t.customEquipNum++,i.length>=t.data.maxNum&&t._tap_btn_ok())},r.dropEquip=function(e){var t=this;gd.equipCtrl.isSpecialEquip(gd.equipCtrl.getTempIdByEquipId(e))&&t.specialEquipNum--,gd.equipCtrl.isCustomEquipByTempId(gd.equipCtrl.getTempIdByEquipId(e))&&t.customEquipNum--;var i=t.data.equipIds||[],n=i.indexOf(e);n>=0&&(i.splice(n,1),t.updateNum())},r._data_list_items=function(){var e=this,t=gd.BagDataCtrl;return 1!=e.showType?t.getList(t.getFilterOpt(e.showType),t.getSortOpt(e.showType)):t.getEquipListUnlocked(gd.equipCtrl.getEquipList())},r._refresh=function(){var e=this;e.refreshList("list_items")},r._click_list_items=function(e){var t=this,i=e.item,n=e.itemRenderer;n.ckb_selected.selected=!n.ckb_selected.selected,n.ckb_selected.selected?t.pickEquip(i.equipId):t.dropEquip(i.equipId)},r._tap_btn_ok=function(){var e=this;e.doWhat=1,e.close()},i}(mo.gui.Dlg);e.SmeltEquipChoose=t,egret.registerClass(t,"g_smelting.SmeltEquipChoose")}(g_smelting||(g_smelting={}));