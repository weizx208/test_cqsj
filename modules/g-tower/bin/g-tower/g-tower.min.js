var g_tower;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),o=r.prototype;return o._initProp=function(){e.prototype._initProp.call(this);var t=this;t._layerOpt.shownWithAction=!1},o._childrenCreated=function(){e.prototype._childrenCreated.call(this)},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data.items,o=gd.copyCtrl.getPaTaTreasuryCount(),a=gd.copyCtrl.getMaxFreeTowerTimes(),i=gd.copyCtrl.getPaTaTreasuryNeedDia();gd.copyCtrl.getPaTaTreasuryBuyCount();t.label_desc.text=i>0?mo.STR.format("消耗:"):mo.STR.format("今日剩余免费寻宝次数:%s/%s",o,a),t.grp_cost.visible=i>0,t.grp_cost.includeInLayout=i>0,i>0&&uiHelper.setResGrp(t.grp_cost,gc.c_prop.spItemIdKey.diamond,i),uiHelper.setItemsGrp(t.grp_passAward,utils.itemObj2ObjArr(r))},o._tap_btn_again1=function(){var e=this;gd.copyCtrl.paTaTreasury(function(r){e.close(),t.create().setData({items:r}).show()},e)},t}(mo.gui.Dlg);e.TowerGain=t,egret.registerClass(t,"g_tower.TowerGain"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e.Tower,mo.moduleMgr.registerModule(t),t.onPreAsync(function(e,t){gd.copyCtrl.getPaTaInfo(function(){t()},this)})})}(g_tower||(g_tower={}));var g_tower;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),a=o.prototype;return a._initProp=function(){t.prototype._initProp.call(this);var e=this;e._Item_list_items=g_base.BaseItemCell,e.registerClassByKey(gd.CopyCtrl,gd.CopyCtrl.ON_TOWER_TANBAO,e._setdData)},a._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e._setdData()},a._setdData=function(){var e=this;e._setPromptType(),e._scollerHelper=new uiHelper.ScrollerHelper(e.list_items)},a._setPromptType=function(){var e=this;if(e.num.visible=!1,e.consumption.visible=!1,e.label_date.text="妖塔已通关"+gd.copyCtrl.getTowerIndex(gd.copyCtrl.getTowerBaokuNum())+"层",gd.copyCtrl.getPaTaTreasuryCount()<=0){e.consumption.visible=!0;var t=gd.copyCtrl.getPaTaTreasuryNeedDia();e.buyMoney=t,e.label_yb.text=t;var r=gd.copyCtrl.getMaxFreeTowerTimes(),o=gd.copyCtrl.getPaTaTreasuryBuyCount();e.label_Ybtxt.text=r+o+1}else e.num.visible=!0,e.treasury_num.text=gd.copyCtrl.getPaTaTreasuryCount()+"/"+gd.copyCtrl.getMaxFreeTowerTimes()},a._data_list_items=function(){var e=this;e._scollerHelper.resumeScroll();for(var t=mo.getJSONWithFileNameAndID(gc.cfg_t_paTaTreasury,gd.copyCtrl.getTowerBaokuNum()),r=t[gc.t_paTaTreasury_treasury],o=t[gc.t_paTaTreasury_exData]||[],a=[],i=0,n=r.length;n>i;++i)a.push({itemId:r[i][0],count:r[i][1]});for(var i=0,n=o.length;n>i;++i)a.push({itemId:o[i][0],count:o[i][1]});return a=gd.userUtils.getLoots(a),a.sort(function(e,t){return mo.getJSONWithFileNameAndID(gc.cfg_t_item,t.itemId)[gc.t_item_color]-mo.getJSONWithFileNameAndID(gc.cfg_t_item,e.itemId)[gc.t_item_color]}),a},a._tap_btn_once=function(){var t=this;gd.copyCtrl.paTaTreasury(function(r){t._setdData(),e.TowerGain.create().setData({items:r}).show()},t)},a._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:105,param1:gd.copyCtrl.getMaxFreeTowerTimes()}).show()},a._tap_btn_back=function(){mo.moduleMgr.runModule(g_consts.moduleId.home)},a._initItem_list_items=function(e){var t=e.ico_item;t.showEquipName=!0,e.tapShowDetail=!0},r}(mo.gui.Dlg);e.TowerTreasury=t,egret.registerClass(t,"g_tower.TowerTreasury"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=t,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){t()})})}(g_tower||(g_tower={}));var g_tower;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),a=o.prototype;return a._initProp=function(){t.prototype._initProp.call(this);var r=this;mo.gui.helper.setSkinName(this,e.TowerTreasury.__className),r._Item_list_items=g_base.BaseItemCell},a._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e._setdData()},a._setdData=function(){var e=this;e._setPromptType()},a._setPromptType=function(){var e=this;e.label_date.text="妖塔已通关"+gd.copyCtrl.getTowerIndex(gd.copyCtrl.getTowerBaokuNum())+"层",e.label_Preview.text="通关"+gd.copyCtrl.getTowerIndex(e.data.previewCopyId)+"层后解锁奖励"},a._data_list_items=function(){for(var e=this,t=mo.getJSONWithFileNameAndID(gc.cfg_t_paTaTreasury,e.data.previewCopyId),r=t[gc.t_paTaTreasury_treasury],o=t[gc.t_paTaTreasury_exData]||[],a=[],i=0,n=r.length;n>i;++i)a.push({itemId:r[i][0],count:r[i][1]});for(var i=0,n=o.length;n>i;++i)a.push({itemId:o[i][0],count:o[i][1]});return a=gd.userUtils.getLoots(a),a.sort(function(e,t){return mo.getJSONWithFileNameAndID(gc.cfg_t_item,t.itemId)[gc.t_item_color]-mo.getJSONWithFileNameAndID(gc.cfg_t_item,e.itemId)[gc.t_item_color]}),a},a._initItem_list_items=function(e){var t=e.ico_item;t.showEquipName=!0,e.tapShowDetail=!0},a.getCurrentSkinState=function(){return"PreviewInterface"},a._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:105,param1:gd.copyCtrl.getMaxFreeTowerTimes()}).show()},a._tap_btn_close=function(){},r}(mo.gui.Dlg);e.TowerPreview=t,egret.registerClass(t,"g_tower.TowerPreview"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e.TowerTreasury,mo.moduleMgr.registerModule(t),t.onPreAsync(function(e,t){t()})})}(g_tower||(g_tower={}));var g_comp;!function(e){var t=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var r=(__define,t),o=r.prototype;return o._childrenCreated=function(){e.prototype._childrenCreated.call(this)},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,r=t.data.copyId,o=mo.getJSONWithFileNameAndID(gc.cfg_t_paTaTreasury,r)[gc.t_paTaTreasury_displayId];t.img_boss.source=resHelper.getWorldBossIconPath(o),t.label_num.text=gd.copyCtrl.getTowerIndex(r),t.img_fighting.visible=!1;var a=gd.copyCtrl.getFocusTowerCopyId(),i=gd.copyCtrl.isTwerPassed(r);if(t.img_pass.visible=i,t.img_fighting.visible=!1,t.img_canGet.visible=!1,a==r)if(i){var n=gd.copyCtrl.getIsAwardArr(r),s=n[1];t.img_pass.visible=s,t.img_canGet.visible=n[0]&&!n[1]}else t.img_fighting.visible=gd.copyCtrl.getHighPata()==r},t}(mo.gui.Comp);e.TowerMonster=t,egret.registerClass(t,"g_comp.TowerMonster")}(g_comp||(g_comp={}));var g_tower;!function(e){var t=function(t){function r(){t.apply(this,arguments)}__extends(r,t);var o=(__define,r),a=o.prototype;return a._initProp=function(){t.prototype._initProp.call(this);var e=this;e._layerOpt.shownWithAction=!1},a._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e._refreshMonster(),e.refreshUI()},a.refreshUI=function(){var e=this,t=e.curTowerCopyId=gd.copyCtrl.getFocusTowerCopyId(),r=mo.getJSONWithFileNameAndID(gc.cfg_t_paTaTreasury,t),o=r[gc.t_paTaTreasury_award],a=gd.copyCtrl.findSpAward(t);uiHelper.setItemsGrp(e.grp_passAward,utils.kvArrItems2ObjArr(o)),e.label_num.text=gd.copyCtrl.getTowerIndex(t),e.grp_preview.visible=null!=a,e.grp_preview.visible&&(e.label_spAwardLayerNum.text=gd.copyCtrl.getTowerIndex(a));var i=gd.copyCtrl.getIsAwardArr(t);e.btn_getAward.visible=i[0]&&!i[1],e.btn_enter.visible=!i[0],e.label_treasureNum.text=gd.copyCtrl.isFirstTowerCopyId()?"通关第一层后开启妖塔宝库":mo.STR.format("(第%s层宝库)",gd.copyCtrl.getTowerIndex(gd.copyCtrl.getTowerBaokuNum()))},a._refreshMonster=function(){for(var e=this,t=gd.copyCtrl.getTowerMonList(),r=0,o=t.length;o>r;++r){var a=t[r],i=e["tm"+r];i.setData({copyId:a}),i.dataChanged()}},a._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:104}).show()},a._tap_btn_rank=function(){mo.moduleMgr.runModule(g_consts.moduleId.rank,{rankType:gc.c_prop.rankTypeKey.paTaRank})},a._tap_btn_enter=function(){var e=this;gd.fightCtrl.enterCopy(e.curTowerCopyId)},a._tap_btn_getAward=function(){var e=this;gd.copyCtrl.paTaAward(e.curTowerCopyId,function(){e.refreshUI(),e._refreshMonster()},e)},a._tap_btn_treasure=function(){return gd.copyCtrl.isFirstTowerCopyId()?mo.showMsg(gc.id_c_msgCode.noLevelDown):void mo.moduleMgr.runModule(g_consts.moduleId.towerTreasury)},a._tap_img_preview=function(){var t=this,r=t.curTowerCopyId,o=gd.copyCtrl.findSpAward(r);o&&e.TowerPreview.create().setData({previewCopyId:o}).show()},r}(mo.gui.Dlg);e.Tower=t,egret.registerClass(t,"g_tower.Tower"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var e=new mo.ModuleCfgItem;e.fullScr=!0,e.targetClass=t,e.sysId=gc.id_c_open.paTa,mo.moduleMgr.registerModule(e),e.onPreAsync(function(e,t){gd.copyCtrl.getPaTaInfo(function(){t()},this)})})}(g_tower||(g_tower={}));