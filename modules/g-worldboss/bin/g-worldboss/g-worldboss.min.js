var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){var t=this;e.prototype._initProp.call(this),t._layerOpt.shownWithAction=!1,t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.START_FIGHT_BOSS_IN_FIGHT_SCENE,t.close)},o._childrenCreated=function(){var t=this;e.prototype._childrenCreated.call(this),t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.ON_WORLD_BOSS_OPEN_CHANGE,t.onWorldBossOpenChanged),t.onWorldBossOpenChanged()},o.onWorldBossOpenChanged=function(){var t=this;t.label_wboss_fighting.visible=gd.bossFightCtrl.getOpenIdsByType(gc.c_prop.worldBossTypeKey.world).length>0,t.label_gboss_fighting.visible=gd.bossFightCtrl.getOpenIdsByType(gc.c_prop.worldBossTypeKey.guild).length>0,t.label_lmtboss_fighting.visible=gd.bossFightCtrl.getOpenIdsByType(gc.c_prop.worldBossTypeKey.guild,1).length>0},o._tap_img_lmtBoss=function(){mo.moduleMgr.runModule(g_consts.moduleId.guildBossLevelList,{isLmt:1})},o._tap_img_guildBoss=function(){mo.moduleMgr.runModule(g_consts.moduleId.guildBossLevelList)},o._tap_img_worldBoss=function(){mo.moduleMgr.runModule(g_consts.moduleId.wBossList)},o._tap_btn_resBack=function(){t.BossResBack.create().show()},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:53}).show()},s}(mo.gui.Dlg);t.BossWar=e,egret.registerClass(e,"g_worldboss.BossWar"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,t.sysId=gc.id_c_open.worldboss,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){var s=this;async.map([gd.bossGuildCtrl,gd.bossWorldCtrl],function(t,e,i){t.getInfo(i,s)},function(){e()},s)})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,e.outsideClosable=!0},i._childrenCreated=function(){t.prototype._childrenCreated.call(this)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data.locked,i=e.data.bossId;e.label_call_type.text=s?"锁定召唤":"召唤",e.btn_lock_call.visible=s,e.btn_call.visible=!s;var o=mo.getJSONWithFileName(gc.cfg_c_bossParameter),r=o[i],l=r[gc.c_bossParameter_summonCost][0],a=r[gc.c_bossParameter_summonCost][1],n=l==gc.c_prop.spItemIdKey.diamond;e.grp_res1.visible=!n;var g=s?gd.bossGuildCtrl.getLockCost():0;n?a+=g:(e.grp_res1.visible=0!=g,uiHelper.setResGrp(e.grp_res1,gc.c_prop.spItemIdKey.diamond,g)),uiHelper.setResGrp(e.grp_res0,l,a),uiHelper.setResGrp(e.grp_extra_res,gc.c_prop.spItemIdKey.diamond,gd.bossGuildCtrl.getOpenChannelCost())},i._tap_btn_call=function(){var t=this;gd.bossGuildCtrl.openBoss(t.data.bossId,!1,function(){t.close(),mo.moduleMgr.runModule(g_consts.moduleId.worldBoss,{bossId:t.data.bossId})},t)},i._tap_btn_lock_call=function(){var t=this;gd.bossGuildCtrl.openBoss(t.data.bossId,!0,function(){t.close(),mo.moduleMgr.runModule(g_consts.moduleId.worldBoss,{bossId:t.data.bossId})},t)},e}(mo.gui.Dlg);t.BossExtraCost=e,egret.registerClass(e,"g_worldboss.BossExtraCost")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._childrenCreated=function(){t.prototype._childrenCreated.call(this)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data;e.label_index.text=s[0],uiHelper.setItemsGrp(e.grp_items,utils.kvArrItems2ObjArr(s[1]))},e}(mo.gui.ItemRenderer);t.WBossRewardItem=e,egret.registerClass(e,"g_worldboss.WBossRewardItem")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){e.prototype._initProp.call(this);var s=this;s._layerOpt.shownWithAction=!1,s._Item_list_items=t.WBossRewardItem,s._Item_list_failItems=t.WBossRewardItem},o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this,s=t.moduleParam.bossId,i=mo.getJSONWithFileName(gc.cfg_c_bossWorld),o=i[s],r=o[gc.c_bossWorld_lastShotAward];r.push(o[gc.c_bossWorld_treasureAward]),uiHelper.setItemsGrp(t.grp_lastAttkItems,utils.kvArrItems2ObjArr(r)),t.grp_win.visible=!0,t.grp_fail.visible=!1},o._tap_tab_btn=function(){var t=this,e=t.tab_btn.selectedIndex;t.grp_win.visible=0==e,t.grp_fail.visible=0!=e},o._tap_btn_back=function(){var t=this;t.close()},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:55}).show()},o._data_list_items=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossWorldCtrl.getBossStatus(e),i=s==gd.BossFightCtrl.BOSS_STATUS.cd;i&&(e=gd.bossWorldCtrl.getDeathBossId(e));var o=mo.getJSONWithFileName(gc.cfg_c_bossWorld),r=o[e];return[["1",gd.userUtils.getLoots(r[gc.c_bossWorld_rankAward1])],["2",gd.userUtils.getLoots(r[gc.c_bossWorld_rankAward2])],["3",gd.userUtils.getLoots(r[gc.c_bossWorld_rankAward3])],["4-10",gd.userUtils.getLoots(r[gc.c_bossWorld_rankAward4])],["11-50",gd.userUtils.getLoots(r[gc.c_bossWorld_rankAward5])],["51-200",gd.userUtils.getLoots(r[gc.c_bossWorld_rankAward6])],["201-1000",gd.userUtils.getLoots(r[gc.c_bossWorld_rankAward7])]]},o._data_list_failItems=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossWorldCtrl.getBossStatus(e),i=s==gd.BossFightCtrl.BOSS_STATUS.cd;i&&(e=gd.bossWorldCtrl.getDeathBossId(e));var o=mo.getJSONWithFileName(gc.cfg_c_bossWorld),r=o[e];return[["1",gd.userUtils.getLoots(r[gc.c_bossWorld_failAward1])],["2",gd.userUtils.getLoots(r[gc.c_bossWorld_failAward2])],["3",gd.userUtils.getLoots(r[gc.c_bossWorld_failAward3])],["4-10",gd.userUtils.getLoots(r[gc.c_bossWorld_failAward4])],["11-50",gd.userUtils.getLoots(r[gc.c_bossWorld_failAward5])],["51-200",gd.userUtils.getLoots(r[gc.c_bossWorld_failAward6])],["201-1000",gd.userUtils.getLoots(r[gc.c_bossWorld_failAward7])]]},s}(mo.gui.Dlg);t.WBossReward=e,egret.registerClass(e,"g_worldboss.WBossReward"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.targetClass=e,t.fullScr=!0,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){e()})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){t.prototype._initProp.call(this)},i._childrenCreated=function(){t.prototype._childrenCreated.call(this)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data,i=s[gc.c_bossWorld_id];e.label_fightLeftTime.visible=!1,e.label_challenge_time.visible=!1,e.img_killed.visible=!1,e.btn_go.visible=!1,e.label_settlement.visible=!1,e.label_left_time.visible=!1,e.img_dark_bg.visible=!1;var o=gd.bossWorldCtrl.getBossStatus(i),r=gd.BossFightCtrl.BOSS_STATUS,l=o==r.fighting;if(e.label_fightLeftTime.visible=l,e.img_dark_bg.visible=l,e.btn_go.visible=l,l){e._setMonsterInfo(i);var a=gd.bossWorldCtrl.getReDisappearSeconds(i);return e.label_fightLeftTime.text="剩余时间: "+mo.getTimeStr(1e3*a),e._curCountdownLabel=e.label_fightLeftTime,void(a&&e.setCDTime(a))}var n=o==r.prize;if(n){e.label_settlement.visible=!0,e.label_left_time.visible=!0;var g=gd.bossWorldCtrl.getRePrizeSeconds(i);return e.label_left_time.text="剩余时间: "+mo.getTimeStr(1e3*g),e._curCountdownLabel=e.label_left_time,g&&e.setCDTime(g),void e._setMonsterInfo(gd.bossWorldCtrl.getDeathBossId(i))}var _=gd.bossWorldCtrl.getOpenStartTime(i),d=gd.bossWorldCtrl.getOpenEndTime(i);e.label_challenge_time.visible=!0,e.label_challenge_time.text=mo.STR.format("挑战时间: %s-%s",_.toFormat("HH24:MI"),d.toFormat("HH24:MI"));var c=o==r.cd;return e.img_killed.visible=c,c?void e._setMonsterInfo(gd.bossWorldCtrl.getDeathBossId(i)):void e._setMonsterInfo(i)},i._setMonsterInfo=function(t){var e=this,s=mo.getJSONWithFileNameAndID(gc.cfg_c_bossWorld,t),i=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,t);e.label_name.text="("+i[gc.t_monster_level]+"级) "+i[gc.t_monster_name],e.img_boss.source=resHelper.getWorldBossIconPath(s[gc.c_bossWorld_displayId])},i.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null)},i._tap_btn_go=function(){var t=this;mo.moduleMgr.runModule(g_consts.moduleId.worldBoss,{bossId:t.data[gc.c_bossWorld_id]})},i.resetCdTimeView=function(t){var e=this;t>0?e._curCountdownLabel.text="剩余时间: "+mo.getTimeStr(t):gd.bossWorldCtrl.getInfo(function(){e.delegate.refreshList("list_call")},e)},i.setCDTime=function(t){var e=this;if(t>0){e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null);var s=Date.newDate(Date.newDate().getTime()+1e3*t),i=e.timeTrigger=new tm.Trigger(s);i.on(tm.Trigger.ON_SECOND,e.timeSec,e),i.on(tm.Trigger.ON_END,e.timeOut,e),tm.timer.add(i)}else e.resetCdTimeView(0)},i.timeSec=function(t,e,s){var i=this,o=Date.newDate().getTime(),r=Date.newDate(s).getTime(),l=r-o;i.resetCdTimeView(l)},i.timeOut=function(t,e,s){var i=this;i.resetCdTimeView(0)},e}(mo.gui.ItemRenderer);t.WBossCell=e,egret.registerClass(e,"g_worldboss.WBossCell")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){e.prototype._initProp.call(this);var s=this;s._layerOpt.shownWithAction=!1,s._Item_list_call=t.WBossCell},o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.START_FIGHT_BOSS_IN_FIGHT_SCENE,t.close),t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.ON_WORLD_BOSS_OPEN_CHANGE,t._refreshBossState)},o._refreshBossState=function(){var t=this;gd.bossWorldCtrl.getInfo(function(){t.refreshList("list_call")},t)},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:54}).show()},o._data_list_call=function(){return gd.bossWorldCtrl.getBossList()},o._click_list_call=function(t){var e=t.item,s=e[gc.c_bossWorld_id];gd.bossWorldCtrl.getBossStatus(s)!=gd.BossFightCtrl.BOSS_STATUS.prize&&gd.bossWorldCtrl.getBossStatus(s)!=gd.BossFightCtrl.BOSS_STATUS.fighting&&mo.moduleMgr.runModule(g_consts.moduleId.wBossCall,{bossId:s})},s}(mo.gui.Dlg);t.WBossList=e,egret.registerClass(e,"g_worldboss.WBossList"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){gd.bossWorldCtrl.getInfo(function(){e()},this)})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._childrenCreated=function(){t.prototype._childrenCreated.call(this)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data,i=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,s);e.label_name.text="("+i[gc.t_monster_level]+"级) "+i[gc.t_monster_name];var o=gd.bossCtrl.getBackResOpt(s,500);uiHelper.setItemsGrp(e.grp_items,utils.kvArrItems2ObjArr(o.items)),e.ico_hasGet.visible=!1,e.btn_get.visible=!1;var r=!1;e.ico_hasGet.visible=r,e.btn_get.visible=!r,e.grp_res.visible=!r,uiHelper.setResGrp(e.grp_res,gc.c_prop.spItemIdKey.diamond,o.costDimond)},e}(mo.gui.ItemRenderer);t.BossResBackItem=e,egret.registerClass(e,"g_worldboss.BossResBackItem")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){var s=this;e.prototype._initProp.call(this),s._layerOpt.shownWithAction=!1,s._Item_list_itmes=t.BossResBackItem},o._childrenCreated=function(){e.prototype._childrenCreated.call(this)},o.dataChanged=function(){e.prototype.dataChanged.call(this)},o._data_list_itmes=function(){var t=this,e=[140001,140002,140003,140004,140005,140006,140007,140008,140009,140010];return t.img_empty&&(t.img_empty.visible=0==e.length),e},s}(mo.gui.Dlg);t.BossResBack=e,egret.registerClass(e,"g_worldboss.BossResBack")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){t.prototype._initProp.call(this)},i._childrenCreated=function(){t.prototype._childrenCreated.call(this)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data,i=1==s[gc.c_bossParameter_isLimit];e.img_limit.visible=i;var o=s[gc.c_bossParameter_awardDesc];gc.c_prop.wbossRewardDes[o];e.img_money.visible=o==gc.c_prop.wbossRewardDesKey.diamond;var r={0:["panel_ditus"],1:["panel_gboss_huodong_1"]},l=s[gc.c_bossParameter_showOnHoliday]||0,a=r[l];e.img_bg.source=a[0];var n=s[gc.c_bossParameter_id],g=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,n);e.label_name.text="("+g[gc.t_monster_level]+"级) "+g[gc.t_monster_name],e.img_boss.source=resHelper.getWorldBossIconPath(s[gc.c_bossParameter_displayId]);var _=(s.status,gd.BossFightCtrl.BOSS_STATUS,gd.bossGuildCtrl.getOtherData(n)),d=_[2];if(e.grp_lock.visible=d,e.btn_join.visible=!0,e.label_cantJoin.visible=d,e.label_fighting.visible=!1,d){var c=gd.guildPersonalCtrl.getGuildId()||0,m=c==_[0];e.img_lock.source=m?"ico_huitubiao":"ico_xiaoshuo";var u=_[1];e.label_guildName.text=m?"本行会已上锁":u,e.btn_join.visible=m,e.label_cantJoin.visible=!m}var b=gd.bossGuildCtrl.getReDisappearSeconds(n);e.label_fightLeftTime.text=mo.getTimeStr(1e3*b),e.setCDTime(b);var h=gd.bossFightCtrl.getCurFightBossId()==n;e.label_fighting.visible=h},i._tap_btn_join=function(){var t=this;mo.moduleMgr.runModule(g_consts.moduleId.guildBossCall,{bossId:t.data[gc.c_bossParameter_id]})},i.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null)},i.resetCdTimeView=function(t){var e=this;t>0&&(e.label_fightLeftTime.text=mo.getTimeStr(t))},i.setCDTime=function(t){var e=this;if(t>0){e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null);var s=Date.newDate(Date.newDate().getTime()+1e3*t),i=e.timeTrigger=new tm.Trigger(s);i.on(tm.Trigger.ON_SECOND,e.timeSec,e),i.on(tm.Trigger.ON_END,e.timeOut,e),tm.timer.add(i)}else e.resetCdTimeView(0)},i.timeSec=function(t,e,s){var i=this,o=Date.newDate().getTime(),r=Date.newDate(s).getTime(),l=r-o;i.resetCdTimeView(l)},i.timeOut=function(t,e,s){var i=this;i.resetCdTimeView(0)},e}(mo.gui.ItemRenderer);t.GuildBossFightingCell=e,egret.registerClass(e,"g_worldboss.GuildBossFightingCell")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){var e=this;t.prototype._initProp.call(this),e.countdwonTitle=""},i._childrenCreated=function(){t.prototype._childrenCreated.call(this)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data,i=s[gc.c_bossParameter_id];e.label_guild.visible=!1,e.label_call.visible=!1,e.label_killed.visible=!1,e.label_left_time.visible=!1,e.label_settlement.visible=!1,e.img_selected.visible=!1,e.label_sleep.visible=!1;var o=1==s[gc.c_bossParameter_isLimit];e.img_limit.visible=o;var r=s[gc.c_bossParameter_awardDesc],l=gc.c_prop.wbossRewardDes[r];e.img_money.visible=r==gc.c_prop.wbossRewardDesKey.diamond;var a={0:["panel_ditus"],1:["panel_gboss_huodong_1"]},n=s[gc.c_bossParameter_showOnHoliday]||0,g=a[n];e.img_bg.source=g[0];var _=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,i);e.label_name.text="("+_[gc.t_monster_level]+"级) "+_[gc.t_monster_name],e.img_boss.source=resHelper.getWorldBossIconPath(s[gc.c_bossParameter_displayId]),l=r==gc.c_prop.wbossRewardDesKey.equip?mo.STR.format(l,_[gc.t_monster_level]):l,e.label_reward_hint.text=mo.STR.format("抢夺：%s",l);var d=(mo.getJSONWithFileName(gc.cfg_c_bossParameter),s[gc.c_bossParameter_openLvl]),c=gd.guildCtrl.getData()&&gd.guildCtrl.getLvl()>=d;if(!c)return e.label_guild.visible=!0,void(e.label_guild.text=d);var m=gd.bossGuildCtrl.getBossStatus(i),u=gd.BossFightCtrl.BOSS_STATUS,b=m==u.cd;if(b){e.label_killed.visible=!0,e.label_left_time.visible=!0;var h=gd.bossGuildCtrl.getOpenCd(i);return e.countdwonTitle="召唤冷却: ",e.label_left_time.text=e.countdwonTitle+mo.getTimeStr(1e3*h,!0),void(h&&e.setCDTime(h))}var p=m==u.prize;if(p){e.countdwonTitle="剩余时间: ",e.label_settlement.visible=!0,e.label_left_time.visible=!0;var h=gd.bossGuildCtrl.getRePrizeSeconds(i);return e.label_left_time.text=e.countdwonTitle+mo.getTimeStr(1e3*h,!0),void(h&&e.setCDTime(h))}var f=m==u.sleep;return f?void(e.label_sleep.visible=!0):void(e.label_call.visible=!0)},i.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null)},i.resetCdTimeView=function(t){var e=this;t>0?e.label_left_time.text=e.countdwonTitle+mo.getTimeStr(t,!0):gd.bossGuildCtrl.getInfo(function(){e.delegate._refreshTabComp?e.delegate._refreshTabComp():e.delegate._refreshCallGrp&&e.delegate._refreshCallGrp()},e)},i.setCDTime=function(t){var e=this;if(t>0){e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null);var s=Date.newDate(Date.newDate().getTime()+1e3*t),i=e.timeTrigger=new tm.Trigger(s);i.on(tm.Trigger.ON_SECOND,e.timeSec,e),i.on(tm.Trigger.ON_END,e.timeOut,e),tm.timer.add(i)}else e.resetCdTimeView(0)},i.timeSec=function(t,e,s){var i=this,o=Date.newDate().getTime(),r=Date.newDate(s).getTime(),l=r-o;i.resetCdTimeView(l)},i.timeOut=function(t,e,s){var i=this;i.resetCdTimeView(0)},e}(mo.gui.ItemRenderer);t.GuildBossCallCell=e,egret.registerClass(e,"g_worldboss.GuildBossCallCell")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){e.prototype._initProp.call(this);var s=this;s._layerOpt.shownWithAction=!1,s._Item_list_call=t.GuildBossCallCell},o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.registerClassByKey(gd.BossGuildCtrl,gd.BossGuildCtrl.ON_BOSS_CALL_UPDATE,t._refreshCallGrp),t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.START_FIGHT_BOSS_IN_FIGHT_SCENE,t.close),t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.ON_WORLD_BOSS_OPEN_CHANGE,function(){gd.bossGuildCtrl.getInfo(function(){t._refreshCallGrp()},t)}),t.label_call_time.text=mo.STR.format("每天可召唤时段：%s-%s",gd.bossGuildCtrl.getOpenStartTime().toFormat("HH24:MI"),gd.bossGuildCtrl.getOpenEndTime().toFormat("HH24:MI")),t.label_extra_cost.text=gd.bossGuildCtrl.getLockCost()},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this;t.data.isLmt?t.img_title.source="tit_txt_g_xianshibossf":t.img_title.source="tit_txt_g_hanghuiboss"},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:28}).show()},o._refreshCallGrp=function(){var t=this;t.refreshList("list_call")},o._data_list_call=function(){var t=this,e=t.data;if(e.isLmt)return gd.bossGuildCtrl.getLimitBossList(!1);var s=e.level;return gd.bossGuildCtrl.getBossList(!1,s)},o._click_list_call=function(t){var e=t.item,s=e[gc.c_bossParameter_id];gd.bossGuildCtrl.getBossStatus(s)!=gd.BossFightCtrl.BOSS_STATUS.prize&&mo.moduleMgr.runModule(g_consts.moduleId.guildBossCall,{bossId:s})},s}(mo.gui.Dlg);t.GuildBossList=e,egret.registerClass(e,"g_worldboss.GuildBossList")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){e.prototype._initProp.call(this);var s=this;s._layerOpt.shownWithAction=!1,s.tabIndex=0,s.tabCompArr=null,s.tabCompArr=[],s._Item_list_fight=t.GuildBossFightingCell,s._Item_list_call=t.GuildBossLevelCallCell,s._Item_list_callLmt=t.GuildBossCallCell},o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.isLmt=t.moduleParam.isLmt,t.registerClassByKey(gd.BossGuildCtrl,gd.BossGuildCtrl.ON_BOSS_CALL_UPDATE,t._refreshTabComp),t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.START_FIGHT_BOSS_IN_FIGHT_SCENE,t.close),t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.ON_WORLD_BOSS_OPEN_CHANGE,function(){gd.bossGuildCtrl.getInfo(function(){t._refreshTabComp()},t)}),t.grp_fight.visible=!1,t.grp_call.visible=!1;var s=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.worldBossCfg),i=gd.bossCtrl.getReFightNum(),o=s[9];t.label_canFight.text=[i,o],t.label_canFight.visible=i>0,t.label_cannotFight.visible=0>=i,t.list_call.visible=!t.isLmt,t.list_callLmt.visible=t.isLmt,t.label_extra_cost.visible=!t.isLmt,t.label_extra_costLmt.visible=t.isLmt,t.tabCompArr=[t.grp_fight,t.grp_call],t.tab_medal.selectedIndex=0,process.nextTick(function(){t._tap_tab_medal()}),t.label_call_time.text=mo.STR.format("每天可召唤时段：%s-%s",gd.bossGuildCtrl.getOpenStartTime().toFormat("HH24:MI"),gd.bossGuildCtrl.getOpenEndTime().toFormat("HH24:MI")),t.label_extra_cost.text=gd.bossGuildCtrl.getLockCost(),t.label_extra_costLmt.text=gd.bossGuildCtrl.getLockCost(),t.isLmt?t.img_title.source="tit_txt_g_xianshibossf":t.img_title.source="tit_txt_g_hanghuiboss"},o._tap_btn_help=function(){var t=this;0==t.tabIndex?g_base.BaseShowTip.create().setData({id:27,param1:mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.worldBossCfg)[7]}).show():g_base.BaseShowTip.create().setData({id:28}).show()},o._tap_tab_medal=function(){var t=this,e=t.tabIndex=t.tab_medal.selectedIndex,s=t.tabCompArr,i=s[e];if(i){for(var o=0,r=s.length;r>o;o++){var l=s[o];l.visible=!1}t._refreshTabComp(),i.visible=!0}},o._refreshTabComp=function(){var t=this,e=t.tabIndex;0==e?t._refreshFightGrp():1==e&&t._refreshCallGrp()},o._refreshFightGrp=function(){var t=this;t.refreshList("list_fight")},o._data_list_fight=function(){var t,e=this;return t=e.isLmt?gd.bossGuildCtrl.getLimitBossList(!0):gd.bossGuildCtrl.getBossList(!0,0),e.img_empty.visible=0==t.length,t},o._refreshCallGrp=function(){var t=this;t.refreshList("list_call")},o._data_list_call=function(){var t=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.newBossCfg),e=t[4],s=e.split(","),i=[],o=mo.getJSONWithFileName(gc.cfg_c_bossParameter),r={};for(var l in o){var a=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,l),n=a[gc.t_monster_level];r[n]||(r[n]=[]),r[n].push(parseInt(l))}for(var g=0;g<s.length;++g){n=parseInt(s[g]);var _={bossId:r[n][0],level:n};i.push(_)}return i},o._data_list_callLmt=function(){return gd.bossGuildCtrl.getLimitBossList(!1)},o._click_list_call=function(e){var s=this,i=e.item;t.GuildBossList.create().setData({isLmt:s.isLmt,level:i.level}).show()},o._click_list_callLmt=function(t){var e=t.item,s=e[gc.c_bossParameter_id];gd.bossGuildCtrl.getBossStatus(s)!=gd.BossFightCtrl.BOSS_STATUS.prize&&mo.moduleMgr.runModule(g_consts.moduleId.guildBossCall,{bossId:s,isLmt:!0})},s}(mo.gui.Dlg);t.GuildBossLevelList=e,egret.registerClass(e,"g_worldboss.GuildBossLevelList"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){gd.bossGuildCtrl.getInfo(function(){e()},this)})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){var t=this;e.prototype._initProp.call(this),t._layerOpt.shownWithAction=!1,t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.START_FIGHT_BOSS_IN_FIGHT_SCENE,t.close),t.registerClassByKey(gd.BossGuildCtrl,gd.BossGuildCtrl.ON_BOSS_CALL_UPDATE,t.close)},o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.ON_WORLD_BOSS_OPEN_CHANGE,t._bossStateChange),t.px_hp.labelFunction=t.barLabelFunction,t.setData(t.moduleParam),t.label_numFuHuo.visible=!1,t.moduleParam.isLmt?t.img_title.source="tit_txt_g_xianshibossf":t.img_title.source="tit_txt_g_hanghuiboss"},o.barLabelFunction=function(t,e){return mo.STR.format("%s/%s",utils.formatByWan(t),utils.formatByWan(e))},o._bossStateChange=function(){var t=this,e=t.data.bossId,s=gd.bossFightCtrl.getEntity(e);if(s.isOpen())t._updateData(!0);else{var t=this;t.grp_fight.visible&&(t.label_fighting.visible=!1,t.btn_status.visible=!0,t.label_left_time.visible=!1,t.btn_fight.visible=!1,t.label_level_need.text="挑战已结束")}},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,s={0:["panel_ditus"],1:["panel_gboss_huodong_1"]},i=mo.getJSONWithFileNameAndID(gc.cfg_c_bossParameter,t.data.bossId),o=i[gc.c_bossParameter_showOnHoliday]||0,r=s[o];t.img_boss_bg.source=r[0],t.label_numFuHuo.text=gd.bossGuildCtrl.getRepeatCount(t.data.bossId),t._updateData(!0)},o._updateData=function(t){var e=this,s=e.data.bossId,i=gd.bossGuildCtrl.isLimitTime(s),o=mo.getJSONWithFileName(gc.cfg_c_bossParameter),r=o[s];e.label_limit_time.visible=!1;var l=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,s);e.label_name.text="("+l[gc.t_monster_level]+"级) "+l[gc.t_monster_name],e.img_boss.source=resHelper.getWorldBossIconPath(r[gc.c_bossParameter_displayId]);var a=r[gc.c_bossParameter_awardDesc],n=gc.c_prop.wbossRewardDes[a];n=a==gc.c_prop.wbossRewardDesKey.equip?mo.STR.format(n,l[gc.t_monster_level]):n,e.label_reward_hint.text=mo.STR.format("抢夺：%s",n),e.label_call_time.text=[i?"今日":"每天",gd.bossGuildCtrl.getOpenStartTime().toFormat("HH24:MI"),gd.bossGuildCtrl.getOpenEndTime().toFormat("HH24:MI")];var g=r[gc.c_bossParameter_fightLvl];e.label_boss_lvLmt_call.text=[g,r[gc.c_bossParameter_maxLvl]],e.label_boss_lvLmt_fight.text=[g,r[gc.c_bossParameter_maxLvl]],e.label_boss_lvLmt_call.visible=!1;var _=gd.bossGuildCtrl.getBossStatus(s),d=gd.BossFightCtrl.BOSS_STATUS;if(_==d.fighting){var c=gd.bossFightCtrl.getEntity(s);c.getData()?(e.px_hp.maximum=c.getTotalHp(),e.px_hp.setValue(c.getCurHp())):c.enter(function(){e.px_hp.maximum=c.getTotalHp(),e.px_hp.setValue(c.getCurHp())},e),e.label_fighting.visible=!0,e.btn_status.visible=!1,e.grp_fight.visible=!0,e.grp_call.visible=!1,t&&e.setCDTime(gd.bossGuildCtrl.getReDisappearSeconds(s));var m=gd.bossGuildCtrl.getReDisappearSeconds(s);m?(e.label_left_time.visible=!0,e.label_left_time.text=mo.getTimeStr(1e3*m,!0),t&&e.setCDTime(m)):e.label_left_time.visible=!1,e.label_level_need.text="",gd.userCtrl.getLvl()<g||gd.userCtrl.getLvl()>r[gc.c_bossParameter_maxLvl]?(e.label_boss_lvLmt_fight.visible=!0,e.btn_fight.visible=!1):(e.label_boss_lvLmt_fight.visible=!1,e.btn_fight.visible=!0)}else{if(e.btn_fight.enabled=_!=d.prize,e.label_limit_time.visible=1==i,i){var u=Date.newDate(gd.bossGuildCtrl.getLimitStartTime(s)),b=Date.newDate(gd.bossGuildCtrl.getLimitEndTime(s)),h=["每天","每周一","每周二","每周三","每周四","每周五","每周六","每周日"];e.label_limit_time.text=[u.toFormat("MM月DD日"),b.toFormat("MM月DD日"),h[gd.bossGuildCtrl.getWeek(s)]]}e.px_hp.maximum=l[gc.t_monster_maxHp],e.px_hp.setValue(l[gc.t_monster_maxHp]);var p=gd.bossGuildCtrl.getBossStatus(s);if(e.label_fighting.visible=!1,e.btn_status.visible=!0,e.grp_fight.visible=!1,e.grp_call.visible=!0,e.label_boss_sleep.visible=!0,e.grp_res.visible=!1,e.grp_res_extra.visible=!1,e.label_duration.visible=!1,e.grp_call_need.visible=!1,e.grp_lock.visible=!1,e.btn_call.visible=!0,e.btn_call.enabled=!1,e.btn_lock_call.visible=!1,e.label_left_time.visible=!1,e.label_boss_sleep.textColor=65280,e.btn_status.visible=!0,1==p)e.label_boss_sleep.text=mo.STR.format("行会等级达到%s开启",r[gc.c_bossParameter_openLvl]);else if(2==p)e.label_boss_sleep.text="";else if(p==d.sleep)e.label_boss_sleep.text="BOSS休息中";else if(p==d.cd){e.label_limit_time.visible=!1,e.label_boss_sleep.text="召唤冷却中";var m=gd.bossGuildCtrl.getOpenCd(s);m&&(e.label_left_time.visible=!0,e.label_left_time.text=mo.getTimeStr(1e3*m,!0),t&&e.setCDTime(m)),r[gc.c_bossParameter_repeat]&&e.setCanCallStatus()}else 5==p&&e.setCanCallStatus()}},o.setCanCallStatus=function(){var t=this,e=gd.BossFightCtrl.BOSS_STATUS;t.btn_call.enabled=!0,t.grp_call_need.visible=!0,t.grp_res.visible=!0,t.grp_res_extra.visible=!1,t.grp_res_extra.includeInLayout=!1,t.label_duration.visible=!0;var s=t.data.bossId,i=mo.getJSONWithFileName(gc.cfg_c_bossParameter),o=i[s],r=(o[gc.c_bossParameter_fightLvl],gd.bossGuildCtrl.getBossStatus(s));if(t.moduleParam.isLmt||(t.grp_lock.visible=!0),t.btn_lock_call.visible=t.ckb_lock.selected,t.btn_call.visible=!t.ckb_lock.selected,t.label_duration.text=mo.STR.format("召唤后需在%s分钟内击杀BOSS",o[gc.c_bossParameter_timeLimit]/60),r==e.cd){t.label_boss_sleep.text="召唤冷却中",t.btn_lock_call.icon="btn_txt_suodinfuhuo",t.btn_call.icon="btn_txt_lijizaohuan";var l=gd.bossGuildCtrl.getRepeatCost(s,!1);t.grp_res_extra.visible=!1,t.grp_res_extra.includeInLayout=!1,t.ckb_lock.selected&&(l=gd.bossGuildCtrl.getRepeatCost(s,!0)),uiHelper.setResGrp(t.grp_res,gc.c_prop.spItemIdKey.diamond,l)}else{var a=o[gc.c_bossParameter_summonCost][0],n=o[gc.c_bossParameter_summonCost][1],g=a==gc.c_prop.spItemIdKey.diamond;if(t.label_boss_lvLmt_call.visible=!0,t.label_boss_sleep.text="",t.btn_lock_call.icon="btn_txt_shuodingzaohuan",t.btn_call.icon="btn_txt_zaohuan",t.ckb_lock.selected){var _=gd.bossGuildCtrl.getLockCost();n+=g?_:0,t.grp_res_extra.visible=!g,t.grp_res_extra.includeInLayout=!g,g||uiHelper.setResGrp(t.grp_res_extra,gc.c_prop.spItemIdKey.diamond,_)}uiHelper.setResGrp(t.grp_res,a,g?n:mo.STR.format("%s: %s",mo.getJSONWithFileNameAndID(gc.cfg_t_item,a)[gc.t_item_name],n))}},o._chg_ckb_lock=function(){var t=this,e=mo.getJSONWithFileName(gc.cfg_c_vip),s=e[gd.userCtrl.getVip()];for(var i in e)if(e[i][gc.c_vip_isLock])break;return s[gc.c_vip_isLock]?void t.setCanCallStatus():(t.ckb_lock.selected=!1,mo.showMsg(gc.id_c_msgCode.vipLock,i))},o._tap_btn_help=function(){var t=gd.bossGuildCtrl.getBossStatus(this.moduleParam.bossId),e=gd.BossFightCtrl.BOSS_STATUS,s=28;t==e.fighting&&(s=27),g_base.BaseShowTip.create().setData({id:s}).show()},o._tap_btn_back=function(){var t=this;t.close()},o._tap_btn_fight=function(){var t=this,e=t.data.bossId;gd.bossGuildCtrl.checkAndShowLvlEnough(e)&&mo.moduleMgr.runModule(g_consts.moduleId.worldBoss,{bossId:e})},o._tap_btn_call=function(){var e=this;if(gd.bossGuildCtrl.hasGuildFightingBoss())return mo.showMsg(gc.id_c_msgCode.noMoreBoss);var s=e.data.bossId,i=gd.bossGuildCtrl.getBossStatus(s);i!=gd.BossFightCtrl.BOSS_STATUS.cd?gd.bossGuildCtrl.hasFightingBoss()?t.BossExtraCost.create().setData({bossId:e.data.bossId,locked:e.ckb_lock.selected}).show():gd.bossGuildCtrl.openBoss(e.data.bossId,e.ckb_lock.selected,function(){e.close(),mo.moduleMgr.runModule(g_consts.moduleId.worldBoss,{bossId:e.data.bossId})},e):mo.showMsg(gc.id_c_msgCode.reSummonBoss,gd.bossGuildCtrl.getRepeatCost(s,!1),function(){gd.bossGuildCtrl.openBoss(e.data.bossId,e.ckb_lock.selected,function(){e.close(),mo.moduleMgr.runModule(g_consts.moduleId.worldBoss,{bossId:e.data.bossId})},e)})},o._tap_btn_lock_call=function(){var e=this;if(gd.bossGuildCtrl.hasGuildFightingBoss())return mo.showMsg(gc.id_c_msgCode.noMoreBoss);var s=e.data.bossId,i=gd.bossGuildCtrl.getBossStatus(s);i!=gd.BossFightCtrl.BOSS_STATUS.cd?gd.bossGuildCtrl.hasFightingBoss()?t.BossExtraCost.create().setData({bossId:e.data.bossId,locked:e.ckb_lock.selected}).show():gd.bossGuildCtrl.openBoss(e.data.bossId,e.ckb_lock.selected,function(){e.close(),mo.moduleMgr.runModule(g_consts.moduleId.worldBoss,{bossId:e.data.bossId})},e):mo.showMsg(gc.id_c_msgCode.reSummonLock,gd.bossGuildCtrl.getRepeatCost(s,!0),function(){gd.bossGuildCtrl.openBoss(e.data.bossId,e.ckb_lock.selected,function(){e.close(),mo.moduleMgr.runModule(g_consts.moduleId.worldBoss,{bossId:e.data.bossId})},e)})},o._tap_btn_show_rewards=function(){var t=this;mo.moduleMgr.runModule(g_consts.moduleId.guildBossReward,t.moduleParam)},o.onExit=function(){e.prototype.onExit.call(this);var t=this;t.timeTrigger&&(tm.timer.remove(t.timeTrigger),t.timeTrigger=null)},o.resetCdTimeView=function(t){var e=this;t>0?e.label_left_time.text=mo.getTimeStr(t,!0):e._updateData(!1)
},o.setCDTime=function(t){var e=this;if(t>0){e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null);var s=Date.newDate(Date.newDate().getTime()+1e3*t),i=e.timeTrigger=new tm.Trigger(s);i.on(tm.Trigger.ON_SECOND,e.timeSec,e),i.on(tm.Trigger.ON_END,e.timeOut,e),tm.timer.add(i)}else e.resetCdTimeView(0)},o.timeSec=function(t,e,s){var i=this,o=Date.newDate().getTime(),r=Date.newDate(s).getTime(),l=r-o;i.resetCdTimeView(l)},o.timeOut=function(t,e,s){var i=this;i.resetCdTimeView(0)},o._tap_btn_status=function(){var e=this,s=e.data.bossId,i=gd.bossFightCtrl.getEntity(s);i.getResultData(function(e){t.GuildBossGrand.create().setData({result:e,isGuild:!0}).show()},e)},s}(mo.gui.Dlg);t.GuildBossCall=e,egret.registerClass(e,"g_worldboss.GuildBossCall"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){var s=this,i=t.bossId,o=gd.bossGuildCtrl.getBossStatus(i),r=gd.BossFightCtrl.BOSS_STATUS;if(o==r.fighting){var l=gd.bossFightCtrl.getEntity(i);l.getData()?e():l.enter(function(){e()},s)}else e()})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){t.prototype._initProp.call(this)},i._childrenCreated=function(){t.prototype._childrenCreated.call(this)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data,i=s.bossId;e.label_level.text=e.data.level,e.label_leftNum.text=gd.bossGuildCtrl.getNotKillNumByLvl(e.data.level);var o=mo.getJSONWithFileNameAndID(gc.cfg_c_bossParameter,i);e.img_boss.source=resHelper.getWorldBossIconPath(o[gc.c_bossParameter_displayId])},e}(mo.gui.ItemRenderer);t.GuildBossLevelCallCell=e,egret.registerClass(e,"g_worldboss.GuildBossLevelCallCell")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1},i._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.label_content.lineSpacing=5,e.moduleParam&&e.setData(e.moduleParam)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data.inspireId;s||(s=1);var i=mo.getJSONWithFileName(gc.cfg_t_otherBuff),o=i[s],r=e.data.bossId,l=gd.bossFightCtrl.getEntity(r),a=l.getInspireReSeconds();e.label_remaind.text=mo.STR.format("当前行会鼓舞剩余时间 %s",mo.getTimeStr(1e3*a)),e.setCDTime(a),e.label_title.text=o[gc.t_otherBuff_name],e.label_inspire_title.text=mo.STR.format("效果:增加%s%伤害,持续%s秒",o[gc.t_otherBuff_addHurt]/1e4*100,o[gc.t_otherBuff_conTime]),e.label_cost.text=mo.STR.format("花费:%s元宝",mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.worldBossCfg)[3]),l.getInspireRecordArr(function(t){e.onChatUpdate(t)},e)},i._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:26}).show()},i._tap_btn_back=function(){var t=this;t.close()},i._tap_btn_cancel=function(){var t=this;t.close()},i._tap_btn_inspire=function(){var t=this;t._inspire()},i._inspire=function(){var t=this;gd.bossFightCtrl.getEntity(t.moduleParam.bossId).inspire(function(e){t.dataChanged()},t)},i.clearChat=function(){var t=this;t.label_content.text=""},i.onChatUpdate=function(t){var e=this;e.clearChat();for(var s="",i=0;i<t.length;++i){var o=mo.STR.format("[ubb color=#F2C876]%s: [/ubb][ubb color=#ffffff]%s[/ubb]",t[i],"为行会全员增加了鼓舞Buff!");s+=o+"\n"}e.label_content.text=s,process.nextTick(function(){e.scroller&&e.scroller.throwVertically(e.scroller.getMaxScrollTop(),1)})},i.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null)},i.resetCdTimeView=function(t){var e=this;t>0&&(e.label_remaind.text=mo.STR.format("当前行会鼓舞剩余时间:%s",mo.getTimeStr(t)))},i.setCDTime=function(t){var e=this;if(t>0){e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null);var s=Date.newDate(Date.newDate().getTime()+1e3*t),i=e.timeTrigger=new tm.Trigger(s);i.on(tm.Trigger.ON_SECOND,e.timeSec,e),i.on(tm.Trigger.ON_END,e.timeOut,e),tm.timer.add(i)}else e.resetCdTimeView(0)},i.timeSec=function(t,e,s){var i=this,o=Date.newDate().getTime(),r=Date.newDate(s).getTime(),l=r-o;i.resetCdTimeView(l)},i.timeOut=function(t,e,s){var i=this;i.resetCdTimeView(0)},e}(mo.gui.Dlg);t.GuildBossInspire=e,egret.registerClass(e,"g_worldboss.GuildBossInspire"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.targetClass=e,t.fullScr=!0,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){e()})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1},i._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.img_bg.visible=!1},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data.result,i=gc.dsConsts.BossResultData,o=s[i.isWin];e.img_bg.visible=!0,e.img_bg.source=o?"panel_bossshenli":"panel_bossshibai",e.grp_guild.visible=e.data.isGuild;for(var r,l=s[i.rank5],a=0,n=5;n>a;a++)r=e["label_no"+a],r.text=l[a]||"无";e.label_maxDamage.text=s[i.firstHurtName]||"无",e.label_lastHit.text=s[i.killUserName]||"无",e.label_caller.text=s[i.callUserName]||"无",e.label_guild.text=s[i.callGuildName]||"无",e.label_myDamage.text=s[i.myHurt]+""},i._tap_btn_back=function(){var t=this;t.close()},e}(mo.gui.Dlg);t.GuildBossGrand=e,egret.registerClass(e,"g_worldboss.GuildBossGrand")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){t.prototype._initProp.call(this);var e=this;e._layerOpt.shownWithAction=!1},i._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.item0.label_index.text="第1名:",e.item1.label_index.text="第2-5名:",e.item2.label_index.text="第6-10名:",e.item3.label_index.text="第11-20名:",e.item4.label_index.text="召唤奖:",e.item5.label_index.text="行会奖:",e.item6.label_index.text="最后一击:",e.item4.label_index.textColor=15708215,e.item5.label_index.textColor=15708215,e.item6.label_index.textColor=15708215,e.label_hurt.text=mo.STR.format("%s伤害/金币",1e4/mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.worldBossCfg)[4]),e.moduleParam&&e.setData(e.moduleParam)},i._tap_btn_back=function(){var t=this;t.close()},i._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:26}).show()},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.moduleParam.bossId,i=mo.getJSONWithFileName(gc.cfg_c_bossParameter),o=i[s];e.item0.setData(gd.userUtils.getLoots(o[gc.c_bossParameter_rankAward1])),e.item1.setData(gd.userUtils.getLoots(o[gc.c_bossParameter_rankAward2])),e.item2.setData(gd.userUtils.getLoots(o[gc.c_bossParameter_rankAward3])),e.item3.setData(gd.userUtils.getLoots(o[gc.c_bossParameter_rankAward4])),e.item4.setData(gd.userUtils.getLoots(o[gc.c_bossParameter_summonAward])),e.item5.setData(gd.userUtils.getLoots(o[gc.c_bossParameter_guildAward])),e.item6.setData(gd.userUtils.getLoots(o[gc.c_bossParameter_lastShotAward]))},e}(mo.gui.Dlg);t.GuildBossReward=e,egret.registerClass(e,"g_worldboss.GuildBossReward"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.targetClass=e,t.fullScr=!0,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){e()})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){var e=this;t.prototype._initProp.call(this),e._layerOpt.shownWithAction=!1,e.registerClassByKey(gd.BossFightEntityCtrl,gc.dsConsts.BossData.curHp.toString(),e._updateUI),e.registerClassByKey(gd.BossFightEntityCtrl,gc.dsConsts.BossData.myHurt.toString(),e._updateUI),e.registerClassByKey(gd.BossFightEntityCtrl,gc.dsConsts.BossData.myRank.toString(),e._updateUI),e.registerClassByKey(gd.BossFightEntityCtrl,gc.dsConsts.BossData.inspireEndTime.toString(),e._updateUI),e.registerClassByKey(gd.BossFightCtrl,gd.BossFightCtrl.ON_BOSS_AUTO_FIGHT.toString(),function(){e.close()}),e.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.START_FIGHT_BOSS_IN_FIGHT_SCENE,e.close)},i._bossStateChange=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossFightCtrl.getEntity(e);if(!s.isOpen()){var t=this;t.ckb_auto.enabled=!1,t.btn_clear_cd.enabled=!1,t.btn_fight.enabled=!1,t.btn_guwu.enabled=!1,t.label_coolDown.text="战斗已结束",t.px_hp.setValue(0)}},i._childrenCreated=function(){t.prototype._childrenCreated.call(this);var e=this;e.registerClassByKey(gd.BossFightEntityCtrl,gd.BossFightEntityCtrl.ON_WORLD_BOSS_OPEN_CHANGE,e._bossStateChange),e.bossAP=new g_base.ActionPlayer,e.bossAP.scaleX=e.bossAP.scaleY=2,e.ico_monster.source=e.bossAP;var s=e.moduleParam.bossId,i=gd.bossFightCtrl.getEntity(s);e.img_title.source=gd.bossCtrl.isGuildBoss(s)?"tit_txt_g_hanghuiboss":"tit_txt_g_shijieboss";var o=i.getReOverSeconds();e.label_lefttime.text="活动剩余时间 "+mo.getTimeStr(1e3*o),e.setCDTime(o),e.px_hp.labelFunction=e.barLabelFunction,e.px_hp.maximum=i.getTotalHp(),e.px_hp.setValue(i.getCurHp());var r=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,s),l=r[gc.t_monster_displayID];if(e.bossAP.loadRes("m"+l+"_4s",!0),e.bossAP.playAction(),e.label_monster.text=r[gc.t_monster_name]+"  Lv."+r[gc.t_monster_level],e.ckb_auto.selected=gd.bossFightCtrl.isAutoFight()&&e._isCurAutoFightBoss(),e._updateCD(),e._updateUI(),gd.bossCtrl.isGuildBoss(s))if(i.isSelfCall())e.label_yourFuHuo.visible=!0,e.label_canFight.visible=!1,e.label_cannotFight.visible=!1;else{var a=mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.worldBossCfg),n=gd.bossCtrl.getReFightNum(),g=a[9];e.label_canFight.text=[n,g],e.label_canFight.visible=n>0,e.label_cannotFight.visible=0>=n,e.label_yourFuHuo.visible=!1}else e.label_yourFuHuo.visible=!1,e.label_canFight.visible=!1,e.label_cannotFight.visible=!1},i.barLabelFunction=function(t,e){return mo.STR.format("%s/%s",utils.formatByWan(t),utils.formatByWan(e))},i._updateUI=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossFightCtrl.getEntity(e);t.px_hp&&null!=mo.utils.getExtData(t.px_hp,"progressOpt")&&mo.gui.helper.progress(t.px_hp,s.getCurHp()),s.getFirstHurtRank(function(e){e?(t.ico_head.setData({icoId:e[gc.dsConsts.BossHurtRank.icon]}),t.label_first.text=e[gc.dsConsts.BossHurtRank.userName],t.label_first_hh.text="["+e[gc.dsConsts.BossHurtRank.guildName]+"]",t.label_first_hurt.text=mo.STR.format("%s",utils.formatByWan(e[gc.dsConsts.BossHurtRank.hurt]))):(t.label_first.text="尚未开始",t.label_first_hh.text="",t.label_first_hurt.text="")},t),t.label_my_hurt.text=mo.STR.format("输出伤害:%s",utils.formatByWan(s.getMyHurt())),t.label_my_index.text="我的排名:"+s.getMyRank();var i=gd.bossCtrl.isGuildBoss(e);if(t.grp_inspire.visible=i,t.grp_call.visible=i,i){var o=mo.STR.format("增加%s%伤害",s.getInspireHurt()/1e4*100);t.label_hanghuigw.text=mo.STR.format("行会鼓舞: %s",o);var r=s.getInspireReSeconds();t.label_hanghuilt.text="加成剩余时间 "+mo.getTimeStr(1e3*r),t.setGWTime(r),t.label_caller.text=s.getCallUserName(),t.label_callerhh.text=mo.STR.format("[%s]",s.getCallUserGuildName())}},i._updateCD=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossFightCtrl.getEntity(e);t.label_coolDown.text=mo.STR.format("冷却时间：%s",mo.getTimeStr(1e3*s.getFightCd())),t.setCoolDownTime(s.getFightCd())},i._tap_btn_help=function(){var t=this,e=gd.bossCtrl.isGuildBoss(t.moduleParam.bossId);e?g_base.BaseShowTip.create().setData({id:27,param1:mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.worldBossCfg)[7]}).show():g_base.BaseShowTip.create().setData({id:54}).show()},i._tap_btn_back=function(){var t=this;t.close()},i._tap_btn_more_index=function(){var t=this;mo.moduleMgr.runModule(g_consts.moduleId.worldBossHurtList,{bossId:t.moduleParam.bossId})},i._tap_btn_guwu=function(){var t=this;mo.moduleMgr.runModule(g_consts.moduleId.guildBossInspire,{inspireId:1,bossId:t.moduleParam.bossId})},i._isCurAutoFightBoss=function(){var t=this,e=gd.bossFightCtrl.getAutoBossId();return e&&e==t.moduleParam.bossId},i._chg_ckb_auto=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossFightCtrl.getEntity(e),i=s.getFightableLvl();if(gd.userCtrl.getLvl()<i)return mo.showMsg(gc.id_c_msgCode.noLvlchallengeBoss,i),void(t.ckb_auto.selected=!1);var o=mo.getJSONWithFileNameAndID(gc.cfg_c_vip,gd.userCtrl.getVip()),r=o[gc.c_vip_bossAutoFight];if(!r)return t.ckb_auto.selected=!1,void mo.showMsg(gc.id_c_msgCode.novLvAutoFight,mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.worldBossCfg)[7]);var l=gd.bossFightCtrl;t.ckb_auto.selected?l.hasAutoFightBoss()&&!t._isCurAutoFightBoss()?(mo.msgMgr.once_type("cancel",g_msg.msgType.confirm,function(){t.ckb_auto.selected=!1}),mo.showMsg(gc.id_c_msgCode.onlyoneAutoFight,function(){l.endAutoFight(),l.setAutoBossId(e),l.startAutoFight()},t)):(l.setAutoBossId(e),l.startAutoFight()):l.endAutoFight()},i._tap_btn_reward=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossCtrl.isGuildBoss(e);s?mo.moduleMgr.runModule(g_consts.moduleId.guildBossReward,t.moduleParam):mo.moduleMgr.runModule(g_consts.moduleId.wBossReward,t.moduleParam)},i._tap_btn_fight=function(){var t=this;t.go_fight()},i._tap_btn_clear_cd=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossFightCtrl.getEntity(e);mo.showMsg(gc.id_c_msgCode.ifResetTime,mo.getJSONWithFileNameAndID(gc.cfg_c_game,gc.id_c_game.worldBossCfg)[2],"",function(){s.clearFightCd(function(e){t._updateCD()},t)},t)},i.go_fight=function(){var t=this,e=t.moduleParam.bossId,s=gd.bossFightCtrl.getEntity(e);s.startFight(function(){},t)},i.onExit=function(){t.prototype.onExit.call(this);var e=this;e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null)},i.resetCdTimeView=function(t){var e=this;t>0&&(e.label_lefttime.text="活动剩余时间 "+mo.getTimeStr(t))},i.setCDTime=function(t){var e=this;if(t>0){e.timeTrigger&&(tm.timer.remove(e.timeTrigger),e.timeTrigger=null);var s=Date.newDate(Date.newDate().getTime()+1e3*t),i=e.timeTrigger=new tm.Trigger(s);i.on(tm.Trigger.ON_SECOND,e.timeSec,e),i.on(tm.Trigger.ON_END,e.timeOut,e),tm.timer.add(i)}else e.resetCdTimeView(0)},i.timeSec=function(t,e,s){var i=this,o=Date.newDate().getTime(),r=Date.newDate(s).getTime(),l=r-o;i.resetCdTimeView(l)},i.timeOut=function(t,e,s){var i=this;i.resetCdTimeView(0)},i.resetCoolDownTimeView=function(t){var e=this;t>0?(e.btn_clear_cd.visible=!0,e.label_coolDown.text="冷却时间 "+mo.getTimeStr(t)):(e.label_coolDown.text="点击进入战斗立即参与",e.btn_clear_cd.visible=!1)},i.setCoolDownTime=function(t){var e=this;if(t>0){e.cool_timeTrigger&&(tm.timer.remove(e.cool_timeTrigger),e.cool_timeTrigger=null);var s=Date.newDate(Date.newDate().getTime()+1e3*t),i=e.cool_timeTrigger=new tm.Trigger(s);i.on(tm.Trigger.ON_SECOND,e.coolDownTimeSec,e),i.on(tm.Trigger.ON_END,e.coolDownTimeOut,e),tm.timer.add(i)}else e.cool_timeTrigger&&(tm.timer.remove(e.cool_timeTrigger),e.cool_timeTrigger=null),e.resetCoolDownTimeView(0)},i.coolDownTimeSec=function(t,e,s){var i=this,o=Date.newDate().getTime(),r=Date.newDate(s).getTime(),l=r-o;i.resetCoolDownTimeView(l)},i.coolDownTimeOut=function(t,e,s){var i=this;i.resetCoolDownTimeView(0)},i.resetGWTimeView=function(t){var e=this;t>0?e.label_hanghuilt.text="行会鼓舞剩余时间 "+mo.getTimeStr(t):(e.label_hanghuilt.text="行会鼓舞剩余时间",e.label_hanghuigw.text="行会鼓舞:无")},i.setGWTime=function(t){var e=this;if(t>0){e.gw_timeTrigger&&(tm.timer.remove(e.gw_timeTrigger),e.gw_timeTrigger=null);var s=Date.newDate(Date.newDate().getTime()+1e3*t),i=e.gw_timeTrigger=new tm.Trigger(s);i.on(tm.Trigger.ON_SECOND,e.gwTimeSec,e),i.on(tm.Trigger.ON_END,e.gwTimeOut,e),tm.timer.add(i)}else e.resetGWTimeView(0)},i.gwTimeSec=function(t,e,s){var i=this,o=Date.newDate().getTime(),r=Date.newDate(s).getTime(),l=r-o;i.resetGWTimeView(l)},i.gwTimeOut=function(t,e,s){var i=this;i.resetGWTimeView(0)},e}(mo.gui.Dlg);t.WorldBoss=e,egret.registerClass(e,"g_worldboss.WorldBoss"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){var s=this,i=t.bossId,o=gd.bossCtrl.isGuildBoss(i),r=o?gd.bossGuildCtrl:gd.bossWorldCtrl;r.getInfo(function(){var i=t.bossId,o=r.getBossStatus(i),l=gd.BossFightCtrl.BOSS_STATUS;if(o==l.fighting){var a=gd.bossFightCtrl.getEntity(i);a.getData()?e():a.enter(function(){e()},s)}else e()},s)})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var s=(__define,e),i=s.prototype;return i._initProp=function(){t.prototype._initProp.call(this)},i._childrenCreated=function(){t.prototype._childrenCreated.call(this)},i.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this,s=e.data;e.label_index.text=mo.STR.format("%s",s[gc.dsConsts.BossHurtRank.rank]),e.label_name.text=mo.STR.format("%s",s[gc.dsConsts.BossHurtRank.userName]),e.label_hanghui.text=mo.STR.format("[%s]",s[gc.dsConsts.BossHurtRank.guildName]),e.label_hurt.text=mo.STR.format("%s",utils.formatByWan(s[gc.dsConsts.BossHurtRank.hurt]))},e}(mo.gui.ItemRenderer);t.WorldBossHurtCell=e,egret.registerClass(e,"g_worldboss.WorldBossHurtCell")}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){var s=this;e.prototype._initProp.call(this),s._layerOpt.shownWithAction=!1,s._Item_list_items=t.WorldBossHurtCell},o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this,s=t.moduleParam.bossId,i=gd.bossFightCtrl.getEntity(s);i.getHurtRankList(function(e){t.hurt_data=e,t.refreshList("list_items")},t),t.label_my_hurt.text=mo.STR.format("输出伤害:%s",utils.formatByWan(i.getMyHurt())),t.label_my_index.text="我的排名:"+i.getMyRank()},o.dataChanged=function(){e.prototype.dataChanged.call(this)},o._data_list_items=function(){var t=this;return t.hurt_data},o._tap_btn_back=function(){var t=this;t.close()},s}(mo.gui.Dlg);t.WorldBossHurtList=e,egret.registerClass(e,"g_worldboss.WorldBossHurtList"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.targetClass=e,t.fullScr=!0,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){e()})})}(g_worldboss||(g_worldboss={}));var g_worldboss;!function(t){var e=function(e){function s(){e.apply(this,arguments)}__extends(s,e);var i=(__define,s),o=i.prototype;return o._initProp=function(){var t=this;e.prototype._initProp.call(this),t._layerOpt.shownWithAction=!1},o._childrenCreated=function(){e.prototype._childrenCreated.call(this);var t=this;t.px_hp.labelFunction=t.barLabelFunction,t.setData(t.moduleParam)},o.barLabelFunction=function(t,e){return mo.STR.format("%s/%s",utils.formatByWan(t),utils.formatByWan(e))},o.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this,s=t.data.bossId,i=gd.bossWorldCtrl.getBossStatus(s),o=i==gd.BossFightCtrl.BOSS_STATUS.cd;o&&(s=gd.bossWorldCtrl.getDeathBossId(s));var r=mo.getJSONWithFileNameAndID(gc.cfg_c_bossWorld,s),l=mo.getJSONWithFileNameAndID(gc.cfg_t_monster,s);t.img_boss_bg.source="panel_ditus",t.label_name.text="("+l[gc.t_monster_level]+"级) "+l[gc.t_monster_name],t.img_boss.source=resHelper.getWorldBossIconPath(r[gc.c_bossWorld_displayId]),t.px_hp.maximum=l[gc.t_monster_maxHp],t.px_hp.setValue(l[gc.t_monster_maxHp]);var a=gd.bossWorldCtrl.getOpenStartTime(s),n=gd.bossWorldCtrl.getOpenEndTime(s);t.label_challenge_time.visible=!0,t.label_challenge_time.text=mo.STR.format("挑战时间: %s-%s",a.toFormat("HH24:MI"),n.toFormat("HH24:MI"));var g=mo.getJSONWithFileNameAndID(gc.cfg_c_help,58);t.label_desc.text=g[gc.c_help_helpText]},o._tap_btn_help=function(){g_base.BaseShowTip.create().setData({id:54}).show()},o._tap_btn_back=function(){var t=this;t.close()},o._tap_btn_show_rewards=function(){var t=this;mo.moduleMgr.runModule(g_consts.moduleId.wBossReward,t.moduleParam)},o._tap_btn_status=function(){var e=this,s=e.data.bossId,i=gd.bossFightCtrl.getEntity(s);i.getResultData(function(e){t.GuildBossGrand.create().setData({result:e,isGuild:!1}).show()},e)},s}(mo.gui.Dlg);t.WBossCall=e,egret.registerClass(e,"g_worldboss.WBossCall"),egret.Boot.once(egret.Boot.AFTER_CONFIG,function(){var t=new mo.ModuleCfgItem;t.fullScr=!0,t.targetClass=e,mo.moduleMgr.registerModule(t),t.onPreAsync(function(t,e){var s=this,i=t.bossId,o=gd.bossWorldCtrl.getBossStatus(i),r=gd.BossFightCtrl.BOSS_STATUS;if(o==r.fighting){var l=gd.bossFightCtrl.getEntity(i);l.getData()?e():l.enter(function(){e()},s)}else e()})})}(g_worldboss||(g_worldboss={}));